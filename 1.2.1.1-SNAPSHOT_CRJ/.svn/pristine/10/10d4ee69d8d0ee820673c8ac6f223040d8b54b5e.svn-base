/*
: Copyright (c) 2012 Dan Grossman. All rights reserved.
 @license: Licensed under Apache License v2.0. See http://www.apache.org/licenses/LICENSE-2.0
 @website: http://www.improvely.com/
*/
'use strict';!function(c){var l=function(a,b,g){var e="object"==typeof b,d;this.startDate=Date.today();this.endDate=Date.today();this.changed=this.maxDate=this.minDate=!1;this.ranges={};this.opens="right";this.cb=function(){};this.format="MM/dd/yyyy";this.separator=" - ";this.showWeekNumbers=!1;this.buttonClasses=["btn-primary"];d=this.locale={applyLabel:"Apply",fromLabel:"From",toLabel:"To",weekLabel:"W",customRangeLabel:"Custom Range",daysOfWeek:Date.CultureInfo.shortestDayNames,monthNames:Date.CultureInfo.monthNames,firstDay:0};this.leftCalendar={month:Date.today().set({day:1,month:this.startDate.getMonth(),year:this.startDate.getFullYear()}),calendar:[]};this.rightCalendar={month:Date.today().set({day:1,month:this.endDate.getMonth(),year:this.endDate.getFullYear()}),calendar:[]};this.parentEl="body";this.element=c(a);this.element.hasClass("pull-right")&&(this.opens="left");if(this.element.is("input"))this.element.on({click:c.proxy(this.show,this),focus:c.proxy(this.show,this)});else this.element.on("click",c.proxy(this.show,this));e&&"object"==typeof b.locale&&c.each(d,function(a,c){d[a]=b.locale[a]||c});a='\x3cdiv class\x3d"daterangepicker dropdown-menu"\x3e\x3cdiv class\x3d"calendar left"\x3e\x3c/div\x3e\x3cdiv class\x3d"calendar right"\x3e\x3c/div\x3e\x3cdiv class\x3d"ranges"\x3e\x3cdiv class\x3d"range_inputs"\x3e\x3cdiv\x3e\x3clabel for\x3d"daterangepicker_start"\x3e'+this.locale.fromLabel+'\x3c/label\x3e\x3cinput class\x3d"input-mini form-control" type\x3d"text" name\x3d"daterangepicker_start" value\x3d"" disabled\x3d"disabled" /\x3e\x3c/div\x3e\x3cdiv\x3e\x3clabel for\x3d"daterangepicker_end"\x3e'+this.locale.toLabel+'\x3c/label\x3e\x3cinput class\x3d"input-mini form-control" type\x3d"text" name\x3d"daterangepicker_end" value\x3d"" disabled\x3d"disabled" /\x3e\x3c/div\x3e\x3cbutton class\x3d"btn btn-small" disabled\x3d"disabled"\x3e'+this.locale.applyLabel+"\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e";this.parentEl=e&&b.parentEl&&c(b.parentEl)||c(this.parentEl);this.container=c(a).appendTo(this.parentEl);if(e){"string"==typeof b.format&&(this.format=b.format);"string"==typeof b.separator&&(this.separator=b.separator);"string"==typeof b.startDate&&(this.startDate=Date.parse(b.startDate,this.format));"string"==typeof b.endDate&&(this.endDate=Date.parse(b.endDate,this.format));"string"==typeof b.minDate&&(this.minDate=Date.parse(b.minDate,this.format));"string"==typeof b.maxDate&&(this.maxDate=Date.parse(b.maxDate,this.format));"object"==typeof b.startDate&&(this.startDate=b.startDate);"object"==typeof b.endDate&&(this.endDate=b.endDate);"object"==typeof b.minDate&&(this.minDate=b.minDate);"object"==typeof b.maxDate&&(this.maxDate=b.maxDate);if("object"==typeof b.ranges){for(var f in b.ranges)e=b.ranges[f][0],a=b.ranges[f][1],"string"==typeof e&&(e=Date.parse(e)),"string"==typeof a&&(a=Date.parse(a)),this.minDate&&e<this.minDate&&(e=this.minDate),this.maxDate&&a>this.maxDate&&(a=this.maxDate),this.minDate&&a<this.minDate||this.maxDate&&e>this.maxDate||(this.ranges[f]=[e,a]);e="\x3cul\x3e";for(f in this.ranges)e+="\x3cli\x3e"+f+"\x3c/li\x3e";e+="\x3cli\x3e"+this.locale.customRangeLabel+"\x3c/li\x3e";e+="\x3c/ul\x3e";this.container.find(".ranges").prepend(e)}if("object"==typeof b.locale&&"number"==typeof b.locale.firstDay)for(f=this.locale.firstDay=b.locale.firstDay;0<f;)this.locale.daysOfWeek.push(this.locale.daysOfWeek.shift()),f--;"string"==typeof b.opens&&(this.opens=b.opens);"boolean"==typeof b.showWeekNumbers&&(this.showWeekNumbers=b.showWeekNumbers);"string"==typeof b.buttonClasses&&(this.buttonClasses=[b.buttonClasses]);"object"==typeof b.buttonClasses&&(this.buttonClasses=b.buttonClasses)}var h=this.container;c.each(this.buttonClasses,function(a,b){h.find("button").addClass(b)});"right"==this.opens&&(f=this.container.find(".calendar.left"),e=this.container.find(".calendar.right"),f.removeClass("left").addClass("right"),e.removeClass("right").addClass("left"));"undefined"!=typeof b&&"undefined"!=typeof b.ranges||this.container.find(".calendar").show();"function"==typeof g&&(this.cb=g);this.container.addClass("opens"+this.opens);this.container.on("mousedown",c.proxy(this.mousedown,this));this.container.find(".calendar").on("click",".prev",c.proxy(this.clickPrev,this));this.container.find(".calendar").on("click",".next",c.proxy(this.clickNext,this));this.container.find(".ranges").on("click","button",c.proxy(this.clickApply,this));this.container.find(".calendar").on("click","td.available",c.proxy(this.clickDate,this));this.container.find(".calendar").on("mouseenter","td.available",c.proxy(this.enterDate,this));this.container.find(".calendar").on("mouseleave","td.available",c.proxy(this.updateView,this));this.container.find(".ranges").on("click","li",c.proxy(this.clickRange,this));this.container.find(".ranges").on("mouseenter","li",c.proxy(this.enterRange,this));this.container.find(".ranges").on("mouseleave","li",c.proxy(this.updateView,this));this.element.on("keyup",c.proxy(this.updateFromControl,this));this.updateView();this.updateCalendars()};l.prototype={constructor:l,mousedown:function(a){a.stopPropagation();a.preventDefault()},updateView:function(){this.leftCalendar.month.set({month:this.startDate.getMonth(),year:this.startDate.getFullYear()});this.rightCalendar.month.set({month:this.endDate.getMonth(),year:this.endDate.getFullYear()});this.container.find("input[name\x3ddaterangepicker_start]").val(this.startDate.toString(this.format));this.container.find("input[name\x3ddaterangepicker_end]").val(this.endDate.toString(this.format));this.startDate.equals(this.endDate)||this.startDate.isBefore(this.endDate)?this.container.find("button").removeAttr("disabled"):this.container.find("button").attr("disabled","disabled")},updateFromControl:function(){if(this.element.is("input")){var a=this.element.val().split(this.separator),b=Date.parseExact(a[0],this.format),a=Date.parseExact(a[1],this.format);null==b||null==a||a.isBefore(b)||(this.startDate=b,this.endDate=a,this.updateView(),this.cb(this.startDate,this.endDate),this.updateCalendars())}},notify:function(){this.updateView();this.element.is("input")&&this.element.val(this.startDate.toString(this.format)+this.separator+this.endDate.toString(this.format));this.cb(this.startDate,this.endDate)},move:function(){this.parentEl.offset();this.parentEl.scrollTop();var a=this.parentEl.offset().left-this.parentEl.scrollLeft();"left"==this.opens?this.container.css({top:this.element.offset().top+this.element.outerHeight(),right:c(window).width()-this.element.offset().left-this.element.outerWidth()-a,left:"auto"}):this.container.css({top:this.element.offset().top+this.element.outerHeight(),left:this.element.offset().left-a,right:"auto"})},show:function(a){this.container.show();this.move();a&&(a.stopPropagation(),a.preventDefault());this.changed=!1;c(document).on("mousedown",c.proxy(this.hide,this))},hide:function(a){this.container.hide();c(document).off("mousedown",this.hide);this.changed&&(this.changed=!1,this.notify())},enterRange:function(a){a=a.target.innerHTML;a==this.locale.customRangeLabel?this.updateView():(a=this.ranges[a],this.container.find("input[name\x3ddaterangepicker_start]").val(a[0].toString(this.format)),this.container.find("input[name\x3ddaterangepicker_end]").val(a[1].toString(this.format)))},clickRange:function(a){a=a.target.innerHTML;a==this.locale.customRangeLabel?this.container.find(".calendar").show():(a=this.ranges[a],this.startDate=a[0],this.endDate=a[1],this.leftCalendar.month.set({month:this.startDate.getMonth(),year:this.startDate.getFullYear()}),this.rightCalendar.month.set({month:this.endDate.getMonth(),year:this.endDate.getFullYear()}),this.updateCalendars(),this.changed=!0,this.container.find(".calendar").hide(),this.hide())},clickPrev:function(a){c(a.target).parents(".calendar").hasClass("left")?this.leftCalendar.month.add({months:-1}):this.rightCalendar.month.add({months:-1});this.updateCalendars()},clickNext:function(a){c(a.target).parents(".calendar").hasClass("left")?this.leftCalendar.month.add({months:1}):this.rightCalendar.month.add({months:1});this.updateCalendars()},enterDate:function(a){var b=c(a.target).attr("title"),g=b.substr(1,1),b=b.substr(3,1);c(a.target).parents(".calendar").hasClass("left")?this.container.find("input[name\x3ddaterangepicker_start]").val(this.leftCalendar.calendar[g][b].toString(this.format)):this.container.find("input[name\x3ddaterangepicker_end]").val(this.rightCalendar.calendar[g][b].toString(this.format))},clickDate:function(a){var b=c(a.target).attr("title"),g=b.substr(1,1),b=b.substr(3,1),e=c(a.target).parents(".calendar");e.hasClass("left")?(startDate=this.leftCalendar.calendar[g][b],endDate=this.endDate):(startDate=this.startDate,endDate=this.rightCalendar.calendar[g][b]);e.find("td").removeClass("active");if(startDate.equals(endDate)||startDate.isBefore(endDate))c(a.target).addClass("active"),startDate.equals(this.startDate)&&endDate.equals(this.endDate)||(this.changed=!0),this.startDate=startDate,this.endDate=endDate;this.leftCalendar.month.set({month:this.startDate.getMonth(),year:this.startDate.getFullYear()});this.rightCalendar.month.set({month:this.endDate.getMonth(),year:this.endDate.getFullYear()});this.updateCalendars()},clickApply:function(a){this.hide()},updateCalendars:function(){this.leftCalendar.calendar=this.buildCalendar(this.leftCalendar.month.getMonth(),this.leftCalendar.month.getFullYear());this.rightCalendar.calendar=this.buildCalendar(this.rightCalendar.month.getMonth(),this.rightCalendar.month.getFullYear());this.container.find(".calendar.left").html(this.renderCalendar(this.leftCalendar.calendar,this.startDate,this.minDate,this.endDate));this.container.find(".calendar.right").html(this.renderCalendar(this.rightCalendar.calendar,this.endDate,this.startDate,this.maxDate))},buildCalendar:function(a,b){var c=Date.today().set({day:1,month:a,year:b}),e=c.clone().add(-1).day().getMonth(),d=c.clone().add(-1).day().getFullYear();Date.getDaysInMonth(b,a);b=Date.getDaysInMonth(d,e);var f=c.getDay(),c=[];for(a=0;6>a;a++)c[a]=[];a=b-f+this.locale.firstDay+1;a>b&&(a-=7);f==this.locale.firstDay&&(a=b-6);e=Date.today().set({day:a,month:e,year:d});for(b=d=a=0;42>a;a++,d++,e=e.clone().add(1).day())0<a&&0==d%7&&(d=0,b++),c[b][d]=e;return c},renderCalendar:function(a,b,g,e){var d='\x3ctable class\x3d"table-condensed"\x3e',d=d+"\x3cthead\x3e",d=d+"\x3ctr\x3e";this.showWeekNumbers&&(d+="\x3cth\x3e\x3c/th\x3e");d=!g||g<a[1][1]?d+'\x3cth class\x3d"prev available"\x3e\x3ci class\x3d"icon-arrow-left"\x3e\x3c/i\x3e\x3c/th\x3e':d+"\x3cth\x3e\x3c/th\x3e";d+='\x3cth colspan\x3d"5" style\x3d"width: auto"\x3e'+this.locale.monthNames[a[1][1].getMonth()]+a[1][1].toString(" yyyy")+"\x3c/th\x3e";d=!e||e>a[1][1]?d+'\x3cth class\x3d"next available"\x3e\x3ci class\x3d"icon-arrow-right"\x3e\x3c/i\x3e\x3c/th\x3e':d+"\x3cth\x3e\x3c/th\x3e";d+="\x3c/tr\x3e";d+="\x3ctr\x3e";this.showWeekNumbers&&(d+='\x3cth class\x3d"week"\x3e'+this.locale.weekLabel+"\x3c/th\x3e");c.each(this.locale.daysOfWeek,function(a,b){d+="\x3cth\x3e"+b+"\x3c/th\x3e"});for(var d=d+"\x3c/tr\x3e",d=d+"\x3c/thead\x3e",d=d+"\x3ctbody\x3e",f=0;6>f;f++){d+="\x3ctr\x3e";this.showWeekNumbers&&(d+='\x3ctd class\x3d"week"\x3e'+a[f][0].getWeek()+"\x3c/td\x3e");for(var h=0;7>h;h++){var k="available ",k=k+(a[f][h].getMonth()==a[1][1].getMonth()?"":"off");b.setHours(0,0,0,0);g&&a[f][h]<g||e&&a[f][h]>e?k="off disabled":a[f][h].equals(b)&&(k+="active");d+='\x3ctd class\x3d"'+k+'" title\x3d"'+("r"+f+"c"+h)+'"\x3e'+a[f][h].getDate()+"\x3c/td\x3e"}d+="\x3c/tr\x3e"}d+="\x3c/tbody\x3e";return d+="\x3c/table\x3e"}};c.fn.daterangepicker=function(a,b){this.each(function(){var g=c(this);g.data("daterangepicker")||g.data("daterangepicker",new l(g,a,b))});return this}}(window.jQuery);