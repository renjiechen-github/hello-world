'use strict';(function(e){"function"===typeof define&&define.amd?define(["jquery"],e):"object"===typeof exports?e(require("jquery")):e(jQuery)})(function(e,q){if(!e.jstree){var M=0,y=!1,w=!1,E=!1,K=[],H=e("script:last").attr("src"),B=document,F=B.createElement("LI"),z;F.setAttribute("role","treeitem");z=B.createElement("I");z.className="jstree-icon jstree-ocl";F.appendChild(z);z=B.createElement("A");z.className="jstree-anchor";z.setAttribute("href","#");B=B.createElement("I");B.className="jstree-icon jstree-themeicon";z.appendChild(B);F.appendChild(z);z=B=null;e.jstree={version:"3.0.0-beta10",defaults:{plugins:[]},plugins:{},path:H&&-1!==H.indexOf("/")?H.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&'".,=\- \/]/g};e.jstree.create=function(a,b){var c=new e.jstree.core(++M),d=b;b=e.extend(!0,{},e.jstree.defaults,b);d&&d.plugins&&(b.plugins=d.plugins);e.each(b.plugins,function(a,d){"core"!==a&&(c=c.plugin(d,b[d]))});c.init(a,b);return c};e.jstree.core=function(a){this._id=a;this._cnt=0;this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{}}}};e.jstree.reference=function(a){var b=null,c=null;a&&a.id&&(a=a.id);if(!c||!c.length)try{c=e(a)}catch(d){}if(!c||!c.length)try{c=e("#"+a.replace(e.jstree.idregex,"\\$\x26"))}catch(d){}c&&c.length&&(c=c.closest(".jstree")).length&&(c=c.data("jstree"))?b=c:e(".jstree").each(function(){var c=e(this).data("jstree");if(c&&c._model.data[a])return b=c,!1});return b};e.fn.jstree=function(a){var b="string"===typeof a,c=Array.prototype.slice.call(arguments,1),d=null;this.each(function(){var f=e.jstree.reference(this),h=b&&f?f[a]:null;d=b&&h?h.apply(f,c):null;f||b||a!==q&&!e.isPlainObject(a)||e(this).data("jstree",new e.jstree.create(this,a));if(f&&!b||!0===a)d=f||!1;if(null!==d&&d!==q)return!1});return null!==d&&d!==q?d:this};e.expr[":"].jstree=e.expr.createPseudo(function(a){return function(a){return e(a).hasClass("jstree")&&e(a).data("jstree")!==q}});e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!0},expand_selected_onload:!0};e.jstree.core.prototype={plugin:function(a,b){var c=e.jstree.plugins[a];return c?(this._data[a]={},c.prototype=this,new c(b,this)):this},init:function(a,b){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}};this.element=e(a).addClass("jstree jstree-"+this._id);this.settings=b;this.element.bind("destroyed",e.proxy(this.teardown,this));this._data.core.ready=!1;this._data.core.loaded=!1;this._data.core.rtl="rtl"===this.element.css("direction");this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl");this.element.attr("role","tree");this.bind();this.trigger("init");this._data.core.original_container_html=this.element.find(" \x3e ul \x3e li").clone(!0);this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove();this.element.html("\x3cul class\x3d'jstree-container-ul'\x3e\x3cli class\x3d'jstree-initial-node jstree-loading jstree-leaf jstree-last'\x3e\x3ci class\x3d'jstree-icon jstree-ocl'\x3e\x3c/i\x3e\x3ca class\x3d'jstree-anchor' href\x3d'#'\x3e\x3ci class\x3d'jstree-icon jstree-themeicon-hidden'\x3e\x3c/i\x3e"+this.get_string("Loading ...")+"\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e");this._data.core.li_height=this.get_container_ul().children("li:eq(0)").height()||18;this.trigger("loading");this.load_node("#")},destroy:function(){this.element.unbind("destroyed",this.teardown);this.teardown()},teardown:function(){this.unbind();this.element.removeClass("jstree").removeData("jstree").find("[class^\x3d'jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")});this.element=null},bind:function(){this.element.on("dblclick.jstree",function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var a=window.getSelection();try{a.removeAllRanges(),a.collapse()}catch(b){}}}).on("click.jstree",".jstree-ocl",e.proxy(function(a){this.toggle_node(a.target)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(a){a.preventDefault();e(a.currentTarget).focus();this.activate_node(a.currentTarget,a)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(a){if("INPUT"===a.target.tagName)return!0;var b=null;switch(a.which){case 13:case 32:a.type="click";e(a.currentTarget).trigger(a);break;case 37:a.preventDefault();this.is_open(a.currentTarget)?this.close_node(a.currentTarget):(b=this.get_prev_dom(a.currentTarget))&&b.length&&b.children(".jstree-anchor").focus();break;case 38:a.preventDefault();(b=this.get_prev_dom(a.currentTarget))&&b.length&&b.children(".jstree-anchor").focus();break;case 39:a.preventDefault();this.is_closed(a.currentTarget)?this.open_node(a.currentTarget,function(a){this.get_node(a,!0).children(".jstree-anchor").focus()}):(b=this.get_next_dom(a.currentTarget))&&b.length&&b.children(".jstree-anchor").focus();break;case 40:a.preventDefault();(b=this.get_next_dom(a.currentTarget))&&b.length&&b.children(".jstree-anchor").focus();break;case 46:a.preventDefault();(b=this.get_node(a.currentTarget))&&b.id&&"#"!==b.id&&(b=this.is_selected(b)?this.get_selected():b);break;case 113:a.preventDefault(),b=this.get_node(a.currentTarget)}},this)).on("load_node.jstree",e.proxy(function(a,b){if(b.status&&("#"!==b.node.id||this._data.core.loaded||(this._data.core.loaded=!0,this.trigger("loaded")),!this._data.core.ready&&!this.get_container_ul().find(".jstree-loading:eq(0)").length)){this._data.core.ready=!0;if(this._data.core.selected.length){if(this.settings.core.expand_selected_onload){a=[];var c;b=0;for(c=this._data.core.selected.length;b<c;b++)a=a.concat(this._model.data[this._data.core.selected[b]].parents);a=e.vakata.array_unique(a);b=0;for(c=a.length;b<c;b++)this.open_node(a[b],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}setTimeout(e.proxy(function(){this.trigger("ready")},this),0)}},this)).on("init.jstree",e.proxy(function(){var a=this.settings.core.themes;this._data.core.themes.dots=a.dots;this._data.core.themes.stripes=a.stripes;this._data.core.themes.icons=a.icons;this.set_theme(a.name||"default",a.url);this.set_theme_variant(a.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"]();this[this._data.core.themes.icons?"show_icons":"hide_icons"]();this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(a){this.element.find(".jstree-hovered").not(a.currentTarget).mouseleave();e(a.currentTarget).mouseenter()},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(a){this.hover_node(a.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(a){this.dehover_node(a.currentTarget)},this))},unbind:function(){this.element.off(".jstree");e(document).off(".jstree-"+this._id)},trigger:function(a,b){b||(b={});b.instance=this;this.element.triggerHandler(a.replace(".jstree","")+".jstree",b)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children("ul:eq(0)")},get_string:function(a){var b=this.settings.core.strings;return e.isFunction(b)?b.call(this,a):b&&b[a]?b[a]:a},_firstChild:function(a){for(a=a?a.firstChild:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_nextSibling:function(a){for(a=a?a.nextSibling:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_previousSibling:function(a){for(a=a?a.previousSibling:null;null!==a&&1!==a.nodeType;)a=a.previousSibling;return a},get_node:function(a,b){a&&a.id&&(a=a.id);var c;try{if(this._model.data[a])a=this._model.data[a];else if(((c=e(a,this.element)).length||(c=e("#"+a.replace(e.jstree.idregex,"\\$\x26"),this.element)).length)&&this._model.data[c.closest("li").attr("id")])a=this._model.data[c.closest("li").attr("id")];else if((c=e(a,this.element)).length&&c.hasClass("jstree"))a=this._model.data["#"];else return!1;b&&(a="#"===a.id?this.element:e("#"+a.id.replace(e.jstree.idregex,"\\$\x26"),this.element));return a}catch(d){return!1}},get_path:function(a,b,c){a=a.parents?a:this.get_node(a);if(!a||"#"===a.id||!a.parents)return!1;var d,f,h=[];h.push(c?a.id:a.text);d=0;for(f=a.parents.length;d<f;d++)h.push(c?a.parents[d]:this.get_text(a.parents[d]));h=h.reverse().slice(1);return b?h.join(b):h},get_next_dom:function(a,b){var c;a=this.get_node(a,!0);return a[0]===this.element[0]?(c=this._firstChild(this.get_container_ul()[0]))?e(c):!1:a&&a.length?b?(c=this._nextSibling(a[0]))?e(c):!1:a.hasClass("jstree-open")?(c=this._firstChild(a.children("ul")[0]))?e(c):!1:null!==(c=this._nextSibling(a[0]))?e(c):a.parentsUntil(".jstree","li").next("li").eq(0):!1},get_prev_dom:function(a,b){a=this.get_node(a,!0);if(a[0]===this.element[0])return(b=this.get_container_ul()[0].lastChild)?e(b):!1;if(!a||!a.length)return!1;if(b)return(b=this._previousSibling(a[0]))?e(b):!1;if(null!==(b=this._previousSibling(a[0]))){for(a=e(b);a.hasClass("jstree-open");)a=a.children("ul:eq(0)").children("li:last");return a}return(b=a[0].parentNode.parentNode)&&"LI"===b.tagName?e(b):!1},get_parent:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.parent:!1},get_children_dom:function(a){a=this.get_node(a,!0);return a[0]===this.element[0]?this.get_container_ul().children("li"):a&&a.length?a.children("ul").children("li"):!1},is_parent:function(a){return(a=this.get_node(a))&&(!1===a.state.loaded||0<a.children.length)},is_loaded:function(a){return(a=this.get_node(a))&&a.state.loaded},is_loading:function(a){return(a=this.get_node(a))&&a.state&&a.state.loading},is_open:function(a){return(a=this.get_node(a))&&a.state.opened},is_closed:function(a){return(a=this.get_node(a))&&this.is_parent(a)&&!a.state.opened},is_leaf:function(a){return!this.is_parent(a)},load_node:function(a,b){var c,d,f,h,g;if(e.isArray(a)){a=a.slice();c=0;for(d=a.length;c<d;c++)this.load_node(a[c],b);return!0}a=this.get_node(a);if(!a)return b&&b.call(this,a,!1),!1;if(a.state.loaded){a.state.loaded=!1;c=0;for(d=a.children_d.length;c<d;c++){f=0;for(h=a.parents.length;f<h;f++)this._model.data[a.parents[f]].children_d=e.vakata.array_remove_item(this._model.data[a.parents[f]].children_d,a.children_d[c]);this._model.data[a.children_d[c]].state.selected&&(g=!0,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,a.children_d[c]));delete this._model.data[a.children_d[c]]}a.children=[];a.children_d=[];g&&this.trigger("changed",{action:"load_node",node:a,selected:this._data.core.selected})}a.state.loading=!0;this.get_node(a,!0).addClass("jstree-loading");this._load_node(a,e.proxy(function(c){a.state.loading=!1;a.state.loaded=c;var d=this.get_node(a,!0);a.state.loaded&&!a.children.length&&d&&d.length&&!d.hasClass("jstree-leaf")&&d.removeClass("jstree-closed jstree-open").addClass("jstree-leaf");d.removeClass("jstree-loading");this.trigger("load_node",{node:a,status:c});b&&b.call(this,a,c)},this));return!0},_load_node:function(a,b){var c=this.settings.core.data;if(!c)return b.call(this,"#"===a.id?this._append_html_data(a,this._data.core.original_container_html.clone(!0)):!1);if(e.isFunction(c))return c.call(this,a,e.proxy(function(c){return!1===c?b.call(this,!1):b.call(this,this["string"===typeof c?"_append_html_data":"_append_json_data"](a,"string"===typeof c?e(c):c))},this));if("object"===typeof c){if(c.url)return c=e.extend(!0,{},c),e.isFunction(c.url)&&(c.url=c.url.call(this,a)),e.isFunction(c.data)&&(c.data=c.data.call(this,a)),e.ajax(c).done(e.proxy(function(c,f,h){f=h.getResponseHeader("Content-Type");if(-1!==f.indexOf("json")||"object"===typeof c)return b.call(this,this._append_json_data(a,c));if(-1!==f.indexOf("html")||"string"===typeof c)return b.call(this,this._append_html_data(a,e(c)));this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:h})};return b.call(this,!1)},this)).fail(e.proxy(function(c){b.call(this,!1);this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:c})};this.settings.core.error.call(this,this._data.core.last_error)},this));c=e.isArray(c)||e.isPlainObject(c)?JSON.parse(JSON.stringify(c)):c;"#"!==a.id&&(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:a.id})});return b.call(this,"#"===a.id?this._append_json_data(a,c):!1)}return"string"===typeof c?("#"!==a.id&&(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:a.id})}),b.call(this,"#"===a.id?this._append_html_data(a,e(c)):!1)):b.call(this,!1)},_node_changed:function(a){(a=this.get_node(a))&&this._model.changed.push(a.id)},_append_html_data:function(a,b){a=this.get_node(a);a.children=[];a.children_d=[];b=b.is("ul")?b.children():b;var c=a.id,d=[],f=[],h=this._model.data,g=h[c];a=this._data.core.selected.length;var k,l;b.each(e.proxy(function(a,b){if(k=this._parse_model_from_html(e(b),c,g.parents.concat()))d.push(k),f.push(k),h[k].children_d.length&&(f=f.concat(h[k].children_d))},this));g.children=d;g.children_d=f;b=0;for(l=g.parents.length;b<l;b++)h[g.parents[b]].children_d=h[g.parents[b]].children_d.concat(f);this.trigger("model",{nodes:f,parent:c});"#"!==c?(this._node_changed(c),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0));this._data.core.selected.length!==a&&this.trigger("changed",{action:"model",selected:this._data.core.selected});return!0},_append_json_data:function(a,b){a=this.get_node(a);a.children=[];a.children_d=[];a=a.id;var c=[],d=[],f=this._model.data,h=f[a],g=this._data.core.selected.length,k,l,m;b.d&&(b=b.d,"string"===typeof b&&(b=JSON.parse(b)));common.log("---"+b.length);for(l=0;l<b.length;l++)common.log("-1--"+("true"==b[l].children)),"true"==b[l].children?b[l].children=!0:"false"==b[l].children&&(b[l].children=!1);e.isArray(b)||(b=[b]);if(b.length&&b[0].id!==q&&b[0].parent!==q){l=0;for(m=b.length;l<m;l++)b[l].children||(b[l].children=[]),f[b[l].id.toString()]=b[l];l=0;for(m=b.length;l<m;l++)f[b[l].parent.toString()].children.push(b[l].id.toString()),h.children_d.push(b[l].id.toString());l=0;for(m=h.children.length;l<m;l++)k=this._parse_model_from_flat_json(f[h.children[l]],a,h.parents.concat()),d.push(k),f[k].children_d.length&&(d=d.concat(f[k].children_d))}else{l=0;for(m=b.length;l<m;l++)if(k=this._parse_model_from_json(b[l],a,h.parents.concat()))c.push(k),d.push(k),f[k].children_d.length&&(d=d.concat(f[k].children_d));h.children=c;h.children_d=d;l=0;for(m=h.parents.length;l<m;l++)f[h.parents[l]].children_d=f[h.parents[l]].children_d.concat(d)}this.trigger("model",{nodes:d,parent:a});"#"!==a?(this._node_changed(a),this.redraw()):this.redraw(!0);this._data.core.selected.length!==g&&this.trigger("changed",{action:"model",selected:this._data.core.selected});return!0},_parse_model_from_html:function(a,b,c){c=c?[].concat(c):[];b&&c.unshift(b);var d,f,h=this._model.data,g={id:!1,text:!1,icon:!0,parent:b,parents:c,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},k;for(k in this._model.default_state)this._model.default_state.hasOwnProperty(k)&&(g.state[k]=this._model.default_state[k]);b=e.vakata.attributes(a,!0);e.each(b,function(a,c){c=e.trim(c);if(!c.length)return!0;g.li_attr[a]=c;"id"===a&&(g.id=c.toString())});b=a.children("a").eq(0);b.length&&(b=e.vakata.attributes(b,!0),e.each(b,function(a,c){c=e.trim(c);c.length&&(g.a_attr[a]=c)}));b=a.children("a:eq(0)").length?a.children("a:eq(0)").clone():a.clone();b.children("ins, i, ul").remove();b=b.html();b=e("\x3cdiv /\x3e").html(b);g.text=b.html();b=a.data();g.data=b?e.extend(!0,{},b):null;g.state.opened=a.hasClass("jstree-open");g.state.selected=a.children("a").hasClass("jstree-clicked");g.state.disabled=a.children("a").hasClass("jstree-disabled");if(g.data&&g.data.jstree)for(k in g.data.jstree)g.data.jstree.hasOwnProperty(k)&&(g.state[k]=g.data.jstree[k]);b=a.children("a").children(".jstree-themeicon");b.length&&(g.icon=b.hasClass("jstree-themeicon-hidden")?!1:b.attr("rel"));g.state.icon&&(g.icon=g.state.icon);b=a.children("ul").children("li");do k="j"+this._id+"_"+ ++this._cnt;while(h[k]);g.id=g.li_attr.id?g.li_attr.id.toString():k;b.length?(b.each(e.proxy(function(a,b){d=this._parse_model_from_html(e(b),g.id,c);f=this._model.data[d];g.children.push(d);f.children_d.length&&(g.children_d=g.children_d.concat(f.children_d))},this)),g.children_d=g.children_d.concat(g.children)):a.hasClass("jstree-closed")&&(g.state.loaded=!1);g.li_attr["class"]&&(g.li_attr["class"]=g.li_attr["class"].replace("jstree-closed","").replace("jstree-open",""));g.a_attr["class"]&&(g.a_attr["class"]=g.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled",""));h[g.id]=g;g.state.selected&&this._data.core.selected.push(g.id);return g.id},_parse_model_from_flat_json:function(a,b,c){c=c?c.concat():[];b&&c.unshift(b);var d=a.id.toString(),f=this._model.data,h=this._model.default_state,g,e;b={id:d,text:a.text||"",icon:a.icon!==q?a.icon:!0,parent:b,parents:c,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(g in h)h.hasOwnProperty(g)&&(b.state[g]=h[g]);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(b.icon=a.data.jstree.icon);if(a&&a.data&&(b.data=a.data,a.data.jstree))for(g in a.data.jstree)a.data.jstree.hasOwnProperty(g)&&(b.state[g]=a.data.jstree[g]);if(a&&"object"===typeof a.state)for(g in a.state)a.state.hasOwnProperty(g)&&(b.state[g]=a.state[g]);if(a&&"object"===typeof a.li_attr)for(g in a.li_attr)a.li_attr.hasOwnProperty(g)&&(b.li_attr[g]=a.li_attr[g]);b.li_attr.id||(b.li_attr.id=d);if(a&&"object"===typeof a.a_attr)for(g in a.a_attr)a.a_attr.hasOwnProperty(g)&&(b.a_attr[g]=a.a_attr[g]);a&&a.children&&!0===a.children&&(b.state.loaded=!1,b.children=[],b.children_d=[]);f[b.id]=b;g=0;for(d=b.children.length;g<d;g++)h=this._parse_model_from_flat_json(f[b.children[g]],b.id,c),e=f[h],b.children_d.push(h),e.children_d.length&&(b.children_d=b.children_d.concat(e.children_d));delete a.data;delete a.children;f[b.id].original=a;b.state.selected&&this._data.core.selected.push(b.id);return b.id},_parse_model_from_json:function(a,b,c){c=c?c.concat():[];b&&c.unshift(b);var d,f,h,g,e=this._model.data;h=this._model.default_state;do d="j"+this._id+"_"+ ++this._cnt;while(e[d]);b={id:!1,text:"string"===typeof a?a:"",icon:"object"===typeof a&&a.icon!==q?a.icon:!0,parent:b,parents:c,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(f in h)h.hasOwnProperty(f)&&(b.state[f]=h[f]);a&&a.id&&(b.id=a.id.toString());a&&a.text&&(b.text=a.text);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(b.icon=a.data.jstree.icon);if(a&&a.data&&(b.data=a.data,a.data.jstree))for(f in a.data.jstree)a.data.jstree.hasOwnProperty(f)&&(b.state[f]=a.data.jstree[f]);if(a&&"object"===typeof a.state)for(f in a.state)a.state.hasOwnProperty(f)&&(b.state[f]=a.state[f]);if(a&&"object"===typeof a.li_attr)for(f in a.li_attr)a.li_attr.hasOwnProperty(f)&&(b.li_attr[f]=a.li_attr[f]);b.li_attr.id&&!b.id&&(b.id=b.li_attr.id.toString());b.id||(b.id=d);b.li_attr.id||(b.li_attr.id=b.id);if(a&&"object"===typeof a.a_attr)for(f in a.a_attr)a.a_attr.hasOwnProperty(f)&&(b.a_attr[f]=a.a_attr[f]);if(a&&a.children&&a.children.length){f=0;for(d=a.children.length;f<d;f++)h=this._parse_model_from_json(a.children[f],b.id,c),g=e[h],b.children.push(h),g.children_d.length&&(b.children_d=b.children_d.concat(g.children_d));b.children_d=b.children_d.concat(b.children)}a&&a.children&&!0===a.children&&(b.state.loaded=!1,b.children=[],b.children_d=[]);delete a.data;delete a.children;b.original=a;e[b.id]=b;b.state.selected&&this._data.core.selected.push(b.id);return b.id},_redraw:function(){var a=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),b=document.createElement("UL"),c,d,f;d=0;for(f=a.length;d<f;d++)(c=this.redraw_node(a[d],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&b.appendChild(c);this._model.force_full_redraw&&(b.className=this.get_container_ul()[0].className,this.element.empty().append(b));this._model.force_full_redraw=!1;this._model.changed=[];this.trigger("redraw",{nodes:a})},redraw:function(a){a&&(this._model.force_full_redraw=!0);this._redraw()},redraw_node:function(a,b,c){var d=this.get_node(a),f=!1,h=!1,g=!1,k=!1,l=!1,m=!1,m="",n=document,p=this._model.data,r=!1,u=!1;if(!d)return!1;if("#"===d.id)return this.redraw(!0);b=b||0===d.children.length;if(a=this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(d.id[0])?"\\3"+d.id[0]+" "+d.id.substr(1).replace(e.jstree.idregex,"\\$\x26"):d.id.replace(e.jstree.idregex,"\\$\x26"))))a=e(a),c||(f=a.parent().parent()[0],f===this.element[0]&&(f=null),h=a.index()),b||!d.children.length||a.children("ul").length||(b=!0),b||(g=a.children("UL")[0]),u=a.attr("aria-selected"),r=a.children(".jstree-anchor")[0]===document.activeElement,a.remove();else if(b=!0,!c){f="#"!==d.parent?e("#"+d.parent.replace(e.jstree.idregex,"\\$\x26"),this.element)[0]:null;if(!(null===f||f&&p[d.parent].state.opened))return!1;h=e.inArray(d.id,null===f?p["#"].children:p[d.parent].children)}a=F.cloneNode(!0);m="jstree-node ";for(k in d.li_attr)d.li_attr.hasOwnProperty(k)&&"id"!==k&&("class"!==k?a.setAttribute(k,d.li_attr[k]):m+=d.li_attr[k]);u&&"false"!==u&&a.setAttribute("aria-selected",!0);d.state.loaded&&!d.children.length?m+=" jstree-leaf":(m+=d.state.opened&&d.state.loaded?" jstree-open":" jstree-closed",a.setAttribute("aria-expanded",d.state.opened&&d.state.loaded));null!==d.parent&&p[d.parent].children[p[d.parent].children.length-1]===d.id&&(m+=" jstree-last");a.id=d.id;a.className=m;m=(d.state.selected?" jstree-clicked":"")+(d.state.disabled?" jstree-disabled":"");for(l in d.a_attr)!d.a_attr.hasOwnProperty(l)||"href"===l&&"#"===d.a_attr[l]||("class"!==l?a.childNodes[1].setAttribute(l,d.a_attr[l]):m+=" "+d.a_attr[l]);m.length&&(a.childNodes[1].className="jstree-anchor "+m);if(d.icon&&!0!==d.icon||!1===d.icon)!1===d.icon?a.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===d.icon.indexOf("/")&&-1===d.icon.indexOf(".")?a.childNodes[1].childNodes[0].className+=" "+d.icon+" jstree-themeicon-custom":(a.childNodes[1].childNodes[0].style.backgroundImage="url("+d.icon+")",a.childNodes[1].childNodes[0].style.backgroundPosition="center center",a.childNodes[1].childNodes[0].style.backgroundSize="auto",a.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom");a.childNodes[1].innerHTML+=d.text;if(b&&d.children.length&&d.state.opened&&d.state.loaded){m=n.createElement("UL");m.setAttribute("role","group");m.className="jstree-children";k=0;for(l=d.children.length;k<l;k++)m.appendChild(this.redraw_node(d.children[k],b,!0));a.appendChild(m)}g&&a.appendChild(g);c||(f||(f=this.element[0]),f.getElementsByTagName("UL").length?f=f.getElementsByTagName("UL")[0]:(k=n.createElement("UL"),k.setAttribute("role","group"),k.className="jstree-children",f.appendChild(k),f=k),h<f.childNodes.length?f.insertBefore(a,f.childNodes[h]):f.appendChild(a),r&&a.childNodes[1].focus());d.state.opened&&!d.state.loaded&&(d.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(d.id,!1,0)},this),0));return a},open_node:function(a,b,c){var d,f,h;if(e.isArray(a)){a=a.slice();d=0;for(f=a.length;d<f;d++)this.open_node(a[d],b,c);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;c=c===q?this.settings.core.animation:c;if(!this.is_closed(a))return b&&b.call(this,a,!1),!1;if(this.is_loaded(a))d=this.get_node(a,!0),h=this,d.length&&(a.children.length&&!this._firstChild(d.children("ul")[0])&&(a.state.opened=!0,this.redraw_node(a,!0),d=this.get_node(a,!0)),c?(this.trigger("before_open",{node:a}),d.children("ul").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children("ul").stop(!0,!0).slideDown(c,function(){this.style.display="";h.trigger("after_open",{node:a})})):(this.trigger("before_open",{node:a}),d[0].className=d[0].className.replace("jstree-closed","jstree-open"),d[0].setAttribute("aria-expanded",!0))),a.state.opened=!0,b&&b.call(this,a,!0),d.length||this.trigger("before_open",{node:a}),this.trigger("open_node",{node:a}),c&&d.length||this.trigger("after_open",{node:a});else{if(this.is_loading(a))return setTimeout(e.proxy(function(){this.open_node(a,b,c)},this),500);this.load_node(a,function(a,d){return d?this.open_node(a,b,c):b?b.call(this,a,!1):!1})}},_open_to:function(a){a=this.get_node(a);if(!a||"#"===a.id)return!1;var b,c,d=a.parents;b=0;for(c=d.length;b<c;b+=1)"#"!==b&&this.open_node(d[b],!1,0);return e("#"+a.id.replace(e.jstree.idregex,"\\$\x26"),this.element)},close_node:function(a,b){var c,d,f,h;if(e.isArray(a)){a=a.slice();c=0;for(d=a.length;c<d;c++)this.close_node(a[c],b);return!0}a=this.get_node(a);if(!a||"#"===a.id||this.is_closed(a))return!1;b=b===q?this.settings.core.animation:b;f=this;h=this.get_node(a,!0);h.length&&(b?h.children("ul").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children("ul").stop(!0,!0).slideUp(b,function(){this.style.display="";h.children("ul").remove();f.trigger("after_close",{node:a})}):(h[0].className=h[0].className.replace("jstree-open","jstree-closed"),h.attr("aria-expanded",!1).children("ul").remove()));a.state.opened=!1;this.trigger("close_node",{node:a});b&&h.length||this.trigger("after_close",{node:a})},toggle_node:function(a){var b,c;if(e.isArray(a)){a=a.slice();b=0;for(c=a.length;b<c;b++)this.toggle_node(a[b]);return!0}if(this.is_closed(a))return this.open_node(a);if(this.is_open(a))return this.close_node(a)},open_all:function(a,b,c){a||(a="#");a=this.get_node(a);if(!a)return!1;var d="#"===a.id?this.get_container_ul():this.get_node(a,!0),f,h;if(!d.length){d=0;for(f=a.children_d.length;d<f;d++)this.is_closed(this._model.data[a.children_d[d]])&&(this._model.data[a.children_d[d]].state.opened=!0);return this.trigger("open_all",{node:a})}c=c||d;h=this;d=this.is_closed(a)?d.find("li.jstree-closed").addBack():d.find("li.jstree-closed");d.each(function(){h.open_node(this,function(a,d){d&&this.is_parent(a)&&this.open_all(a,b,c)},b||0)});0===c.find("li.jstree-closed").length&&this.trigger("open_all",{node:this.get_node(c)})},close_all:function(a,b){a||(a="#");a=this.get_node(a);if(!a)return!1;var c="#"===a.id?this.get_container_ul():this.get_node(a,!0),d=this,f;if(!c.length){c=0;for(f=a.children_d.length;c<f;c++)this._model.data[a.children_d[c]].state.opened=!1;return this.trigger("close_all",{node:a})}c=this.is_open(a)?c.find("li.jstree-open").addBack():c.find("li.jstree-open");c.vakata_reverse().each(function(){d.close_node(this,b||0)});this.trigger("close_all",{node:a})},is_disabled:function(a){return(a=this.get_node(a))&&a.state&&a.state.disabled},enable_node:function(a){var b,c;if(e.isArray(a)){a=a.slice();b=0;for(c=a.length;b<c;b++)this.enable_node(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.state.disabled=!1;this.get_node(a,!0).children(".jstree-anchor").removeClass("jstree-disabled");this.trigger("enable_node",{node:a})},disable_node:function(a){var b,c;if(e.isArray(a)){a=a.slice();b=0;for(c=a.length;b<c;b++)this.disable_node(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.state.disabled=!0;this.get_node(a,!0).children(".jstree-anchor").addClass("jstree-disabled");this.trigger("disable_node",{node:a})},activate_node:function(a,b){if(this.is_disabled(a))return!1;this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==q?this.get_node(this._data.core.last_clicked.id):null;this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null);!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1]));if(this.settings.core.multiple&&(b.metaKey||b.ctrlKey||b.shiftKey)&&(!b.shiftKey||this._data.core.last_clicked&&this.get_parent(a)&&this.get_parent(a)===this._data.core.last_clicked.parent))if(b.shiftKey){var c=this.get_node(a).id,d=this._data.core.last_clicked.id,f=this.get_node(this._data.core.last_clicked.parent).children,h=!1,g,e;g=0;for(e=f.length;g<e;g+=1)f[g]===c&&(h=!h),f[g]===d&&(h=!h),h||f[g]===c||f[g]===d?this.select_node(f[g],!1,!1,b):this.deselect_node(f[g],!1,!1,b)}else this.is_selected(a)?this.deselect_node(a,!1,!1,b):this.select_node(a,!1,!1,b);else!this.settings.core.multiple&&(b.metaKey||b.ctrlKey||b.shiftKey)&&this.is_selected(a)?this.deselect_node(a,!1,!1,b):(this.deselect_all(!0),this.select_node(a,!1,!1,b),this._data.core.last_clicked=this.get_node(a));this.trigger("activate_node",{node:this.get_node(a)})},hover_node:function(a){a=this.get_node(a,!0);if(!a||!a.length||a.children(".jstree-hovered").length)return!1;var b=this.element.find(".jstree-hovered"),c=this.element;b&&b.length&&this.dehover_node(b);a.children(".jstree-anchor").addClass("jstree-hovered");this.trigger("hover_node",{node:this.get_node(a)});setTimeout(function(){c.attr("aria-activedescendant",a[0].id);a.attr("aria-selected",!0)},0)},dehover_node:function(a){a=this.get_node(a,!0);if(!a||!a.length||!a.children(".jstree-hovered").length)return!1;a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-hovered");this.trigger("dehover_node",{node:this.get_node(a)})},select_node:function(a,b,c,d){var f,h;if(e.isArray(a)){a=a.slice();f=0;for(h=a.length;f<h;f++)this.select_node(a[f],b,c,d);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;f=this.get_node(a,!0);a.state.selected||(a.state.selected=!0,this._data.core.selected.push(a.id),c||(f=this._open_to(a)),f&&f.length&&f.children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:a,selected:this._data.core.selected,event:d}),b||this.trigger("changed",{action:"select_node",node:a,selected:this._data.core.selected,event:d}))},deselect_node:function(a,b,c){var d,f;if(e.isArray(a)){a=a.slice();d=0;for(f=a.length;d<f;d++)this.deselect_node(a[d],b,c);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;d=this.get_node(a,!0);a.state.selected&&(a.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,a.id),d.length&&d.children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:a,selected:this._data.core.selected,event:c}),b||this.trigger("changed",{action:"deselect_node",node:a,selected:this._data.core.selected,event:c}))},select_all:function(a){var b=this._data.core.selected.concat([]),c,d;this._data.core.selected=this._model.data["#"].children_d.concat();c=0;for(d=this._data.core.selected.length;c<d;c++)this._model.data[this._data.core.selected[c]]&&(this._model.data[this._data.core.selected[c]].state.selected=!0);this.redraw(!0);this.trigger("select_all",{selected:this._data.core.selected});a||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:b})},deselect_all:function(a){var b=this._data.core.selected.concat([]),c,d;c=0;for(d=this._data.core.selected.length;c<d;c++)this._model.data[this._data.core.selected[c]]&&(this._model.data[this._data.core.selected[c]].state.selected=!1);this._data.core.selected=[];this.element.find(".jstree-clicked").removeClass("jstree-clicked");this.trigger("deselect_all",{selected:this._data.core.selected,node:b});a||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:b})},is_selected:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.state.selected:!1},get_selected:function(a){return a?e.map(this._data.core.selected,e.proxy(function(a){return this.get_node(a)},this)):this._data.core.selected},get_top_selected:function(a){var b=this.get_selected(!0),c={},d,f,h,g;d=0;for(f=b.length;d<f;d++)c[b[d].id]=b[d];d=0;for(f=b.length;d<f;d++)for(h=0,g=b[d].children_d.length;h<g;h++)c[b[d].children_d[h]]&&delete c[b[d].children_d[h]];b=[];for(d in c)c.hasOwnProperty(d)&&b.push(d);return a?e.map(b,e.proxy(function(a){return this.get_node(a)},this)):b},get_bottom_selected:function(a){var b=this.get_selected(!0),c=[],d,f;d=0;for(f=b.length;d<f;d++)b[d].children.length||c.push(b[d].id);return a?e.map(c,e.proxy(function(a){return this.get_node(a)},this)):c},get_state:function(){var a={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}},b;for(b in this._model.data)this._model.data.hasOwnProperty(b)&&"#"!==b&&(this._model.data[b].state.opened&&a.core.open.push(b),this._model.data[b].state.selected&&a.core.selected.push(b));return a},set_state:function(a,b){if(a){if(a.core){var c,d,f,h;if(a.core.open){if(!e.isArray(a.core.open))return delete a.core.open,this.set_state(a,b),!1;c=!0;d=!1;f=this;e.each(a.core.open.concat([]),function(g,h){if(d=f.get_node(h))f.is_loaded(h)?(f.is_closed(h)&&f.open_node(h,!1,0),a&&a.core&&a.core.open&&e.vakata.array_remove_item(a.core.open,h)):(f.is_loading(h)||f.open_node(h,e.proxy(function(c,d){!d&&a&&a.core&&a.core.open&&e.vakata.array_remove_item(a.core.open,c.id);this.set_state(a,b)},f),0),c=!1)});c&&(delete a.core.open,this.set_state(a,b));return!1}if(a.core.scroll)return a.core.scroll&&a.core.scroll.left!==q&&this.element.scrollLeft(a.core.scroll.left),a.core.scroll&&a.core.scroll.top!==q&&this.element.scrollTop(a.core.scroll.top),delete a.core.scroll,this.set_state(a,b),!1;if(a.core.selected)return h=this,this.deselect_all(),e.each(a.core.selected,function(a,c){h.select_node(c)}),delete a.core.selected,this.set_state(a,b),!1;if(e.isEmptyObject(a.core))return delete a.core,this.set_state(a,b),!1}return e.isEmptyObject(a)?(a=null,b&&b.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(a){this._data.core.state=this.get_state();this._cnt=0;this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var b=this.get_container_ul()[0].className;a||this.element.html("\x3cul class\x3d'jstree-container-ul'\x3e\x3cli class\x3d'jstree-initial-node jstree-loading jstree-leaf jstree-last'\x3e\x3ci class\x3d'jstree-icon jstree-ocl'\x3e\x3c/i\x3e\x3ca class\x3d'jstree-anchor' href\x3d'#'\x3e\x3ci class\x3d'jstree-icon jstree-themeicon-hidden'\x3e\x3c/i\x3e"+this.get_string("Loading ...")+"\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e");this.load_node("#",function(a,d){d&&(this.get_container_ul()[0].className=b,this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")}));this._data.core.state=null})},set_id:function(a,b){a=this.get_node(a);if(!a||"#"===a.id)return!1;var c,d,f=this._model.data;b=b.toString();f[a.parent].children[e.inArray(a.id,f[a.parent].children)]=b;c=0;for(d=a.parents.length;c<d;c++)f[a.parents[c]].children_d[e.inArray(a.id,f[a.parents[c]].children_d)]=b;c=0;for(d=a.children.length;c<d;c++)f[a.children[c]].parent=b;c=0;for(d=a.children_d.length;c<d;c++)f[a.children_d[c]].parents[e.inArray(a.id,f[a.children_d[c]].parents)]=b;c=e.inArray(a.id,this._data.core.selected);-1!==c&&(this._data.core.selected[c]=b);(c=this.get_node(a.id,!0))&&c.attr("id",b);delete f[a.id];a.id=b;f[b]=a;return!0},get_text:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.text:!1},set_text:function(a,b){var c,d;if(e.isArray(a)){a=a.slice();c=0;for(d=a.length;c<d;c++)this.set_text(a[c],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.text=b;c=this.get_node(a,!0);c.length&&(c=c.children(".jstree-anchor:eq(0)"),d=c.children("I").clone(),c.html(b).prepend(d),this.trigger("set_text",{obj:a,text:b}));return!0},get_json:function(a,b,c){a=this.get_node(a||"#");if(!a)return!1;b&&b.flat&&!c&&(c=[]);var d={id:a.id,text:a.text,icon:this.get_icon(a),li_attr:a.li_attr,a_attr:a.a_attr,state:{},data:b&&b.no_data?!1:a.data},f,h;b&&b.flat?d.parent=a.parent:d.children=[];if(!b||!b.no_state)for(f in a.state)a.state.hasOwnProperty(f)&&(d.state[f]=a.state[f]);b&&b.no_id&&(delete d.id,d.li_attr&&d.li_attr.id&&delete d.li_attr.id);b&&b.flat&&"#"!==a.id&&c.push(d);if(!b||!b.no_children)for(f=0,h=a.children.length;f<h;f++)b&&b.flat?this.get_json(a.children[f],b,c):d.children.push(this.get_json(a.children[f],b));return b&&b.flat?c:"#"===a.id?d.children:d},create_node:function(a,b,c,d,f){null===a&&(a="#");a=this.get_node(a);if(!a)return!1;c=c===q?"last":c;if(!c.toString().match(/^(before|after)$/)&&!f&&!this.is_loaded(a))return this.load_node(a,function(){this.create_node(a,b,c,d,!0)});b||(b={text:this.get_string("New node")});b.text===q&&(b.text=this.get_string("New node"));var h,g,k;"#"===a.id&&("before"===c&&(c="first"),"after"===c&&(c="last"));switch(c){case "before":f=this.get_node(a.parent);c=e.inArray(a.id,f.children);a=f;break;case "after":f=this.get_node(a.parent);c=e.inArray(a.id,f.children)+1;a=f;break;case "inside":case "first":c=0;break;case "last":c=a.children.length;break;default:c||(c=0)}c>a.children.length&&(c=a.children.length);b.id||(b.id=!0);if(!this.check("create_node",b,a,c))return this.settings.core.error.call(this,this._data.core.last_error),!1;!0===b.id&&delete b.id;b=this._parse_model_from_json(b,a.id,a.parents.concat());if(!b)return!1;f=this.get_node(b);h=[];h.push(b);h=h.concat(f.children_d);this.trigger("model",{nodes:h,parent:a.id});a.children_d=a.children_d.concat(h);g=0;for(k=a.parents.length;g<k;g++)this._model.data[a.parents[g]].children_d=this._model.data[a.parents[g]].children_d.concat(h);b=f;f=[];g=0;for(k=a.children.length;g<k;g++)f[g>=c?g+1:g]=a.children[g];f[c]=b.id;a.children=f;this.redraw_node(a,!0);d&&d.call(this,this.get_node(b));this.trigger("create_node",{node:this.get_node(b),parent:a.id,position:c});return b.id},rename_node:function(a,b){var c,d;if(e.isArray(a)){a=a.slice();c=0;for(d=a.length;c<d;c++)this.rename_node(a[c],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;c=a.text;if(!this.check("rename_node",a,this.get_parent(a),b))return this.settings.core.error.call(this,this._data.core.last_error),!1;this.set_text(a,b);this.trigger("rename_node",{node:a,text:b,old:c});return!0},delete_node:function(a){var b,c,d,f,h,g,k,l;if(e.isArray(a)){a=a.slice();b=0;for(c=a.length;b<c;b++)this.delete_node(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;b=this.get_node(a.parent);c=e.inArray(a.id,b.children);l=!1;if(!this.check("delete_node",a,b,c))return this.settings.core.error.call(this,this._data.core.last_error),!1;-1!==c&&(b.children=e.vakata.array_remove(b.children,c));d=a.children_d.concat([]);d.push(a.id);g=0;for(k=d.length;g<k;g++){f=0;for(h=a.parents.length;f<h;f++)c=e.inArray(d[g],this._model.data[a.parents[f]].children_d),-1!==c&&(this._model.data[a.parents[f]].children_d=e.vakata.array_remove(this._model.data[a.parents[f]].children_d,c));this._model.data[d[g]].state.selected&&(l=!0,c=e.inArray(d[g],this._data.core.selected),-1!==c&&(this._data.core.selected=e.vakata.array_remove(this._data.core.selected,c)))}this.trigger("delete_node",{node:a,parent:b.id});l&&this.trigger("changed",{action:"delete_node",node:a,selected:this._data.core.selected,parent:b.id});g=0;for(k=d.length;g<k;g++)delete this._model.data[d[g]];this.redraw_node(b,!0);return!0},check:function(a,b,c,d,f){b=b&&b.id?b:this.get_node(b);c=c&&c.id?c:this.get_node(c);var h=a.match(/^move_node|copy_node|create_node$/i)?c:b,g=this.settings.core.check_callback;if("move_node"===a&&(b.id===c.id||e.inArray(b.id,c.children)===d||-1!==e.inArray(c.id,b.children_d)))return this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:a,pos:d,obj:b&&b.id?b.id:!1,par:c&&c.id?c.id:!1})},!1;h=this.get_node(h,!0);h.length&&(h=h.data("jstree"));return h&&h.functions&&(!1===h.functions[a]||!0===h.functions[a])?(!1===h.functions[a]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+a,data:JSON.stringify({chk:a,pos:d,obj:b&&b.id?b.id:!1,par:c&&c.id?c.id:!1})}),h.functions[a]):!1===g||e.isFunction(g)&&!1===g.call(this,a,b,c,d,f)||g&&!1===g[a]?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+a,data:JSON.stringify({chk:a,pos:d,obj:b&&b.id?b.id:!1,par:c&&c.id?c.id:!1})},!1):!0},last_error:function(){return this._data.core.last_error},move_node:function(a,b,c,d,f){var h,g,k,l,m,n,p,r,u,v;if(e.isArray(a)){a=a.reverse().slice();h=0;for(g=a.length;h<g;h++)this.move_node(a[h],b,c,d,f);return!0}a=a&&a.id?a:this.get_node(a);b=this.get_node(b);c=c===q?0:c;if(!b||!a||"#"===a.id)return!1;if(!c.toString().match(/^(before|after)$/)&&!f&&!this.is_loaded(b))return this.load_node(b,function(){this.move_node(a,b,c,d,!0)});h=(a.parent||"#").toString();g=c.toString().match(/^(before|after)$/)&&"#"!==b.id?this.get_node(b.parent):b;k=this._model.data[a.id]?this:e.jstree.reference(a.id);if(l=!k||!k._id||this._id!==k._id)return this.copy_node(a,b,c,d,f)?(k&&k.delete_node(a),!0):!1;"#"===g.id&&("before"===c&&(c="first"),"after"===c&&(c="last"));switch(c){case "before":c=e.inArray(b.id,g.children);break;case "after":c=e.inArray(b.id,g.children)+1;break;case "inside":case "first":c=0;break;case "last":c=g.children.length;break;default:c||(c=0)}c>g.children.length&&(c=g.children.length);if(!this.check("move_node",a,g,c))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(a.parent===g.id){f=g.children.concat();m=e.inArray(a.id,f);-1!==m&&(f=e.vakata.array_remove(f,m),c>m&&c--);m=[];n=0;for(p=f.length;n<p;n++)m[n>=c?n+1:n]=f[n];m[c]=a.id;g.children=m;this._node_changed(g.id);this.redraw("#"===g.id)}else{m=a.children_d.concat();m.push(a.id);n=0;for(p=a.parents.length;n<p;n++){f=[];v=k._model.data[a.parents[n]].children_d;r=0;for(u=v.length;r<u;r++)-1===e.inArray(v[r],m)&&f.push(v[r]);k._model.data[a.parents[n]].children_d=f}k._model.data[h].children=e.vakata.array_remove_item(k._model.data[h].children,a.id);n=0;for(p=g.parents.length;n<p;n++)this._model.data[g.parents[n]].children_d=this._model.data[g.parents[n]].children_d.concat(m);f=[];n=0;for(p=g.children.length;n<p;n++)f[n>=c?n+1:n]=g.children[n];f[c]=a.id;g.children=f;g.children_d.push(a.id);g.children_d=g.children_d.concat(a.children_d);a.parent=g.id;m=g.parents.concat();m.unshift(g.id);v=a.parents.length;a.parents=m;m=m.concat();n=0;for(p=a.children_d.length;n<p;n++)this._model.data[a.children_d[n]].parents=this._model.data[a.children_d[n]].parents.slice(0,-1*v),Array.prototype.push.apply(this._model.data[a.children_d[n]].parents,m);this._node_changed(h);this._node_changed(g.id);this.redraw("#"===h||"#"===g.id)}d&&d.call(this,a,g,c);this.trigger("move_node",{node:a,parent:g.id,position:c,old_parent:h,is_multi:l,old_instance:k,new_instance:this});return!0},copy_node:function(a,b,c,d,f){var h,g,k,l,m,n,p;if(e.isArray(a)){a=a.reverse().slice();h=0;for(g=a.length;h<g;h++)this.copy_node(a[h],b,c,d,f);return!0}a=a&&a.id?a:this.get_node(a);b=this.get_node(b);c=c===q?0:c;if(!b||!a||"#"===a.id)return!1;if(!c.toString().match(/^(before|after)$/)&&!f&&!this.is_loaded(b))return this.load_node(b,function(){this.copy_node(a,b,c,d,!0)});g=(a.parent||"#").toString();m=c.toString().match(/^(before|after)$/)&&"#"!==b.id?this.get_node(b.parent):b;n=this._model.data[a.id]?this:e.jstree.reference(a.id);p=!n||!n._id||this._id!==n._id;"#"===m.id&&("before"===c&&(c="first"),"after"===c&&(c="last"));switch(c){case "before":c=e.inArray(b.id,m.children);break;case "after":c=e.inArray(b.id,m.children)+1;break;case "inside":case "first":c=0;break;case "last":c=m.children.length;break;default:c||(c=0)}c>m.children.length&&(c=m.children.length);if(!this.check("copy_node",a,m,c))return this.settings.core.error.call(this,this._data.core.last_error),!1;k=n?n.get_json(a,{no_id:!0,no_data:!0,no_state:!0}):a;if(!k)return!1;!0===k.id&&delete k.id;k=this._parse_model_from_json(k,m.id,m.parents.concat());if(!k)return!1;h=this.get_node(k);a&&a.state&&!1===a.state.loaded&&(h.state.loaded=!1);f=[];f.push(k);f=f.concat(h.children_d);this.trigger("model",{nodes:f,parent:m.id});k=0;for(l=m.parents.length;k<l;k++)this._model.data[m.parents[k]].children_d=this._model.data[m.parents[k]].children_d.concat(f);f=[];k=0;for(l=m.children.length;k<l;k++)f[k>=c?k+1:k]=m.children[k];f[c]=h.id;m.children=f;m.children_d.push(h.id);m.children_d=m.children_d.concat(h.children_d);this._node_changed(m.id);this.redraw("#"===m.id);d&&d.call(this,h,m,c);this.trigger("copy_node",{node:h,original:a,parent:m.id,position:c,old_parent:g,is_multi:p,old_instance:n,new_instance:this});return h.id},cut:function(a){a||(a=this._data.core.selected.concat());e.isArray(a)||(a=[a]);if(!a.length)return!1;var b=[],c,d,f;d=0;for(f=a.length;d<f;d++)(c=this.get_node(a[d]))&&c.id&&"#"!==c.id&&b.push(c);if(!b.length)return!1;y=b;E=this;w="move_node";this.trigger("cut",{node:a})},copy:function(a){a||(a=this._data.core.selected.concat());e.isArray(a)||(a=[a]);if(!a.length)return!1;var b=[],c,d,f;d=0;for(f=a.length;d<f;d++)(c=this.get_node(a[d]))&&c.id&&"#"!==c.id&&b.push(c);if(!b.length)return!1;y=b;E=this;w="copy_node";this.trigger("copy",{node:a})},get_buffer:function(){return{mode:w,node:y,inst:E}},can_paste:function(){return!1!==w&&!1!==y},paste:function(a,b){a=this.get_node(a);if(!(a&&w&&w.match(/^(copy_node|move_node)$/)&&y))return!1;this[w](y,a,b)&&this.trigger("paste",{parent:a.id,node:y,mode:w});E=w=y=!1},edit:function(a,b){a=this._open_to(a);if(!a||!a.length)return!1;var c=this._data.core.rtl,d=this.element.width(),f=a.children(".jstree-anchor"),h=e("\x3cspan\x3e"),g="string"===typeof b?b:this.get_text(a),k=e("\x3cdiv /\x3e",{css:{position:"absolute",top:"-200px",left:c?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),l=e("\x3cinput /\x3e",{value:g,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var c=h.children(".jstree-rename-input").val();""===c&&(c=g);k.remove();h.replaceWith(f);h.remove();this.set_text(a,g);!1===this.rename_node(a,c)&&this.set_text(a,g)},this),keydown:function(a){var c=a.which;27===c&&(this.value=g);27!==c&&13!==c&&37!==c&&38!==c&&39!==c&&40!==c&&32!==c||a.stopImmediatePropagation();if(27===c||13===c)a.preventDefault(),this.blur()},click:function(a){a.stopImmediatePropagation()},mousedown:function(a){a.stopImmediatePropagation()},keyup:function(a){l.width(Math.min(k.text("pW"+this.value).width(),d))},keypress:function(a){if(13===a.which)return!1}});b={fontFamily:f.css("fontFamily")||"",fontSize:f.css("fontSize")||"",fontWeight:f.css("fontWeight")||"",fontStyle:f.css("fontStyle")||"",fontStretch:f.css("fontStretch")||"",fontVariant:f.css("fontVariant")||"",letterSpacing:f.css("letterSpacing")||"",wordSpacing:f.css("wordSpacing")||""};this.set_text(a,"");h.attr("class",f.attr("class")).append(f.contents().clone()).append(l);f.replaceWith(h);k.css(b);l.css(b).width(Math.min(k.text("pW"+l[0].value).width(),d))[0].select()},set_theme:function(a,b){if(!a)return!1;!0===b&&((b=this.settings.core.themes.dir)||(b=e.jstree.path+"/themes"),b=b+"/"+a+"/style.css");b&&-1===e.inArray(b,K)&&(e("head").append('\x3clink rel\x3d"stylesheet" href\x3d"'+b+'" type\x3d"text/css" /\x3e'),K.push(b));this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name);this._data.core.themes.name=a;this.element.addClass("jstree-"+a);this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+a+"-responsive");this.trigger("set_theme",{theme:a})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(a){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant);(this._data.core.themes.variant=a)&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0;this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1;this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0;this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1;this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0;this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1;this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(a,b){var c,d;if(e.isArray(a)){a=a.slice();c=0;for(d=a.length;c<d;c++)this.set_icon(a[c],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;d=a.icon;a.icon=b;c=this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon");!1===b?this.hide_icon(a):!0===b?c.removeClass("jstree-themeicon-custom "+d).css("background","").removeAttr("rel"):-1===b.indexOf("/")&&-1===b.indexOf(".")?(c.removeClass(d).css("background",""),c.addClass(b+" jstree-themeicon-custom").attr("rel",b)):(c.removeClass(d).css("background",""),c.addClass("jstree-themeicon-custom").css("background","url('"+b+"') center center no-repeat").attr("rel",b));return!0},get_icon:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.icon:!1},hide_icon:function(a){var b,c;if(e.isArray(a)){a=a.slice();b=0;for(c=a.length;b<c;b++)this.hide_icon(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a)return!1;a.icon=!1;this.get_node(a,!0).children("a").children(".jstree-themeicon").addClass("jstree-themeicon-hidden");return!0},show_icon:function(a){var b,c;if(e.isArray(a)){a=a.slice();b=0;for(c=a.length;b<c;b++)this.show_icon(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a)return!1;b=this.get_node(a,!0);a.icon=b.length?b.children("a").children(".jstree-themeicon").attr("rel"):!0;a.icon||(a.icon=!0);b.children("a").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden");return!0}};e.vakata={};e.fn.vakata_reverse=[].reverse;e.vakata.attributes=function(a,b){a=e(a)[0];var c=b?{}:[];a&&a.attributes&&e.each(a.attributes,function(a,f){-1===e.inArray(f.nodeName.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==f.nodeValue&&""!==e.trim(f.nodeValue)&&(b?c[f.nodeName]=f.nodeValue:c.push(f.nodeName))});return c};e.vakata.array_unique=function(a){var b=[],c,d,f;c=0;for(f=a.length;c<f;c++){for(d=0;d<=c&&a[c]!==a[d];d++);d===c&&b.push(a[c])}return b};e.vakata.array_remove=function(a,b,c){c=a.slice((c||b)+1||a.length);a.length=0>b?a.length+b:b;a.push.apply(a,c);return a};e.vakata.array_remove_item=function(a,b){b=e.inArray(b,a);return-1!==b?e.vakata.array_remove(a,b):a};(function(){var a,b,c={};a=window.navigator.userAgent;a=a.toLowerCase();b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||0>a.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];a=b[1]||"";b=b[2]||"0";a&&(c[a]=!0,c.version=b);c.chrome?c.webkit=!0:c.webkit&&(c.safari=!0);e.vakata.browser=c})();e.vakata.browser.msie&&8>e.vakata.browser.version&&(e.jstree.defaults.core.animation=0);var L=document.createElement("I");L.className="jstree-icon jstree-checkbox";e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0};e.jstree.plugins.checkbox=function(a,b){this.bind=function(){b.bind.call(this);this._data.checkbox.uto=!1;this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible;this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this));if(this.settings.checkbox.three_state)this.element.on("changed.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto);this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)).on("model.jstree",e.proxy(function(a,b){a=this._model.data;var c=a[b.parent],d=b.nodes;b=[];var g,k,l,m;if(c.state.selected){g=0;for(k=d.length;g<k;g++)a[d[g]].state.selected=!0;this._data.core.selected=this._data.core.selected.concat(d)}else for(g=0,k=d.length;g<k;g++)if(a[d[g]].state.selected){l=0;for(m=a[d[g]].children_d.length;l<m;l++)a[a[d[g]].children_d[l]].state.selected=!0;this._data.core.selected=this._data.core.selected.concat(a[d[g]].children_d)}g=0;for(k=c.children_d.length;g<k;g++)a[c.children_d[g]].children.length||b.push(a[c.children_d[g]].parent);b=e.vakata.array_unique(b);l=0;for(m=b.length;l<m;l++)for(c=a[b[l]];c&&"#"!==c.id;){g=d=0;for(k=c.children.length;g<k;g++)d+=a[c.children[g]].state.selected;if(d===k)c.state.selected=!0,this._data.core.selected.push(c.id),(g=this.get_node(c,!0))&&g.length&&g.children(".jstree-anchor").addClass("jstree-clicked");else break;c=this.get_node(c.parent)}this._data.core.selected=e.vakata.array_unique(this._data.core.selected)},this)).on("select_node.jstree",e.proxy(function(a,b){var c=b.node;a=this._model.data;b=this.get_node(c.parent);var d=this.get_node(c,!0),g,k;this._data.core.selected=e.vakata.array_unique(this._data.core.selected.concat(c.children_d));g=0;for(k=c.children_d.length;g<k;g++)a[c.children_d[g]].state.selected=!0;for(;b&&"#"!==b.id;){g=c=0;for(k=b.children.length;g<k;g++)c+=a[b.children[g]].state.selected;if(c===k)b.state.selected=!0,this._data.core.selected.push(b.id),(g=this.get_node(b,!0))&&g.length&&g.children(".jstree-anchor").addClass("jstree-clicked");else break;b=this.get_node(b.parent)}d.length&&d.find(".jstree-anchor").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(a,b){a=b.node;b=this.get_node(a,!0);var c,d,g;c=0;for(d=a.children_d.length;c<d;c++)this._model.data[a.children_d[c]].state.selected=!1;c=0;for(d=a.parents.length;c<d;c++)this._model.data[a.parents[c]].state.selected=!1,(g=this.get_node(a.parents[c],!0))&&g.length&&g.children(".jstree-anchor").removeClass("jstree-clicked");g=[];c=0;for(d=this._data.core.selected.length;c<d;c++)-1===e.inArray(this._data.core.selected[c],a.children_d)&&-1===e.inArray(this._data.core.selected[c],a.parents)&&g.push(this._data.core.selected[c]);this._data.core.selected=e.vakata.array_unique(g);b.length&&b.find(".jstree-anchor").removeClass("jstree-clicked")},this)).on("delete_node.jstree",e.proxy(function(a,b){a=this.get_node(b.parent);b=this._model.data;for(var c,d,g;a&&"#"!==a.id;){c=g=0;for(d=a.children.length;c<d;c++)g+=b[a.children[c]].state.selected;if(g===d)a.state.selected=!0,this._data.core.selected.push(a.id),(c=this.get_node(a,!0))&&c.length&&c.children(".jstree-anchor").addClass("jstree-clicked");else break;a=this.get_node(a.parent)}},this)).on("move_node.jstree",e.proxy(function(a,b){var c=b.is_multi,d=b.old_parent;b=this.get_node(b.parent);a=this._model.data;var g,k;if(!c)for(c=this.get_node(d);c&&"#"!==c.id;){g=d=0;for(k=c.children.length;g<k;g++)d+=a[c.children[g]].state.selected;if(d===k)c.state.selected=!0,this._data.core.selected.push(c.id),(d=this.get_node(c,!0))&&d.length&&d.children(".jstree-anchor").addClass("jstree-clicked");else break;c=this.get_node(c.parent)}for(c=b;c&&"#"!==c.id;){g=d=0;for(k=c.children.length;g<k;g++)d+=a[c.children[g]].state.selected;if(d===k)c.state.selected||(c.state.selected=!0,this._data.core.selected.push(c.id),(d=this.get_node(c,!0))&&d.length&&d.children(".jstree-anchor").addClass("jstree-clicked"));else if(c.state.selected)c.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,c.id),(d=this.get_node(c,!0))&&d.length&&d.children(".jstree-anchor").removeClass("jstree-clicked");else break;c=this.get_node(c.parent)}},this))};this._undetermined=function(){var a,b,f=this._model.data,h=this._data.core.selected,g=[],k=this;a=0;for(b=h.length;a<b;a++)f[h[a]]&&f[h[a]].parents&&(g=g.concat(f[h[a]].parents));this.element.find(".jstree-closed").not(":has(ul)").each(function(){var a=k.get_node(this);!a.state.loaded&&a.original&&a.original.state&&a.original.state.undetermined&&!0===a.original.state.undetermined&&(g.push(a.id),g=g.concat(a.parents))});g=e.vakata.array_unique(g);a=e.inArray("#",g);-1!==a&&(g=e.vakata.array_remove(g,a));this.element.find(".jstree-undetermined").removeClass("jstree-undetermined");a=0;for(b=g.length;a<b;a++)f[g[a]].state.selected||(h=this.get_node(g[a],!0))&&h.length&&h.children("a").children(".jstree-checkbox").addClass("jstree-undetermined")};this.redraw_node=function(a,d,f){if(a=b.redraw_node.call(this,a,d,f))d=a.getElementsByTagName("A")[0],d.insertBefore(L.cloneNode(!1),d.childNodes[0]);!f&&this.settings.checkbox.three_state&&(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50));return a};this.activate_node=function(a,d){if(this.settings.checkbox.whole_node||e(d.target).hasClass("jstree-checkbox"))d.ctrlKey=!0;return b.activate_node.call(this,a,d)};this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0;this.element.children("ul").removeClass("jstree-no-checkboxes")};this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1;this.element.children("ul").addClass("jstree-no-checkboxes")};this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()}};e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(a,b){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(a){var c=e.jstree.reference(a.reference);a=c.get_node(a.reference);c.create_node(a,{},"last",function(a){setTimeout(function(){c.edit(a)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(a){var c=e.jstree.reference(a.reference);a=c.get_node(a.reference);c.edit(a)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(a){var c=e.jstree.reference(a.reference);a=c.get_node(a.reference);c.is_selected(a)?c.delete_node(c.get_selected()):c.delete_node(a)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(a){var c=e.jstree.reference(a.reference);a=c.get_node(a.reference);c.is_selected(a)?c.cut(c.get_selected()):c.cut(a)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(a){var c=e.jstree.reference(a.reference);a=c.get_node(a.reference);c.is_selected(a)?c.copy(c.get_selected()):c.copy(a)}},paste:{separator_before:!1,icon:!1,_disabled:function(a){return!e.jstree.reference(a.reference).can_paste()},separator_after:!1,label:"Paste",action:function(a){var c=e.jstree.reference(a.reference);a=c.get_node(a.reference);c.paste(a)}}}}}}};e.jstree.plugins.contextmenu=function(a,b){this.bind=function(){b.bind.call(this);var a=0;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(c){c.preventDefault();a=c.ctrlKey?c.timeStamp:0;this.is_loading(c.currentTarget)||this.show_contextmenu(c.currentTarget,c.pageX,c.pageY,c)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(c){this._data.contextmenu.visible&&(!a||250<c.timeStamp-a)&&e.vakata.context.hide()},this));e(document).on("context_hide.vakata",e.proxy(function(){this._data.contextmenu.visible=!1},this))};this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide();b.teardown.call(this)};this.show_contextmenu=function(a,b,f,h){a=this.get_node(a);if(!a||"#"===a.id)return!1;var c=this.settings.contextmenu,d=this.get_node(a,!0).children(".jstree-anchor"),l=!1,l=!1;if(c.show_at_node||b===q||f===q)l=d.offset(),b=l.left,f=l.top+this._data.core.li_height;this.settings.contextmenu.select_node&&!this.is_selected(a)&&(this.deselect_all(),this.select_node(a,!1,!1,h));l=c.items;e.isFunction(l)&&(l=l.call(this,a,e.proxy(function(c){this._show_contextmenu(a,b,f,c)},this)));e.isPlainObject(l)&&this._show_contextmenu(a,b,f,l)};this._show_contextmenu=function(a,b,f,h){var c=this.get_node(a,!0).children(".jstree-anchor");e(document).one("context_show.vakata",e.proxy(function(a,c){a="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(c.element).addClass(a)},this));this._data.contextmenu.visible=!0;e.vakata.context.show(c,{x:b,y:f},h);this.trigger("show_contextmenu",{node:a,x:b,y:f})}};(function(a){var b=!1,c=!1,d=!1,f=0,e=0,g=[],k="",l=!1;a.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(b){a(document).triggerHandler("context_"+b+".vakata",{reference:d,element:c,position:{x:f,y:e}})},_execute:function(b){return(b=g[b])&&(!b._disabled||a.isFunction(b._disabled)&&!b._disabled({item:b,reference:d,element:c}))&&b.action?b.action.call(null,{item:b,reference:d,element:c,position:{x:f,y:e}}):!1},_parse:function(b,f){if(!b)return!1;f||(k="",g=[]);var e="",h=!1,m;f&&(e+="\x3cul\x3e");a.each(b,function(b,f){if(!f)return!0;g.push(f);!h&&f.separator_before&&(e+="\x3cli class\x3d'vakata-context-separator'\x3e\x3ca href\x3d'#' "+(a.vakata.context.settings.icons?"":'style\x3d"margin-left:0px;"')+"\x3e\x26#160;\x3c/a\x3e\x3c/li\x3e");h=!1;e+="\x3cli class\x3d'"+(f._class||"")+(!0===f._disabled||a.isFunction(f._disabled)&&f._disabled({item:f,reference:d,element:c})?" vakata-contextmenu-disabled ":"")+"' "+(f.shortcut?" data-shortcut\x3d'"+f.shortcut+"' ":"")+"\x3e";e+="\x3ca href\x3d'#' rel\x3d'"+(g.length-1)+"'\x3e";a.vakata.context.settings.icons&&(e+="\x3ci ",f.icon&&(e=-1!==f.icon.indexOf("/")||-1!==f.icon.indexOf(".")?e+(" style\x3d'background:url(\""+f.icon+"\") center center no-repeat' "):e+(" class\x3d'"+f.icon+"' ")),e+="\x3e\x3c/i\x3e\x3cspan class\x3d'vakata-contextmenu-sep'\x3e\x26#160;\x3c/span\x3e");e+=(a.isFunction(f.label)?f.label({item:b,reference:d,element:c}):f.label)+(f.shortcut?' \x3cspan class\x3d"vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+f.shortcut+'"\x3e'+(f.shortcut_label||"")+"\x3c/span\x3e":"")+"\x3c/a\x3e";f.submenu&&(m=a.vakata.context._parse(f.submenu,!0))&&(e+=m);e+="\x3c/li\x3e";f.separator_after&&(e+="\x3cli class\x3d'vakata-context-separator'\x3e\x3ca href\x3d'#' "+(a.vakata.context.settings.icons?"":'style\x3d"margin-left:0px;"')+"\x3e\x26#160;\x3c/a\x3e\x3c/li\x3e",h=!0)});e=e.replace(/<li class\='vakata-context-separator'\><\/li\>$/,"");f&&(e+="\x3c/ul\x3e");f||(k=e,a.vakata.context._trigger("parse"));return 10<e.length?e:!1},_show_submenu:function(c){c=a(c);if(c.length&&c.children("ul").length){var d=c.children("ul"),f=c.offset().left+c.outerWidth(),e=c.offset().top,g=d.width(),h=d.height(),k=a(window).width()+a(window).scrollLeft(),m=a(window).height()+a(window).scrollTop();if(b)c[0>f-(g+10+c.outerWidth())?"addClass":"removeClass"]("vakata-context-left");else c[f+g+10>k?"addClass":"removeClass"]("vakata-context-right");e+h+10>m&&d.css("bottom","-1px");d.show()}},show:function(h,n,p){var m,u,v,x;c&&c.length&&c.width("");switch(!0){case !n&&!h:return!1;case !!n&&!!h:d=h;f=n.x;e=n.y;break;case !n&&!!h:d=h;n=h.offset();f=n.left+h.outerHeight();e=n.top;break;case !!n&&!h:f=n.x,e=n.y}h&&!p&&a(h).data("vakata_contextmenu")&&(p=a(h).data("vakata_contextmenu"));a.vakata.context._parse(p)&&c.html(k);g.length&&(h=c,p=f,n=e,m=h.width(),u=h.height(),v=a(window).width()+a(window).scrollLeft(),x=a(window).height()+a(window).scrollTop(),b&&(p-=h.outerWidth(),p<a(window).scrollLeft()+20&&(p=a(window).scrollLeft()+20)),p+m+20>v&&(p=v-(m+20)),n+u+20>x&&(n=x-(u+20)),c.css({left:p,top:n}).show().find("a:eq(0)").focus().parent().addClass("vakata-context-hover"),l=!0,a.vakata.context._trigger("show"))},hide:function(){l&&(c.hide().find("ul").hide().end().find(":focus").blur(),l=!1,a.vakata.context._trigger("hide"))}};a(function(){b="rtl"===a("body").css("direction");var d=!1;c=a("\x3cul class\x3d'vakata-context'\x3e\x3c/ul\x3e");c.on("mouseenter","li",function(b){b.stopImmediatePropagation();a.contains(this,b.relatedTarget)||(d&&clearTimeout(d),c.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),a(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),a.vakata.context._show_submenu(this))}).on("mouseleave","li",function(c){a.contains(this,c.relatedTarget)||a(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(c){a(this).find(".vakata-context-hover").removeClass("vakata-context-hover");a.vakata.context.settings.hide_onmouseleave&&(d=setTimeout(function(c){return function(){a.vakata.context.hide()}}(this),a.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(a){a.preventDefault()}).on("mouseup","a",function(c){a(this).blur().parent().hasClass("vakata-context-disabled")||!1===a.vakata.context._execute(a(this).attr("rel"))||a.vakata.context.hide()}).on("keydown","a",function(b){var d;switch(b.which){case 13:case 32:b.type="mouseup";b.preventDefault();a(b.currentTarget).trigger(b);break;case 37:l&&(c.find(".vakata-context-hover").last().parents("li:eq(0)").find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 38:l&&(d=c.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),d.length||(d=c.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),d.addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 39:l&&(c.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 40:l&&(d=c.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),d.length||(d=c.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),d.addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 27:a.vakata.context.hide(),b.preventDefault()}}).on("keydown",function(a){a.preventDefault();a=c.find(".vakata-contextmenu-shortcut-"+a.which).parent();a.parent().not(".vakata-context-disabled")&&a.mouseup()}).appendTo("body");a(document).on("mousedown",function(b){l&&!a.contains(c[0],b.target)&&a.vakata.context.hide()}).on("context_show.vakata",function(a,d){c.find("li:has(ul)").children("a").addClass("vakata-context-parent");b&&c.addClass("vakata-context-rtl").css("direction","rtl");c.find("ul").hide().end()})})})(e);e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0};e.jstree.plugins.dnd=function(a,b){this.bind=function(){b.bind.call(this);this.element.on("mousedown.jstree touchstart.jstree",".jstree-anchor",e.proxy(function(a){var c=this.get_node(a.target),b=this.is_selected(c)?this.get_selected().length:1;if(c&&c.id&&"#"!==c.id&&(1===a.which||"touchstart"===a.type)&&(!0===this.settings.dnd.is_draggable||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,1<b?this.get_selected(!0):[c])))return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(a,{jstree:!0,origin:this,obj:this.get_node(c,!0),nodes:1<b?this.get_selected():[c.id]},'\x3cdiv id\x3d"jstree-dnd" class\x3d"jstree-'+this.get_theme()+'"\x3e\x3ci class\x3d"jstree-icon jstree-er"\x3e\x3c/i\x3e'+(1<b?b+" "+this.get_string("nodes"):this.get_text(a.currentTarget,!0))+'\x3cins class\x3d"jstree-copy" style\x3d"display:none;"\x3e+\x3c/ins\x3e\x3c/div\x3e')},this))}};e(function(){var a=!1,b=!1,c=!1,d=e('\x3cdiv id\x3d"jstree-marker"\x3e\x26#160;\x3c/div\x3e').hide().appendTo("body");e(document).bind("dnd_start.vakata",function(c,b){a=!1}).bind("dnd_move.vakata",function(f,h){c&&clearTimeout(c);if(h.data.jstree&&(!h.event.target.id||"jstree-marker"!==h.event.target.id)){var g=e.jstree.reference(h.event.target),k=!1,l=!1;f=!1;var m,n,p,r,u,v,x,q,G,I,t,A;if(g&&g._data&&g._data.dnd)if(d.attr("class","jstree-"+g.get_theme()),h.helper.children().attr("class","jstree-"+g.get_theme()).find(".jstree-copy:eq(0)")[h.data.origin&&h.data.origin.settings.dnd.copy&&(h.event.metaKey||h.event.ctrlKey)?"show":"hide"](),h.event.target!==g.element[0]&&h.event.target!==g.get_container_ul()[0]||0!==g.get_container_ul().children().length){if((k=e(h.event.target).closest("a"))&&k.length&&k.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(l=k.offset(),f=h.event.pageY-l.top,p=k.height(),v=f<p/3?["b","i","a"]:f>p-p/3?["a","i","b"]:f>p/2?["i","a","b"]:["i","b","a"],e.each(v,function(f,C){switch(C){case "b":m=l.left-6;n=l.top-5;r=g.get_parent(k);u=k.parent().index();break;case "i":m=l.left-2;n=l.top-5+p/2+1;r=g.get_node(k.parent()).id;u=0;break;case "a":m=l.left-6,n=l.top-5+p,r=g.get_parent(k),u=k.parent().index()+1}x=!0;q=0;for(G=h.data.nodes.length;q<G;q++)if(I=h.data.origin&&h.data.origin.settings.dnd.copy&&(h.event.metaKey||h.event.ctrlKey)?"copy_node":"move_node",t=u,"move_node"===I&&"a"===C&&h.data.origin&&h.data.origin===g&&r===g.get_parent(h.data.nodes[q])&&(A=g.get_node(r),t>e.inArray(h.data.nodes[q],A.children)&&--t),x=x&&(g&&g.settings&&g.settings.dnd&&!1===g.settings.dnd.check_while_dragging||g.check(I,h.data.origin&&h.data.origin!==g?h.data.origin.get_node(h.data.nodes[q]):h.data.nodes[q],r,t,{dnd:!0,ref:g.get_node(k.parent()),pos:C})),!x){g&&g.last_error&&(b=g.last_error());break}if(x)return"i"===C&&k.parent().is(".jstree-closed")&&g.settings.dnd.open_timeout&&(c=setTimeout(function(a,c){return function(){a.open_node(c)}}(g,k),g.settings.dnd.open_timeout)),a={ins:g,par:r,pos:u},d.css({left:m+"px",top:n+"px"}).show(),h.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok"),b={},v=!0,!1}),!0===v))return}else{x=!0;q=0;for(G=h.data.nodes.length;q<G&&(x=x&&g.check(h.data.origin&&h.data.origin.settings.dnd.copy&&(h.event.metaKey||h.event.ctrlKey)?"copy_node":"move_node",h.data.origin&&h.data.origin!==g?h.data.origin.get_node(h.data.nodes[q]):h.data.nodes[q],"#","last"),x);q++);if(x){a={ins:g,par:"#",pos:"last"};d.hide();h.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok");return}}a=!1;h.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er");d.hide()}}).bind("dnd_scroll.vakata",function(c,b){b.data.jstree&&(d.hide(),a=!1,b.helper.find(".jstree-icon:eq(0)").removeClass("jstree-ok").addClass("jstree-er"))}).bind("dnd_stop.vakata",function(f,h){c&&clearTimeout(c);if(h.data.jstree){d.hide();var g,k=[];if(a){f=0;for(g=h.data.nodes.length;f<g;f++)k[f]=h.data.origin?h.data.origin.get_node(h.data.nodes[f]):h.data.nodes[f];a.ins[h.data.origin&&h.data.origin.settings.dnd.copy&&(h.event.metaKey||h.event.ctrlKey)?"copy_node":"move_node"](k,a.par,a.pos)}else f=e(h.event.target).closest(".jstree"),f.length&&b&&b.error&&"check"===b.error&&(f=f.jstree(!0))&&f.settings.core.error.call(this,b)}}).bind("keyup keydown",function(a,c){c=e.vakata.dnd._get();if(c.data&&c.data.jstree)c.helper.find(".jstree-copy:eq(0)")[c.data.origin&&c.data.origin.settings.dnd.copy&&(a.metaKey||a.ctrlKey)?"show":"hide"]()})});(function(a){var b=!1,c=!1,d=!1,f=!1,e=0,g=!1,k=0,l=0,m=0,n=0,p=!1,r=!1;a.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5},_trigger:function(c,b){var d=a.vakata.dnd._get();d.event=b;a(document).triggerHandler("dnd_"+c+".vakata",d)},_get:function(){return{data:g,element:b,helper:f}},_clean:function(){f&&f.remove();r&&(clearInterval(r),r=!1);f=d=c=b=!1;e=0;g=!1;n=m=l=k=0;r=p=!1;a(document).off("mousemove touchmove",a.vakata.dnd.drag);a(document).off("mouseup touchend",a.vakata.dnd.stop)},_scroll:function(c){if(!p||!m&&!n)return r&&(clearInterval(r),r=!1),!1;if(!r)return r=setInterval(a.vakata.dnd._scroll,100),!1;if(!0===c)return!1;c=p.scrollTop();var b=p.scrollLeft();p.scrollTop(c+n*a.vakata.dnd.settings.scroll_speed);p.scrollLeft(b+m*a.vakata.dnd.settings.scroll_speed);c===p.scrollTop()&&b===p.scrollLeft()||a.vakata.dnd._trigger("scroll",p)},start:function(e,h,m){"touchstart"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=document.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset));d&&a.vakata.dnd.stop({});try{e.currentTarget.unselectable="on",e.currentTarget.onselectstart=function(){return!1},e.currentTarget.style&&(e.currentTarget.style.MozUserSelect="none")}catch(C){}k=e.pageX;l=e.pageY;g=h;c=!0;b=e.currentTarget;!1!==m&&(f=a("\x3cdiv id\x3d'vakata-dnd'\x3e\x3c/div\x3e").html(m).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"}));a(document).bind("mousemove touchmove",a.vakata.dnd.drag);a(document).bind("mouseup touchend",a.vakata.dnd.stop);return!1},drag:function(b){"touchmove"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=document.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset));if(c){if(!d)if(Math.abs(b.pageX-k)>a.vakata.dnd.settings.threshold||Math.abs(b.pageY-l)>a.vakata.dnd.settings.threshold)f&&(f.appendTo("body"),e=f.outerWidth()),d=!0,a.vakata.dnd._trigger("start",b);else return;var g=!1,h=!1,u=!1,r=!1,q=!1,t=h=!1,A=!1,r=g=!1;m=n=0;p=!1;a(a(b.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(a(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var c=a(this),d=c.offset();this.scrollHeight>this.offsetHeight&&(d.top+c.height()-b.pageY<a.vakata.dnd.settings.scroll_proximity&&(n=1),b.pageY-d.top<a.vakata.dnd.settings.scroll_proximity&&(n=-1));this.scrollWidth>this.offsetWidth&&(d.left+c.width()-b.pageX<a.vakata.dnd.settings.scroll_proximity&&(m=1),b.pageX-d.left<a.vakata.dnd.settings.scroll_proximity&&(m=-1));if(n||m)return p=a(this),!1});!p&&(g=a(document),h=a(window),u=g.height(),r=h.height(),q=g.width(),h=h.width(),t=g.scrollTop(),A=g.scrollLeft(),u>r&&b.pageY-t<a.vakata.dnd.settings.scroll_proximity&&(n=-1),u>r&&r-(b.pageY-t)<a.vakata.dnd.settings.scroll_proximity&&(n=1),q>h&&b.pageX-A<a.vakata.dnd.settings.scroll_proximity&&(m=-1),q>h&&h-(b.pageX-A)<a.vakata.dnd.settings.scroll_proximity&&(m=1),n||m)&&(p=g);p&&a.vakata.dnd._scroll(!0);f&&(g=parseInt(b.pageY+a.vakata.dnd.settings.helper_top,10),r=parseInt(b.pageX+a.vakata.dnd.settings.helper_left,10),u&&g+25>u&&(g=u-50),q&&r+e>q&&(r=q-(e+2)),f.css({left:r+"px",top:g+"px"}));a.vakata.dnd._trigger("move",b)}},stop:function(c){"touchend"===c.type&&c.originalEvent&&c.originalEvent.changedTouches&&c.originalEvent.changedTouches[0]&&(c.pageX=c.originalEvent.changedTouches[0].pageX,c.pageY=c.originalEvent.changedTouches[0].pageY,c.target=document.elementFromPoint(c.originalEvent.changedTouches[0].pageX-window.pageXOffset,c.originalEvent.changedTouches[0].pageY-window.pageYOffset));d&&a.vakata.dnd._trigger("stop",c);a.vakata.dnd._clean()}}})(jQuery);e.jstree.defaults.search={ajax:!1,fuzzy:!0,case_sensitive:!1,show_only_matches:!1,close_opened_onclear:!0};e.jstree.plugins.search=function(a,b){this.bind=function(){b.bind.call(this);this._data.search.str="";this._data.search.dom=e();this._data.search.res=[];this._data.search.opn=[];this._data.search.sln=null;this.element.on("before_open.jstree",e.proxy(function(a,b){var c,d=this._data.search.res,g=[],k=e();if(d&&d.length){this._data.search.dom=e();a=0;for(b=d.length;a<b;a++)if(g=g.concat(this.get_node(d[a]).parents),c=this.get_node(d[a],!0))this._data.search.dom=this._data.search.dom.add(c);g=e.vakata.array_unique(g);a=0;for(b=g.length;a<b;a++)"#"!==g[a]&&(c=this.get_node(g[a],!0))&&(k=k.add(c));this._data.search.dom.children(".jstree-anchor").addClass("jstree-search");this.settings.search.show_only_matches&&this._data.search.res.length&&(this.element.find("li").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),k=k.add(this._data.search.dom),k.parentsUntil(".jstree").addBack().show().filter("ul").each(function(){e(this).children("li:visible").eq(-1).addClass("jstree-last")}))}},this));if(this.settings.search.show_only_matches)this.element.on("search.jstree",function(a,b){b.nodes.length&&(e(this).find("li").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),b.nodes.parentsUntil(".jstree").addBack().show().filter("ul").each(function(){e(this).children("li:visible").eq(-1).addClass("jstree-last")}))}).on("clear_search.jstree",function(a,b){b.nodes.length&&e(this).find("li").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")})};this.search=function(a,b){if(!1===a||""===e.trim(a))return this.clear_search();var c=this.settings.search,d=c.ajax?e.extend({},c.ajax):!1,g=null,k=[],l=[];this._data.search.res.length&&this.clear_search();if(!b&&!1!==d)return d.data||(d.data={}),d.data.str=a,e.ajax(d).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(d)};this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(c){c&&c.d&&(c=c.d);this._data.search.sln=e.isArray(c)?c:[];this._search_load(a)},this));this._data.search.str=a;this._data.search.dom=e();this._data.search.res=[];this._data.search.opn=[];g=new e.vakata.search(a,!0,{caseSensitive:c.case_sensitive,fuzzy:c.fuzzy});e.each(this._model.data,function(a,c){c.text&&g.search(c.text).isMatch&&(k.push(a),l=l.concat(c.parents))});if(k.length){l=e.vakata.array_unique(l);this._search_open(l);b=0;for(c=k.length;b<c;b++)if(g=this.get_node(k[b],!0))this._data.search.dom=this._data.search.dom.add(g);this._data.search.res=k;this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:a,res:this._data.search.res})};this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search");this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0);this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res});this._data.search.str="";this._data.search.res=[];this._data.search.opn=[];this._data.search.dom=e()};this._search_open=function(a){var c=this;e.each(a.concat([]),function(b,d){if("#"===d)return!0;try{d=e("#"+d.replace(e.jstree.idregex,"\\$\x26"),c.element)}catch(g){}d&&d.length&&c.is_closed(d)&&(c._data.search.opn.push(d[0].id),c.open_node(d,function(){c._search_open(a)},0))})};this._search_load=function(a){var c=!0,b=this,h=b._model.data;e.isArray(this._data.search.sln)&&(this._data.search.sln.length?(e.each(this._data.search.sln,function(d,f){h[f]&&!h[f].state.loaded&&(b.is_loading(f)||b.load_node(f,function(c,d){e.vakata.array_remove_item(b._data.search.sln,f);b._search_load(a)}),c=!1)}),c&&(this._data.search.sln=[],this._search_load(a))):(this._data.search.sln=null,this.search(a,!0)))}};(function(a){a.vakata.search=function(a,c,d){d=d||{};!1!==d.fuzzy&&(d.fuzzy=!0);a=d.caseSensitive?a:a.toLowerCase();var b=d.location||0,e=d.distance||100,g=d.threshold||.6,k=a.length,l,m,n,p;32<k&&(d.fuzzy=!1);d.fuzzy&&(l=1<<k-1,m=function(){var c={},b;for(b=0;b<k;b++)c[a.charAt(b)]=0;for(b=0;b<k;b++)c[a.charAt(b)]|=1<<k-b-1;return c}(),n=function(a,c){a/=k;c=Math.abs(b-c);return e?a+c/e:c?1:a});p=function(c){c=d.caseSensitive?c:c.toLowerCase();if(a===c||-1!==c.indexOf(a))return{isMatch:!0,score:0};if(!d.fuzzy)return{isMatch:!1,score:1};var f,e,h=c.length,p=g,q=c.indexOf(a,b),r,t,A=k+h,w,z,y=1,B=[];-1!==q&&(p=Math.min(n(0,q),p),q=c.lastIndexOf(a,b+k),-1!==q&&(p=Math.min(n(0,q),p)));q=-1;for(f=0;f<k;f++){r=0;for(t=A;r<t;)n(f,b+t)<=p?r=t:A=t,t=Math.floor((A-r)/2+r);A=t;r=Math.max(1,b-t+1);e=Math.min(b+t,h)+k;t=Array(e+2);for(t[e+1]=(1<<f)-1;e>=r;e--)if(z=m[c.charAt(e-1)],t[e]=0===f?(t[e+1]<<1|1)&z:(t[e+1]<<1|1)&z|(w[e+1]|w[e])<<1|1|w[e+1],t[e]&l&&(y=n(f,e-1),y<=p))if(p=y,q=e-1,B.push(q),q>b)r=Math.max(1,2*b-q);else break;if(n(f+1,b)>p)break;w=t}return{isMatch:0<=q,score:y}};return!0===c?{search:p}:p(c)}})(jQuery);e.jstree.defaults.sort=function(a,b){return this.get_text(a)>this.get_text(b)?1:-1};e.jstree.plugins.sort=function(a,b){this.bind=function(){b.bind.call(this);this.element.on("model.jstree",e.proxy(function(a,b){this.sort(b.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(a,b){this.sort(b.parent||b.node.parent,!1);this.redraw_node(b.parent||b.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(a,b){this.sort(b.parent,!1);this.redraw_node(b.parent,!0)},this))};this.sort=function(a,b){var c;if((a=this.get_node(a))&&a.children&&a.children.length&&(a.children.sort(e.proxy(this.settings.sort,this)),b))for(b=0,c=a.children_d.length;b<c;b++)this.sort(a.children_d[b],!1)}};var J=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree",ttl:!1,filter:!1};e.jstree.plugins.state=function(a,b){this.bind=function(){b.bind.call(this);var a=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){J&&clearTimeout(J);J=setTimeout(e.proxy(function(){this.save_state()},this),100)},this))},this);this.element.on("ready.jstree",e.proxy(function(c,b){this.element.one("restore_state.jstree",a);this.restore_state()||a()},this))};this.save_state=function(){var a={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(a))};this.restore_state=function(){var a=e.vakata.storage.get(this.settings.state.key);if(a)try{a=JSON.parse(a)}catch(d){return!1}if(a&&a.ttl&&a.sec&&+new Date-a.sec>a.ttl)return!1;a&&a.state&&(a=a.state);a&&e.isFunction(this.settings.state.filter)&&(a=this.settings.state.filter.call(this,a));return a?(this.element.one("set_state.jstree",function(c,b){b.instance.trigger("restore_state",{state:e.extend(!0,{},a)})}),this.set_state(a),!0):!1};this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}};(function(a,b){a.vakata.storage={set:function(a,b){return window.localStorage.setItem(a,b)},get:function(a){return window.localStorage.getItem(a)},del:function(a){return window.localStorage.removeItem(a)}}})(jQuery);e.jstree.defaults.types={"#":{},"default":{}};e.jstree.plugins.types=function(a,b){this.init=function(a,d){var c,e;if(d&&d.types&&d.types["default"])for(c in d.types)if("default"!==c&&"#"!==c&&d.types.hasOwnProperty(c))for(e in d.types["default"])d.types["default"].hasOwnProperty(e)&&d.types[c][e]===q&&(d.types[c][e]=d.types["default"][e]);b.init.call(this,a,d);this._model.data["#"].type="#"};this.refresh=function(a){b.refresh.call(this,a);this._model.data["#"].type="#"};this.bind=function(){this.element.on("model.jstree",e.proxy(function(a,b){a=this._model.data;b=b.nodes;var c=this.settings.types,d,e,k;d=0;for(e=b.length;d<e;d++)k="default",a[b[d]].original&&a[b[d]].original.type&&c[a[b[d]].original.type]&&(k=a[b[d]].original.type),a[b[d]].data&&a[b[d]].data.jstree&&a[b[d]].data.jstree.type&&c[a[b[d]].data.jstree.type]&&(k=a[b[d]].data.jstree.type),a[b[d]].type=k,!0===a[b[d]].icon&&c[k].icon!==q&&(a[b[d]].icon=c[k].icon)},this));b.bind.call(this)};this.get_json=function(a,d,f){var c=this._model.data,g=d?e.extend(!0,{},d,{no_id:!1}):{},g=b.get_json.call(this,a,g,f);if(!1===g)return!1;if(e.isArray(g))for(a=0,f=g.length;a<f;a++)g[a].type=g[a].id&&c[g[a].id]&&c[g[a].id].type?c[g[a].id].type:"default",d&&d.no_id&&(delete g[a].id,g[a].li_attr&&g[a].li_attr.id&&delete g[a].li_attr.id);else g.type=g.id&&c[g.id]&&c[g.id].type?c[g.id].type:"default",d&&d.no_id&&(g=this._delete_ids(g));return g};this._delete_ids=function(a){if(e.isArray(a)){for(var c=0,b=a.length;c<b;c++)a[c]=this._delete_ids(a[c]);return a}delete a.id;a.li_attr&&a.li_attr.id&&delete a.li_attr.id;a.children&&e.isArray(a.children)&&(a.children=this._delete_ids(a.children));return a};this.check=function(a,d,f,h,g){if(!1===b.check.call(this,a,d,f,h,g))return!1;d=d&&d.id?d:this.get_node(d);f=f&&f.id?f:this.get_node(f);g=d&&d.id?e.jstree.reference(d.id):null;var c,l,m,n;g=g&&g._model&&g._model.data?g._model.data:null;switch(a){case "create_node":case "move_node":case "copy_node":if("move_node"!==a||-1===e.inArray(d.id,f.children)){c=this.get_rules(f);if(c.max_children!==q&&-1!==c.max_children&&c.max_children===f.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+a,data:JSON.stringify({chk:a,pos:h,obj:d&&d.id?d.id:!1,par:f&&f.id?f.id:!1})},!1;if(c.valid_children!==q&&-1!==c.valid_children&&-1===e.inArray(d.type,c.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+a,data:JSON.stringify({chk:a,pos:h,obj:d&&d.id?d.id:!1,par:f&&f.id?f.id:!1})},!1;if(g&&d.children_d&&d.parents){m=l=0;for(n=d.children_d.length;m<n;m++)l=Math.max(l,g[d.children_d[m]].parents.length);l=l-d.parents.length+1}if(0>=l||l===q)l=1;do{if(c.max_depth!==q&&-1!==c.max_depth&&c.max_depth<l)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+a,data:JSON.stringify({chk:a,pos:h,obj:d&&d.id?d.id:!1,par:f&&f.id?f.id:!1})},!1;f=this.get_node(f.parent);c=this.get_rules(f);l++}while(f)}}return!0};this.get_rules=function(a){a=this.get_node(a);if(!a)return!1;a=this.get_type(a,!0);a.max_depth===q&&(a.max_depth=-1);a.max_children===q&&(a.max_children=-1);a.valid_children===q&&(a.valid_children=-1);return a};this.get_type=function(a,b){return(a=this.get_node(a))?b?e.extend({type:a.type},this.settings.types[a.type]):a.type:!1};this.set_type=function(a,b){var c,d,g;if(e.isArray(a)){a=a.slice();c=0;for(d=a.length;c<d;c++)this.set_type(a[c],b);return!0}c=this.settings.types;a=this.get_node(a);if(!c[b]||!a)return!1;d=a.type;g=this.get_icon(a);a.type=b;(!0===g||c[d]&&c[d].icon&&g===c[d].icon)&&this.set_icon(a,c[b].icon!==q?c[b].icon:!0);return!0}};e.jstree.plugins.unique=function(a,b){this.check=function(a,d,f,h,g){if(!1===b.check.call(this,a,d,f,h,g))return!1;d=d&&d.id?d:this.get_node(d);f=f&&f.id?f:this.get_node(f);if(!f||!f.children)return!0;g="rename_node"===a?h:d.text;var c=[],l=this._model.data,m,n;m=0;for(n=f.children.length;m<n;m++)c.push(l[f.children[m]].text);switch(a){case "rename_node":case "copy_node":return m=-1===e.inArray(g,c),m||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+g+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:h,obj:d&&d.id?d.id:!1,par:f&&f.id?f.id:!1})}),m;case "move_node":return m=d.parent===f.id||-1===e.inArray(g,c),m||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+g+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:h,obj:d&&d.id?d.id:!1,par:f&&f.id?f.id:!1})}),m}return!0}};var D=document.createElement("DIV");D.setAttribute("unselectable","on");D.className="jstree-wholerow";D.innerHTML="\x26#160;";e.jstree.plugins.wholerow=function(a,b){this.bind=function(){b.bind.call(this);this.element.on("loading",e.proxy(function(){D.style.height=this._data.core.li_height+"px"},this)).on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var c,d;c=0;for(d=b.selected.length;c<d;c++)(a=this.get_node(b.selected[c],!0))&&a.length&&a.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(a,b){this.get_node(b.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(a,b){this.get_node(b.node,!0).children(".jstree-wholerow")["hover_node"===a.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(a){a.preventDefault();var b=e.Event("contextmenu",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey,pageX:a.pageX,pageY:a.pageY});e(a.currentTarget).closest("li").children("a:eq(0)").trigger(b)},this)).on("click.jstree",".jstree-wholerow",function(a){a.stopImmediatePropagation();var b=e.Event("click",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey});e(a.currentTarget).closest("li").children("a:eq(0)").trigger(b).focus()}).on("click.jstree",".jstree-leaf \x3e .jstree-ocl",e.proxy(function(a){a.stopImmediatePropagation();var b=e.Event("click",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey});e(a.currentTarget).closest("li").children("a:eq(0)").trigger(b).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(a){a.stopImmediatePropagation();this.hover_node(a.currentTarget);return!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(a){this.dehover_node(a.currentTarget)},this))};this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove();b.teardown.call(this)};this.redraw_node=function(a,d,f){if(a=b.redraw_node.call(this,a,d,f))d=D.cloneNode(!0),-1!==e.inArray(a.id,this._data.core.selected)&&(d.className+=" jstree-wholerow-clicked"),a.insertBefore(d,a.childNodes[0]);return a}}}});