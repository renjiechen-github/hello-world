'use strict';(function(h){var r={colors:1,values:1,backgroundColor:1,scaleColors:1,normalizeFunction:1,enableZoom:1,showTooltip:1,borderColor:1,borderWidth:1,borderOpacity:1,selectedRegions:1,multiSelectRegion:1},p={onLabelShow:"labelShow",onRegionOver:"regionMouseOver",onRegionOut:"regionMouseOut",onRegionClick:"regionClick",onRegionSelect:"regionSelect",onRegionDeselect:"regionDeselect"};h.fn.vectorMap=function(a){var b={map:"world_en",backgroundColor:"#a5bfdd",color:"#f4f3f0",hoverColor:"#c9dfaf",selectedColor:"#c9dfaf",scaleColors:["#b6d6ff","#005ace"],normalizeFunction:"linear",enableZoom:!0,showTooltip:!0,borderColor:"#818181",borderWidth:1,borderOpacity:.25,selectedRegions:null,multiSelectRegion:!1},c=this.data("mapObject");if("addMap"===a)g.maps[arguments[1]]=arguments[2];else if("set"===a&&r[arguments[1]])c["set"+arguments[1].charAt(0).toUpperCase()+arguments[1].substr(1)].apply(c,Array.prototype.slice.call(arguments,2));else{if("string"===typeof a&&"function"===typeof c[a])return c[a].apply(c,Array.prototype.slice.call(arguments,1));h.extend(b,a);b.container=this;this.css({position:"relative",overflow:"hidden"});c=new g(b);this.data("mapObject",c);for(var d in p)b[d]&&this.bind(p[d]+".jqvmap",b[d])}};var l=function(a,b,c){this.mode=window.SVGAngle?"svg":"vml";this.params=c;if("svg"==this.mode)this.createSvgNode=function(a){return document.createElementNS(this.svgns,a)};else{try{document.namespaces.rvml||document.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),this.createVmlNode=function(a){return document.createElement("\x3crvml:"+a+' class\x3d"rvml"\x3e')}}catch(d){this.createVmlNode=function(a){return document.createElement("\x3c"+a+' xmlns\x3d"urn:schemas-microsoft.com:vml" class\x3d"rvml"\x3e')}}document.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)")}"svg"==this.mode?this.canvas=this.createSvgNode("svg"):(this.canvas=this.createVmlNode("group"),this.canvas.style.position="absolute");this.setSize(a,b)};l.prototype={svgns:"http://www.w3.org/2000/svg",mode:"svg",width:0,height:0,canvas:null,setSize:function(a,b){if("svg"==this.mode)this.canvas.setAttribute("width",a),this.canvas.setAttribute("height",b);else if(this.canvas.style.width=a+"px",this.canvas.style.height=b+"px",this.canvas.coordsize=a+" "+b,this.canvas.coordorigin="0 0",this.rootGroup){for(var c=this.rootGroup.getElementsByTagName("shape"),d=0,f=c.length;d<f;d++)c[d].coordsize=a+" "+b,c[d].style.width=a+"px",c[d].style.height=b+"px";this.rootGroup.coordsize=a+" "+b;this.rootGroup.style.width=a+"px";this.rootGroup.style.height=b+"px"}this.width=a;this.height=b},createPath:function(a){var b;"svg"==this.mode?(b=this.createSvgNode("path"),b.setAttribute("d",a.path),null!==this.params.borderColor&&b.setAttribute("stroke",this.params.borderColor),0<this.params.borderWidth&&(b.setAttribute("stroke-width",this.params.borderWidth),b.setAttribute("stroke-linecap","round"),b.setAttribute("stroke-linejoin","round")),0<this.params.borderOpacity&&b.setAttribute("stroke-opacity",this.params.borderOpacity),b.setFill=function(a){this.setAttribute("fill",a);null===this.getAttribute("original")&&this.setAttribute("original",a)},b.getFill=function(a){return this.getAttribute("fill")},b.getOriginalFill=function(){return this.getAttribute("original")},b.setOpacity=function(a){this.setAttribute("fill-opacity",a)}):(b=this.createVmlNode("shape"),b.coordorigin="0 0",b.coordsize=this.width+" "+this.height,b.style.width=this.width+"px",b.style.height=this.height+"px",b.fillcolor=g.defaultFillColor,b.stroked=!1,b.path=l.pathSvgToVml(a.path),a=this.createVmlNode("skew"),a.on=!0,a.matrix="0.01,0,0,0.01,0,0",a.offset="0,0",b.appendChild(a),a=this.createVmlNode("fill"),b.appendChild(a),b.setFill=function(a){this.getElementsByTagName("fill")[0].color=a;null===this.getAttribute("original")&&this.setAttribute("original",a)},b.getFill=function(a){return this.getElementsByTagName("fill")[0].color},b.getOriginalFill=function(){return this.getAttribute("original")},b.setOpacity=function(a){this.getElementsByTagName("fill")[0].opacity=parseInt(100*a,10)+"%"});return b},createGroup:function(a){var b;"svg"==this.mode?b=this.createSvgNode("g"):(b=this.createVmlNode("group"),b.style.width=this.width+"px",b.style.height=this.height+"px",b.style.left="0px",b.style.top="0px",b.coordorigin="0 0",b.coordsize=this.width+" "+this.height);a&&(this.rootGroup=b);return b},applyTransformParams:function(a,b,c){"svg"==this.mode?this.rootGroup.setAttribute("transform","scale("+a+") translate("+b+", "+c+")"):(this.rootGroup.coordorigin=this.width-b+","+(this.height-c),this.rootGroup.coordsize=this.width/a+","+this.height/a)}};l.pathSvgToVml=function(a){var b=0,c=0,d,f;return a.replace(/([MmLlHhVvCcSs])((?:-?(?:\d+)?(?:\.\d+)?,?\s?)+)/g,function(a,n,e,q){e=e.replace(/(\d)-/g,"$1,-").replace(/\s+/g,",").split(",");e[0]||e.shift();a=0;for(q=e.length;a<q;a++)e[a]=Math.round(100*e[a]);switch(n){case "m":return b+=e[0],c+=e[1],"t"+e.join(",");case "M":return b=e[0],c=e[1],"m"+e.join(",");case "l":return b+=e[0],c+=e[1],"r"+e.join(",");case "L":return b=e[0],c=e[1],"l"+e.join(",");case "h":return b+=e[0],"r"+e[0]+",0";case "H":return b=e[0],"l"+b+","+c;case "v":return c+=e[0],"r0,"+e[0];case "V":return c=e[0],"l"+b+","+c;case "c":return d=b+e[e.length-4],f=c+e[e.length-3],b+=e[e.length-2],c+=e[e.length-1],"v"+e.join(",");case "C":return d=e[e.length-4],f=e[e.length-3],b=e[e.length-2],c=e[e.length-1],"c"+e.join(",");case "s":return e.unshift(c-f),e.unshift(b-d),d=b+e[e.length-4],f=c+e[e.length-3],b+=e[e.length-2],c+=e[e.length-1],"v"+e.join(",");case "S":return e.unshift(c+c-f),e.unshift(b+b-d),d=e[e.length-4],f=e[e.length-3],b=e[e.length-2],c=e[e.length-1],"c"+e.join(",");default:return!1}}).replace(/z/g,"")};var g=function(a){a=a||{};var b=this,c=g.maps[a.map];this.selectedRegions=[];this.multiSelectRegion=a.multiSelectRegion;this.container=a.container;this.defaultWidth=c.width;this.defaultHeight=c.height;this.color=a.color;this.selectedColor=a.selectedColor;this.hoverColor=a.hoverColor;this.hoverOpacity=a.hoverOpacity;this.setBackgroundColor(a.backgroundColor);this.width=a.container.width();this.height=a.container.height();this.resize();jQuery(window).resize(function(){b.width=a.container.width();b.height=a.container.height();b.resize();b.canvas.setSize(b.width,b.height);b.applyTransform()});this.canvas=new l(this.width,this.height,a);a.container.append(this.canvas.canvas);this.makeDraggable();this.rootGroup=this.canvas.createGroup(!0);this.index=g.mapIndex;this.label=jQuery("\x3cdiv/\x3e").addClass("jqvmap-label").appendTo(jQuery("body")).hide();a.enableZoom&&(jQuery("\x3cdiv/\x3e").addClass("jqvmap-zoomin").text("+").appendTo(a.container),jQuery("\x3cdiv/\x3e").addClass("jqvmap-zoomout").html("\x26#x2212;").appendTo(a.container));b.countries=[];for(var d in c.pathes){var f=this.canvas.createPath({path:c.pathes[d].path});f.setFill(this.color);f.id=b.getCountryId(d);b.countries[d]=f;"svg"==this.canvas.mode?f.setAttribute("class","jvectormap-region"):jQuery(f).addClass("jvectormap-region");jQuery(this.rootGroup).append(f)}jQuery(a.container).delegate("svg"==this.canvas.mode?"path":"shape","mouseover mouseout",function(d){var e=d.target,f=d.target.id.split("_").pop(),n=h.Event("labelShow.jqvmap"),m=h.Event("regionMouseOver.jqvmap");"mouseover"==d.type?(jQuery(a.container).trigger(m,[f,c.pathes[f].name]),m.isDefaultPrevented()||b.highlight(f,e),a.showTooltip&&(b.label.text(c.pathes[f].name),jQuery(a.container).trigger(n,[b.label,f]),n.isDefaultPrevented()||(b.label.show(),b.labelWidth=b.label.width(),b.labelHeight=b.label.height()))):(b.unhighlight(f,e),b.label.hide(),jQuery(a.container).trigger("regionMouseOut.jqvmap",[f,c.pathes[f].name]))});jQuery(a.container).delegate("svg"==this.canvas.mode?"path":"shape","click",function(d){if(!a.multiSelectRegion)for(var e in c.pathes)b.countries[e].currentFillColor=b.countries[e].getOriginalFill(),b.countries[e].setFill(b.countries[e].getOriginalFill());e=d.target;d=d.target.id.split("_").pop();jQuery(a.container).trigger("regionClick.jqvmap",[d,c.pathes[d].name]);regionClickEvent.isDefaultPrevented()||(-1!==b.selectedRegions.indexOf(d)?b.deselect(d,e):b.select(d,e))});a.showTooltip&&a.container.mousemove(function(a){if(b.label.is(":visible")){var c=a.pageX-15-b.labelWidth,d=a.pageY-15-b.labelHeight;0>c&&(c=a.pageX+15);0>d&&(d=a.pageY+15);b.label.css({left:c,top:d})}});this.setColors(a.colors);this.canvas.canvas.appendChild(this.rootGroup);this.applyTransform();this.colorScale=new k(a.scaleColors,a.normalizeFunction,a.valueMin,a.valueMax);a.values&&(this.values=a.values,this.setValues(a.values));if(a.selectedRegions)if(a.selectedRegions instanceof Array)for(var m in a.selectedRegions)this.select(a.selectedRegions[m].toLowerCase());else this.select(a.selectedRegions.toLowerCase());this.bindZoomButtons();a.pins&&(this.pinHandlers=!1,this.placePins(a.pins,a.pinMode));g.mapIndex++};g.prototype={transX:0,transY:0,scale:1,baseTransX:0,baseTransY:0,baseScale:1,width:0,height:0,countries:{},countriesColors:{},countriesData:{},zoomStep:1.4,zoomMaxStep:4,zoomCurStep:1,setColors:function(a,b){if("string"==typeof a)this.countries[a].setFill(b),this.countries[a].setAttribute("original",b);else for(var c in a)this.countries[c]&&(this.countries[c].setFill(a[c]),this.countries[c].setAttribute("original",a[c]))},setValues:function(a){var b=0,c=Number.MAX_VALUE,d,f;for(f in a)d=parseFloat(a[f]),d>b&&(b=a[f]),d&&d<c&&(c=d);this.colorScale.setMin(c);this.colorScale.setMax(b);b={};for(f in a)d=parseFloat(a[f]),b[f]=d?this.colorScale.getColor(d):this.color;this.setColors(b);this.values=a},setBackgroundColor:function(a){this.container.css("background-color",a)},setScaleColors:function(a){this.colorScale.setColors(a);this.values&&this.setValues(this.values)},setNormalizeFunction:function(a){this.colorScale.setNormalizeFunction(a);this.values&&this.setValues(this.values)},highlight:function(a,b){b=b||h("#"+this.getCountryId(a))[0];this.hoverOpacity?b.setOpacity(this.hoverOpacity):this.hoverColor&&(b.currentFillColor=b.getFill()+"",b.setFill(this.hoverColor))},unhighlight:function(a,b){b=b||h("#"+this.getCountryId(a))[0];b.setOpacity(1);b.currentFillColor&&b.setFill(b.currentFillColor)},select:function(a,b){b=b||h("#"+this.getCountryId(a))[0];0>this.selectedRegions.indexOf(a)&&(this.multiSelectRegion?this.selectedRegions.push(a):this.selectedRegions=[a],h(this.container).trigger("regionSelect.jqvmap",[a]),this.selectedColor&&(b.currentFillColor=this.selectedColor,b.setFill(this.selectedColor)))},deselect:function(a,b){b=b||h("#"+this.getCountryId(a))[0];0<=this.selectedRegions.indexOf(a)&&(this.selectedRegions.splice(this.selectedRegions.indexOf(a),1),h(this.container).trigger("regionDeselect.jqvmap",[a]),b.currentFillColor=b.getOriginalFill(),b.setFill(b.getOriginalFill()))},isSelected:function(a){return 0<=this.selectedRegions.indexOf(a)},resize:function(){var a=this.baseScale;this.width/this.height>this.defaultWidth/this.defaultHeight?(this.baseScale=this.height/this.defaultHeight,this.baseTransX=Math.abs(this.width-this.defaultWidth*this.baseScale)/(2*this.baseScale)):(this.baseScale=this.width/this.defaultWidth,this.baseTransY=Math.abs(this.height-this.defaultHeight*this.baseScale)/(2*this.baseScale));this.scale*=this.baseScale/a;this.transX*=this.baseScale/a;this.transY*=this.baseScale/a},reset:function(){this.countryTitle.reset();for(var a in this.countries)this.countries[a].setFill(g.defaultColor);this.scale=this.baseScale;this.transX=this.baseTransX;this.transY=this.baseTransY;this.applyTransform()},applyTransform:function(){var a,b,c,d;this.defaultWidth*this.scale<=this.width?(a=(this.width-this.defaultWidth*this.scale)/(2*this.scale),c=(this.width-this.defaultWidth*this.scale)/(2*this.scale)):(a=0,c=(this.width-this.defaultWidth*this.scale)/this.scale);this.defaultHeight*this.scale<=this.height?(b=(this.height-this.defaultHeight*this.scale)/(2*this.scale),d=(this.height-this.defaultHeight*this.scale)/(2*this.scale)):(b=0,d=(this.height-this.defaultHeight*this.scale)/this.scale);this.transY>b?this.transY=b:this.transY<d&&(this.transY=d);this.transX>a?this.transX=a:this.transX<c&&(this.transX=c);this.canvas.applyTransformParams(this.scale,this.transX,this.transY)},makeDraggable:function(){var a=!1,b,c,d=this;d.isMoving=!1;d.isMovingTimeout=!1;this.container.mousemove(function(f){a&&(d.transX-=(b-f.pageX)/d.scale,d.transY-=(c-f.pageY)/d.scale,d.applyTransform(),b=f.pageX,c=f.pageY,d.isMoving=!0,d.isMovingTimeout&&clearTimeout(d.isMovingTimeout),d.container.trigger("drag"));return!1}).mousedown(function(d){a=!0;b=d.pageX;c=d.pageY;return!1}).mouseup(function(){a=!1;d.isMovingTimeout=setTimeout(function(){d.isMoving=!1},100);return!1})},bindZoomButtons:function(){var a=this;this.container.find(".jqvmap-zoomin").click(function(){a.zoomIn()});this.container.find(".jqvmap-zoomout").click(function(){a.zoomOut()})},zoomIn:function(){var a=(jQuery("#zoom").innerHeight()-12-30-6-7-6)/(this.zoomMaxStep-this.zoomCurStep);this.zoomCurStep<this.zoomMaxStep&&(this.transX-=(this.width/this.scale-this.width/(this.scale*this.zoomStep))/2,this.transY-=(this.height/this.scale-this.height/(this.scale*this.zoomStep))/2,this.setScale(this.scale*this.zoomStep),this.zoomCurStep++,jQuery("#zoomSlider").css("top",parseInt(jQuery("#zoomSlider").css("top"),10)-a),this.container.trigger("zoomIn"))},zoomOut:function(){var a=(jQuery("#zoom").innerHeight()-12-30-6-7-6)/(this.zoomMaxStep-this.zoomCurStep);1<this.zoomCurStep&&(this.transX+=(this.width/(this.scale/this.zoomStep)-this.width/this.scale)/2,this.transY+=(this.height/(this.scale/this.zoomStep)-this.height/this.scale)/2,this.setScale(this.scale/this.zoomStep),this.zoomCurStep--,jQuery("#zoomSlider").css("top",parseInt(jQuery("#zoomSlider").css("top"),10)+a),this.container.trigger("zoomOut"))},setScale:function(a){this.scale=a;this.applyTransform()},getCountryId:function(a){return"jqvmap"+this.index+"_"+a},getPinId:function(a){return this.getCountryId(a)+"_pin"},placePins:function(a,b){var c=this;if(!b||"content"!=b&&"id"!=b)b="content";"content"==b?jQuery.each(a,function(a,b){if(0!=jQuery("#"+c.getCountryId(a)).length){var d=c.getPinId(a);0<jQuery("#"+d).length&&jQuery("#"+d).remove();c.container.append('\x3cdiv id\x3d"'+d+'" for\x3d"'+a+'" class\x3d"jqvmap_pin" style\x3d"position:absolute"\x3e'+b+"\x3c/div\x3e")}}):jQuery.each(a,function(a,b){if(0!=jQuery("#"+c.getCountryId(a)).length){var d=c.getPinId(a);0<jQuery("#"+d).length&&jQuery("#"+d).remove();c.container.append('\x3cdiv id\x3d"'+d+'" for\x3d"'+a+'" class\x3d"jqvmap_pin" style\x3d"position:absolute"\x3e\x3c/div\x3e');jQuery("#"+d).append(jQuery("#"+b))}});this.positionPins();this.pinHandlers||(this.pinHandlers=!0,a=function(){c.positionPins()},this.container.bind("zoomIn",a).bind("zoomOut",a).bind("drag",a))},positionPins:function(){var a=this,b=this.container.find(".jqvmap_pin");jQuery.each(b,function(b,d){d=jQuery(d);b=a.getCountryId(d.attr("for"));var c=jQuery("#"+b);b=document.getElementById(b).getBBox();var g=c.position(),h=a.scale,c=g.left+b.width/2*h-d.width()/2;b=g.top+b.height/2*h-d.height()/2;d.css("left",c).css("top",b)})},getPin:function(a){return jQuery("#"+this.getPinId(a)).html()},getPins:function(){var a=this.container.find(".jqvmap_pin");jQuery.each(a,function(a,c){c=jQuery(c);a=c.attr("for");c.html();eval("ret."+a+"\x3dpinContent")});return JSON.stringify({})},removePin:function(a){jQuery("#"+this.getPinId(a)).remove()},removePins:function(){this.container.find(".jqvmap_pin").remove()}};g.xlink="http://www.w3.org/1999/xlink";g.mapIndex=1;g.maps={};var k=function(a,b,c,d){a&&this.setColors(a);b&&this.setNormalizeFunction(b);c&&this.setMin(c);c&&this.setMax(d)};k.prototype={colors:[],setMin:function(a){this.clearMinValue=a;this.minValue="function"===typeof this.normalize?this.normalize(a):a},setMax:function(a){this.clearMaxValue=a;this.maxValue="function"===typeof this.normalize?this.normalize(a):a},setColors:function(a){for(var b=0;b<a.length;b++)a[b]=k.rgbToArray(a[b]);this.colors=a},setNormalizeFunction:function(a){"polynomial"===a?this.normalize=function(a){return Math.pow(a,.2)}:"linear"===a?delete this.normalize:this.normalize=a;this.setMin(this.clearMinValue);this.setMax(this.clearMaxValue)},getColor:function(a){"function"===typeof this.normalize&&(a=this.normalize(a));for(var b=[],c=0,d,f=0;f<this.colors.length-1;f++)d=this.vectorLength(this.vectorSubtract(this.colors[f+1],this.colors[f])),b.push(d),c+=d;c=(this.maxValue-this.minValue)/c;for(f=0;f<b.length;f++)b[f]*=c;f=0;for(a-=this.minValue;0<=a-b[f];)a-=b[f],f++;for(a=f==this.colors.length-1?this.vectorToNum(this.colors[f]).toString(16):this.vectorToNum(this.vectorAdd(this.colors[f],this.vectorMult(this.vectorSubtract(this.colors[f+1],this.colors[f]),a/b[f]))).toString(16);6>a.length;)a="0"+a;return"#"+a},vectorToNum:function(a){for(var b=0,c=0;c<a.length;c++)b+=Math.round(a[c])*Math.pow(256,a.length-c-1);return b},vectorSubtract:function(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=a[d]-b[d];return c},vectorAdd:function(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=a[d]+b[d];return c},vectorMult:function(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=a[d]*b;return c},vectorLength:function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c]*a[c];return Math.sqrt(b)}};k.arrayToRgb=function(a){for(var b="#",c,d=0;d<a.length;d++)c=a[d].toString(16),b+=1==c.length?"0"+c:c;return b};k.rgbToArray=function(a){a=a.substr(1);return[parseInt(a.substr(0,2),16),parseInt(a.substr(2,2),16),parseInt(a.substr(4,2),16)]}})(jQuery);