'use strict';!function(d){var l=function(b,a){this.$element=d(b);this.options=d.extend({},d.fn.tree.defaults,a);this.$element.on("click",".tree-item",d.proxy(function(a){this.selectItem(a.currentTarget)},this));this.$element.on("click",".tree-folder-header",d.proxy(function(a){this.selectFolder(a.currentTarget)},this));this.render()};l.prototype={constructor:l,render:function(){this.populate(this.$element)},populate:function(b){var a=this,e=b.parent(),c=e.find(".tree-loader:eq(0)");c.show();this.options.dataSource.data(b.data(),function(k){c.hide();d.each(k.data,function(c,f){var g;"folder"===f.type?(g=a.$element.find(".tree-folder:eq(0)").clone().show(),g.find(".tree-folder-name").html(f.name),g.find(".tree-loader").html(a.options.loadingHTML),g.find(".tree-folder-header").data(f)):"item"===f.type&&(g=a.$element.find(".tree-item:eq(0)").clone().show(),g.find(".tree-item-name").html(f.name),g.data(f));d.each(f.dataAttributes||[],function(a,b){switch(a){case "class":case "classes":case "className":g.addClass(b);break;default:g.attr(a,b)}});b.hasClass("tree-folder-header")?e.find(".tree-folder-content:eq(0)").append(g):b.append(g)});a.$element.trigger("loaded",e)})},selectItem:function(b){var a=d(b);b=this.$element.find(".tree-selected");var e=[];this.options.multiSelect?d.each(b,function(b,c){d(c)[0]!==a[0]&&e.push(d(c).data())}):b[0]!==a[0]&&(b.removeClass("tree-selected").find("i").removeClass("icon-ok").addClass("tree-dot"),e.push(a.data()));if(this.options.selectable){var c="selected";a.hasClass("tree-selected")?(c="unselected",a.removeClass("tree-selected"),a.find("i").removeClass("icon-ok").addClass("tree-dot")):(a.addClass("tree-selected"),a.find("i").removeClass("tree-dot").addClass("icon-ok"),this.options.multiSelect&&e.push(a.data()))}e.length&&this.$element.trigger("selected",{info:e});a.trigger("updated",{info:e,item:a,eventType:c})},selectFolder:function(b){b=d(b);var a=b.parent(),e=a.find(".tree-folder-content"),c=e.eq(0),k,h,f;b.find(".icon-folder-close").length?(k="opened",h=".icon-folder-close",f="icon-folder-open",c.show(),e.children().length||this.populate(b)):(k="closed",h=".icon-folder-open",f="icon-folder-close",c.hide(),this.options.cacheItems||c.empty());a.find(h).eq(0).removeClass("icon-folder-close icon-folder-open").addClass(f);this.$element.trigger(k,b.data())},selectedItems:function(){var b=this.$element.find(".tree-selected"),a=[];d.each(b,function(b,c){a.push(d(c).data())});return a},collapse:function(){var b=this.options.cacheItems;this.$element.find(".icon-folder-open").each(function(){var a=d(this).removeClass("icon-folder-close icon-folder-open").addClass("icon-folder-close").parent().parent().children(".tree-folder-content");a.hide();b||a.empty()})}};d.fn.tree=function(b,a){var e,c=this.each(function(){var c=d(this),h=c.data("tree"),f="object"===typeof b&&b;h||c.data("tree",h=new l(this,f));"string"===typeof b&&(e=h[b](a))});return void 0===e?c:e};d.fn.tree.defaults={selectable:!0,multiSelect:!1,loadingHTML:"\x3cdiv\x3eLoading...\x3c/div\x3e",cacheItems:!0};d.fn.tree.Constructor=l}(window.jQuery);