'use strict';var myStartTask={init:function(){this.loadData();this.loadEvent()},loadData:function(){table.init({id:"#flowexample",url:common.root+"/flow/getMyStartTaskList.do",columns:"typenames,task_code,name,createtime,statename,step_name,\x3cbutton title\x3d'\u67e5\u770b\u8be6\u7ec6' onclick\x3d'myStartTask.edit(this);' class\x3d\"button button-circle button-tiny\"\x3e\x3ci class\x3d\"fa fa-edit\"\x3e\x3c/i\x3e\x3c/button\x3e\x3cbutton onclick\x3d'myStartTask.deleteFlow(this);' title\x3d'\u5220\u9664' class\x3d\"button button-circle button-tiny\"\x3e\x3ci class\x3d\"fa fa-times\"\x3e\x3c/i\x3e\x3c/button\x3e".split(","),param:function(){var a=[];a.push({name:"taskCode",value:$("#taskCode").val()});a.push({name:"taskName",value:$("#taskName").val()});a.push({name:"sendTime",value:$("#sendTime").val()});a.push({name:"lx",value:1});for(var c=$(".flowtypediv select").size(),b="-",d=0;d<c;d++){var f=$("#flowType"+d).val();""!=f&&(b+=f+"-")}b=b.substr(1);common.log(b);b=b.substr(0,b.length-1);common.log(b);c=0<=b.indexOf("-")?b.substr(b.lastIndexOf("-")+1):b;common.log(c);a.push({name:"types",value:b});a.push({name:"typelike",value:c});return a},createRow:function(a,c,b,d,f,g){return"\u64cd\u4f5c"==b&&0!=f.state?(common.log(11),"\x3cbutton title\x3d'\u67e5\u770b\u8be6\u7ec6' onclick\x3d'myStartTask.edit(this);' class\x3d\"button button-circle button-tiny\"\x3e\x3ci class\x3d\"fa fa-edit\"\x3e\x3c/i\x3e\x3c/button\x3e"):d}})},deleteFlow:function(a){common.alert({msg:"\u662f\u5426\u786e\u5b9a\u5220\u9664?",confirm:!0,fun:function(c){c&&(common.load.load("\u5220\u9664\u4e2d"),c=table.getRowData("flowexample",a),common.ajax({url:common.root+"/flow/deleteFlow.do",data:{task_cfg_id:c.task_cfg_id,task_id:c.task_id},dataType:"json",loadfun:function(b,a){common.load.hide();b?1==a.state?(common.alert("\u64cd\u4f5c\u6210\u529f"),table.refreshRedraw("flowexample")):common.alert(a.msg):common.alert(common.msg.error)}}))}})},loadEvent:function(){$(".flowtypediv ").on("change","select[t\x3d'type']",function(){var a=$(this).val(),b=$(this).attr("id").replace("flowType",""),d=$(".flowtypediv select").size();if(""==a)for(a=d;a>b;a--)$("#flowType"+a).remove();else common.ajax({url:common.root+"/flow/getType.do",data:{sup:a},dataType:"json",loadfun:function(a,c){if(a)if(common.log(c),0<c.list.length){a='\x3cselect class\x3d"form-control" t\x3d"type" id\x3d"flowType'+d+'" name\x3d"flowType'+d+'" \x3e\x3coption value\x3d"" \x3e\u8bf7\u9009\u62e9...\x3c/option\x3e';for(var e=0;e<c.list.length;e++)a+='\x3coption value\x3d"'+c.list[e].type_id+'" \x3e'+c.list[e].type_name+"\x3c/option\x3e";a+="\x3c/select\x3e";$(".flowtypediv").append(a)}else for(e=d;e>b;e--)$("#flowType"+e).remove();else common.alert(common.msg.error)}})});var a=new Date;$("#sendTime").daterangepicker({startDate:a.getFullYear()+"-"+(a.getMonth()+1)+"-02",timePicker12Hour:!1,timePicker:!0,separator:"\u81f3",timePickerIncrement:10,format:"YYYY-MM-DD HH:mm"},function(a,b,d){common.log(a.toISOString(),b.toISOString(),d)})},edit:function(a){a=table.getRowData("flowexample",a);common.log(a);common.openWindow({url:common.root+"/flow/showFlowDetail.do?task_id\x3d"+a.task_id,name:"showFlowDetail",type:3,data:{}})},del:function(a){}};$(function(){myStartTask.init()});