'use strict';(function(m){"function"===typeof define&&define.amd?define(["jquery"],m):m(jQuery)})(function(m){function f(e){if(e){for(var h in f.prototype)e[h]=f.prototype[h];return e}}var q={exports:{}};q.exports=f;f.prototype.on=function(e,h){this._callbacks=this._callbacks||{};(this._callbacks[e]=this._callbacks[e]||[]).push(h);return this};f.prototype.once=function(e,h){function c(){f.off(e,c);h.apply(this,arguments)}var f=this;this._callbacks=this._callbacks||{};h._off=c;this.on(e,c);return this};f.prototype.off=f.prototype.removeListener=f.prototype.removeAllListeners=function(e,f){this._callbacks=this._callbacks||{};var c=this._callbacks[e];if(!c)return this;if(1==arguments.length)return delete this._callbacks[e],this;var h=c.indexOf(f._off||f);~h&&c.splice(h,1);return this};f.prototype.emit=function(e){this._callbacks=this._callbacks||{};var f=[].slice.call(arguments,1),c=this._callbacks[e];if(c)for(var c=c.slice(0),k=0,m=c.length;k<m;++k)c[k].apply(this,f);return this};f.prototype.listeners=function(e){this._callbacks=this._callbacks||{};return this._callbacks[e]||[]};f.prototype.hasListeners=function(e){return!!this.listeners(e).length};(function(){var e,h,c,k,u={}.hasOwnProperty,v=function(c,d){function a(){this.constructor=c}for(var b in d)u.call(d,b)&&(c[b]=d[b]);a.prototype=d.prototype;c.prototype=new a;c.__super__=d.prototype;return c},w=[].slice;c="undefined"!==typeof m&&null!==m?m:require("jquery");e=function(e){function d(a,b){var l;this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,"");this.element=c(a);if(1!==this.element.length)throw Error("You can only instantiate dropzone on a single element.");if(this.element.data("dropzone"))throw Error("Dropzone already attached.");this.element.data("dropzone",this);a=this.element.attr("id");a=null!=(l=a?d.options[h(a)]:void 0)?l:{};this.elementTagName=this.element.get(0).tagName;this.options=function(){var a,b,c,p,d,l,e;p=arguments[0];c=2<=arguments.length?w.call(arguments,1):[];l=0;for(e=c.length;l<e;l++)for(a in b=c[l],b)d=b[a],p[a]=d;return p}({},this.defaultOptions,a,null!=b?b:{});null==this.options.url&&(this.options.url=this.element.attr("action"));if(!this.options.url)throw Error("No URL provided.");this.previewsContainer=this.options.previewsContainer?c(this.options.previewsContainer):this.element;this.init()}v(d,e);d.prototype.version="1.3.10";d.prototype.events="drop dragstart dragend dragenter dragover dragleave selectedfiles addedfile removedfile thumbnail error processingfile uploadprogress sending success complete reset".split(" ");d.prototype.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i];d.prototype.defaultOptions={url:null,parallelUploads:2,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:2,thumbnailWidth:100,thumbnailHeight:100,params:{},clickable:!0,enqueueForUpload:!0,previewsContainer:null,accept:function(a,b){return b()},fallback:function(){this.element.addClass("browser-not-supported");this.element.find(".message").removeClass("default");this.element.find(".message span").html("Your browser does not support drag'n'drop file uploads.");this.element.append("Please use the fallback form below to upload your files like in the olden days.\x3c/p\x3e");return this.element.append(this.getFallbackForm())},drop:function(a){return this.element.removeClass("drag-hover")},dragstart:c.noop,dragend:function(a){return this.element.removeClass("drag-hover")},dragenter:function(a){return this.element.addClass("drag-hover")},dragover:function(a){return this.element.addClass("drag-hover")},dragleave:function(a){return this.element.removeClass("drag-hover")},selectedfiles:function(a){if(this.element.is(this.previewsContainer))return this.element.addClass("started")},reset:function(){return this.element.removeClass("started")},addedfile:function(a){a.previewTemplate=c(this.options.previewTemplate);this.previewsContainer.append(a.previewTemplate);a.previewTemplate.find(".filename span").text(a.name);return a.previewTemplate.find(".details").append(c('\x3cdiv class\x3d"size"\x3e'+this.filesize(a.size)+"\x3c/div\x3e"))},removedfile:function(a){return a.previewTemplate.remove()},thumbnail:function(a,b){a.previewTemplate.removeClass("file-preview").addClass("image-preview");return a.previewTemplate.find(".details").append(c('\x3cimg alt\x3d"'+a.name+'" src\x3d"'+b+'"/\x3e'))},error:function(a,b){a.previewTemplate.addClass("error");return a.previewTemplate.find(".error-message span").text(b)},processingfile:function(a){return a.previewTemplate.addClass("processing")},uploadprogress:function(a,b){return a.previewTemplate.find(".progress .upload").css({width:""+b+"%"})},sending:c.noop,success:function(a){return a.previewTemplate.addClass("success")},complete:c.noop,previewTemplate:'\x3cdiv class\x3d"preview file-preview"\x3e\n  \x3cdiv class\x3d"details"\x3e\n   \x3cdiv class\x3d"filename"\x3e\x3cspan\x3e\x3c/span\x3e\x3c/div\x3e\n  \x3c/div\x3e\n  \x3cdiv class\x3d"progress"\x3e\x3cspan class\x3d"upload"\x3e\x3c/span\x3e\x3c/div\x3e\n  \x3cdiv class\x3d"success-mark"\x3e\x3cspan\x3e\u2714\x3c/span\x3e\x3c/div\x3e\n  \x3cdiv class\x3d"error-mark"\x3e\x3cspan\x3e\u2718\x3c/span\x3e\x3c/div\x3e\n  \x3cdiv class\x3d"error-message"\x3e\x3cspan\x3e\x3c/span\x3e\x3c/div\x3e\n\x3c/div\x3e'};d.prototype.init=function(){var a,b,l,d,n,g,p=this;"form"===this.elementTagName&&"multipart/form-data"!==this.element.attr("enctype")&&this.element.attr("enctype","multipart/form-data");this.element.hasClass("dropzone")&&0===this.element.find(".message").length&&this.element.append(c('\x3cdiv class\x3d"default message"\x3e\x3cspan\x3eDrop files here to upload\x3c/span\x3e\x3c/div\x3e'));a=!0;if(window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData)for(n=this.blacklistedBrowsers,l=0,d=n.length;l<d;l++)b=n[l],b.test(navigator.userAgent)&&(a=!1);else a=!1;if(!a)return this.options.fallback.call(this);this.options.clickable&&(this.element.addClass("clickable"),this.hiddenFileInput=c('\x3cinput type\x3d"file" multiple /\x3e'),this.element.click(function(a){a=c(a.target);if(a.is(p.element)||a.is(p.element.find(".message")))return p.hiddenFileInput.click()}),this.hiddenFileInput.change(function(){var a;a=p.hiddenFileInput.get(0).files;p.emit("selectedfiles",a);if(a.length)return p.handleFiles(a)}));this.files=[];this.filesQueue=[];this.filesProcessing=[];this.URL=null!=(g=window.URL)?g:window.webkitURL;return this.setupEventListeners()};d.prototype.getFallbackForm=function(){var a;a=c('\x3cdiv class\x3d"fallback-elements"\x3e\x3cinput type\x3d"file" name\x3d"'+this.options.paramName+'" multiple\x3d"multiple" /\x3e\x3cbutton type\x3d"submit"\x3eUpload!\x3c/button\x3e\x3c/div\x3e');"FORM"!==this.elementTagName?a=c('\x3cform action\x3d"'+this.options.url+'" enctype\x3d"multipart/form-data" method\x3d"post"\x3e\x3c/form\x3e').append(a):(this.element.attr("enctype")||this.element.attr("enctype","multipart/form-data"),this.element.attr("method")||this.element.attr("method","post"));return a};d.prototype.setupEventListeners=function(){var a,b,c,d,n,g=this;n=this.events;c=0;for(d=n.length;c<d;c++)a=n[c],this.on(a,this.options[a]);b=function(a){a.stopPropagation();return a.preventDefault()};this.element.on("dragstart.dropzone",function(a){return g.emit("dragstart",a)});this.element.on("dragenter.dropzone",function(a){b(a);return g.emit("dragenter",a)});this.element.on("dragover.dropzone",function(a){b(a);return g.emit("dragover",a)});this.element.on("dragleave.dropzone",function(a){return g.emit("dragleave",a)});this.element.on("drop.dropzone",function(a){b(a);g.drop(a);return g.emit("drop",a)});return this.element.on("dragend.dropzone",function(a){return g.emit("dragend",a)})};d.prototype.removeEventListeners=function(){return this.element.off(".dropzone")};d.prototype.disable=function(){this.removeEventListeners();this.files=[];this.filesProcessing=[];return this.filesQueue=[]};d.prototype.filesize=function(a){var b;1E11<=a?(a/=1E11,b="TB"):1E8<=a?(a/=1E8,b="GB"):1E5<=a?(a/=1E5,b="MB"):100<=a?(a/=100,b="KB"):(a*=10,b="b");return"\x3cstrong\x3e"+Math.round(a)/10+"\x3c/strong\x3e "+b};d.prototype.drop=function(a){if(a.originalEvent.dataTransfer&&(a=a.originalEvent.dataTransfer.files,this.emit("selectedfiles",a),a.length))return this.handleFiles(a)};d.prototype.handleFiles=function(a){var b,c,d,n;n=[];c=0;for(d=a.length;c<d;c++)b=a[c],n.push(this.addFile(b));return n};d.prototype.accept=function(a,b){return a.size>1048576*this.options.maxFilesize?b("File is too big ("+Math.round(a.size/1024/10.24)/100+"MB). Max filesize: "+this.options.maxFilesize+"MB"):this.options.accept.call(this,a,b)};d.prototype.addFile=function(a){var b=this;this.files.push(a);this.emit("addedfile",a);this.options.createImageThumbnails&&a.type.match(/image.*/)&&a.size<=1048576*this.options.maxThumbnailFilesize&&this.createThumbnail(a);return this.accept(a,function(c){if(c)return b.errorProcessing(a,c);if(b.options.enqueueForUpload)return b.filesQueue.push(a),b.processQueue()})};d.prototype.removeFile=function(a){if(a.processing)throw Error("Can't remove file currently processing");this.files=k(this.files,a);this.filesQueue=k(this.filesQueue,a);this.emit("removedfile",a);if(0===this.files.length)return this.emit("reset")};d.prototype.createThumbnail=function(a){var b,c=this;b=new FileReader;b.onload=function(){var d;d=new Image;d.onload=function(){var b,g,e,l,f,h,t,k;b=document.createElement("canvas");g=b.getContext("2d");f=d.width;e=d.height;b.width=c.options.thumbnailWidth;b.height=c.options.thumbnailHeight;k=b.width;h=b.height;l=d.width/d.height;t=b.width/b.height;d.height<b.height||d.width<b.width?(h=e,k=f):l>t?(e=d.height,f=e*t):(f=d.width,e=f/t);g.drawImage(d,(d.width-f)/2,(d.height-e)/2,f,e,(b.width-k)/2,(b.height-h)/2,k,h);b=b.toDataURL("image/png");return c.emit("thumbnail",a,b)};return d.src=b.result};return b.readAsDataURL(a)};d.prototype.processQueue=function(){var a,b;b=this.options.parallelUploads;for(a=this.filesProcessing.length;a<b&&this.filesQueue.length;)this.processFile(this.filesQueue.shift()),a++};d.prototype.processFile=function(a){this.filesProcessing.push(a);a.processing=!0;this.emit("processingfile",a);return this.uploadFile(a)};d.prototype.uploadFile=function(a){var b,d,e,f,g,h,k,m,r=this;g=new XMLHttpRequest;g.open("POST",this.options.url,!0);d=function(){return r.errorProcessing(a,g.responseText||"Server responded with "+g.status+" code.")};g.onload=function(b){var c;if(200!==g.status)return d();r.emit("uploadprogress",a,100);c=g.responseText;g.getResponseHeader("content-type")&&~g.getResponseHeader("content-type").indexOf("application/json")&&(c=JSON.parse(c));return r.finished(a,c,b)};g.onerror=function(){return d()};(null!=(b=g.upload)?b:g).onprogress=function(b){return r.emit("uploadprogress",a,Math.max(0,Math.min(100,b.loaded/b.total*100)))};g.setRequestHeader("Accept","application/json");g.setRequestHeader("Cache-Control","no-cache");g.setRequestHeader("X-Requested-With","XMLHttpRequest");g.setRequestHeader("X-File-Name",a.name);b=new FormData;if(this.options.params)for(e in h=this.options.params,h)f=h[e],b.append(e,f);this.elementTagName="FORM";m=this.element.find("input, textarea, select, button");h=0;for(k=m.length;h<k;h++)f=m[h],e=c(f),e.attr("name"),e.attr("type")&&"checkbox"===e.attr("type").toLowerCase()&&!f.checked||b.append(e.attr("name"),e.val());this.emit("sending",a,g,b);b.append(this.options.paramName,a);return g.send(b)};d.prototype.finished=function(a,b,d){this.filesProcessing=k(this.filesProcessing,a);a.processing=!1;this.processQueue();this.emit("success",a,b,d);this.emit("finished",a,b,d);return this.emit("complete",a)};d.prototype.errorProcessing=function(a,b){this.filesProcessing=k(this.filesProcessing,a);a.processing=!1;this.processQueue();this.emit("error",a,b);return this.emit("complete",a)};return d}("undefined"!==typeof f&&null!==f?f:require("emitter"));e.options={};k=function(c,d){var a,b,e,f;f=[];b=0;for(e=c.length;b<e;b++)a=c[b],a!==d&&f.push(a);return f};h=function(c){return c.replace(/[\-_](\w)/g,function(c){return c[1].toUpperCase()})};c.fn.dropzone=function(c){return this.each(function(){return new e(this,c)})};c(function(){return c(".dropzone").dropzone()});"undefined"!==typeof q&&null!==q?q.exports=e:window.Dropzone=e}).call(this);return q.exports});