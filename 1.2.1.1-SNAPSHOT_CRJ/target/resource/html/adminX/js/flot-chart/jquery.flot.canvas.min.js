'use strict';(function(l){var m,v,w,n=Object.prototype.hasOwnProperty;l.plot.plugins.push({init:function(p,g){g=g.Canvas;null==m&&(v=g.prototype.getTextInfo,w=g.prototype.addText,m=g.prototype.render);g.prototype.render=function(){if(!p.getOptions().canvas)return m.call(this);var d=this.context,e=this._textCache;d.save();d.textBaseline="middle";for(var b in e)if(n.call(e,b)){var c=e[b],a;for(a in c)if(n.call(c,a)){var h=c[a],k=!0,g;for(g in h)if(n.call(h,g)){var f=h[g],q=f.positions,l=f.lines;k&&(d.fillStyle=f.font.color,d.font=f.font.definition,k=!1);for(var f=0,r;r=q[f];f++)if(r.active)for(var t=0,u;u=r.lines[t];t++)d.fillText(l[t].text,u[0],u[1]);else q.splice(f--,1);0==q.length&&delete h[g]}}}d.restore()};g.prototype.getTextInfo=function(d,e,b,c,a){if(!p.getOptions().canvas)return v.call(this,d,e,b,c,a);var h,k;e=""+e;h="object"===typeof b?b.style+" "+b.variant+" "+b.weight+" "+b.size+"px "+b.family:b;c=this._textCache[d];null==c&&(c=this._textCache[d]={});k=c[h];null==k&&(k=c[h]={});a=k[e];if(null==a){c=this.context;"object"!==typeof b&&(a=l("\x3cdiv\x3e\x26nbsp;\x3c/div\x3e").css("position","absolute").addClass("string"===typeof b?b:null).appendTo(this.getTextLayer(d)),b={lineHeight:a.height(),style:a.css("font-style"),variant:a.css("font-variant"),weight:a.css("font-weight"),family:a.css("font-family"),color:a.css("color")},b.size=a.css("line-height",1).height(),a.remove());h=b.style+" "+b.variant+" "+b.weight+" "+b.size+"px "+b.family;a=k[e]={width:0,height:0,positions:[],lines:[],font:{definition:h,color:b.color}};c.save();c.font=h;e=(e+"").replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n");for(d=0;d<e.length;++d)k=e[d],h=c.measureText(k),a.width=Math.max(h.width,a.width),a.height+=b.lineHeight,a.lines.push({text:k,width:h.width,height:b.lineHeight});c.restore()}return a};g.prototype.addText=function(d,e,b,c,a,h,k,g,f){if(!p.getOptions().canvas)return w.call(this,d,e,b,c,a,h,k,g,f);a=this.getTextInfo(d,c,a,h,k);c=a.positions;d=a.lines;b+=a.height/d.length/2;b="middle"==f?Math.round(b-a.height/2):"bottom"==f?Math.round(b-a.height):Math.round(b);window.opera&&12>window.opera.version().split(".")[0]&&(b-=2);for(f=0;a=c[f];f++)if(a.x==e&&a.y==b){a.active=!0;return}a={active:!0,lines:[],x:e,y:b};c.push(a);for(f=0;c=d[f];f++)"center"==g?a.lines.push([Math.round(e-c.width/2),b]):"right"==g?a.lines.push([Math.round(e-c.width),b]):a.lines.push([Math.round(e),b]),b+=c.height}},options:{canvas:!0},name:"canvas",version:"1.0"})})(jQuery);