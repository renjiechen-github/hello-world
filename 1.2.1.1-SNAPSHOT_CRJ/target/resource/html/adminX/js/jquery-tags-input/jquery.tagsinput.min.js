'use strict';(function(a){var k=[],f=[];a.fn.doAutosize=function(d){var c=a(this).data("minwidth"),b=a(this).data("maxwidth"),e="",g=a(this),h=a("#"+a(this).data("tester_id"));e!==(e=g.val())&&(e=e.replace(/&/g,"\x26amp;").replace(/\s/g," ").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;"),h.html(e),h=h.width(),d=h+d.comfortZone>=c?h+d.comfortZone:c,h=g.width(),(d<h&&d>=c||d>c&&d<b)&&g.width(d))};a.fn.resetAutosize=function(d){var c=a(this).data("minwidth")||d.minInputWidth||a(this).width();d=a(this).data("maxwidth")||d.maxInputWidth||a(this).closest(".tagsinput").width()-d.inputPadding;var b=a(this),e=a("\x3ctester/\x3e").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:b.css("fontSize"),fontFamily:b.css("fontFamily"),fontWeight:b.css("fontWeight"),letterSpacing:b.css("letterSpacing"),whiteSpace:"nowrap"}),g=a(this).attr("id")+"_autosize_tester";0< !a("#"+g).length&&(e.attr("id",g),e.appendTo("body"));b.data("minwidth",c);b.data("maxwidth",d);b.data("tester_id",g);b.css("width",c)};a.fn.addTag=function(d,c){c=jQuery.extend({focus:!1,callback:!0},c);this.each(function(){var b=a(this).attr("id"),e=a(this).val().split(k[b]);""==e[0]&&(e=[]);d=jQuery.trim(d);if(c.unique){var g=a(this).tagExist(d);1==g&&a("#"+b+"_tag").addClass("not_valid")}else g=!1;if(""!=d&&1!=g&&(a("\x3cspan\x3e").addClass("tag").append(a("\x3cspan\x3e").text(d).append("\x26nbsp;\x26nbsp;"),a("\x3ca\x3e",{href:"#",title:"Removing tag",text:"x"}).click(function(){return a("#"+b).removeTag(escape(d))})).insertBefore("#"+b+"_addTag"),e.push(d),a("#"+b+"_tag").val(""),c.focus?a("#"+b+"_tag").focus():a("#"+b+"_tag").blur(),a.fn.tagsInput.updateTagsField(this,e),c.callback&&f[b]&&f[b].onAddTag&&(g=f[b].onAddTag,g.call(this,d)),f[b]&&f[b].onChange)){var h=e.length,g=f[b].onChange;g.call(this,a(this),e[h-1])}});return!1};a.fn.removeTag=function(d){d=unescape(d);this.each(function(){var c=a(this).attr("id"),b=a(this).val().split(k[c]);a("#"+c+"_tagsinput .tag").remove();str="";for(i=0;i<b.length;i++)b[i]!=d&&(str=str+k[c]+b[i]);a.fn.tagsInput.importTags(this,str);f[c]&&f[c].onRemoveTag&&f[c].onRemoveTag.call(this,d)});return!1};a.fn.tagExist=function(d){var c=a(this).attr("id"),c=a(this).val().split(k[c]);return 0<=jQuery.inArray(d,c)};a.fn.importTags=function(d){id=a(this).attr("id");a("#"+id+"_tagsinput .tag").remove();a.fn.tagsInput.importTags(this,d)};a.fn.tagsInput=function(d){var c=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},d);this.each(function(){c.hide&&a(this).hide();var b=a(this).attr("id");if(!b||k[a(this).attr("id")])b=a(this).attr("id","tags"+(new Date).getTime()).attr("id");var e=jQuery.extend({pid:b,real_input:"#"+b,holder:"#"+b+"_tagsinput",input_wrapper:"#"+b+"_addTag",fake_input:"#"+b+"_tag"},c);k[b]=e.delimiter;if(c.onAddTag||c.onRemoveTag||c.onChange)f[b]=[],f[b].onAddTag=c.onAddTag,f[b].onRemoveTag=c.onRemoveTag,f[b].onChange=c.onChange;var d='\x3cdiv id\x3d"'+b+'_tagsinput" class\x3d"tagsinput"\x3e\x3cdiv id\x3d"'+b+'_addTag"\x3e';c.interactive&&(d=d+'\x3cinput id\x3d"'+b+'_tag" value\x3d"" data-default\x3d"'+c.defaultText+'" /\x3e');a(d+'\x3c/div\x3e\x3cdiv class\x3d"tags_clear"\x3e\x3c/div\x3e\x3c/div\x3e').insertAfter(this);a(e.holder).css("width",c.width);a(e.holder).css("min-height",c.height);a(e.holder).css("height","100%");""!=a(e.real_input).val()&&a.fn.tagsInput.importTags(a(e.real_input),a(e.real_input).val());if(c.interactive){a(e.fake_input).val(a(e.fake_input).attr("data-default"));a(e.fake_input).css("color",c.placeholderColor);a(e.fake_input).resetAutosize(c);a(e.holder).bind("click",e,function(c){a(c.data.fake_input).focus()});a(e.fake_input).bind("focus",e,function(c){a(c.data.fake_input).val()==a(c.data.fake_input).attr("data-default")&&a(c.data.fake_input).val("");a(c.data.fake_input).css("color","#000000")});if(void 0!=c.autocomplete_url){autocomplete_options={source:c.autocomplete_url};for(attrname in c.autocomplete)autocomplete_options[attrname]=c.autocomplete[attrname];void 0!==jQuery.Autocompleter?(a(e.fake_input).autocomplete(c.autocomplete_url,c.autocomplete),a(e.fake_input).bind("result",e,function(h,d,e){d&&a("#"+b).addTag(d[0]+"",{focus:!0,unique:c.unique})})):void 0!==jQuery.ui.autocomplete&&(a(e.fake_input).autocomplete(autocomplete_options),a(e.fake_input).bind("autocompleteselect",e,function(b,d){a(b.data.real_input).addTag(d.item.value,{focus:!0,unique:c.unique});return!1}))}else a(e.fake_input).bind("blur",e,function(b){var d=a(this).attr("data-default");""!=a(b.data.fake_input).val()&&a(b.data.fake_input).val()!=d?b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:c.unique}):(a(b.data.fake_input).val(a(b.data.fake_input).attr("data-default")),a(b.data.fake_input).css("color",c.placeholderColor));return!1});a(e.fake_input).bind("keypress",e,function(b){if(b.which==b.data.delimiter.charCodeAt(0)||13==b.which)return b.preventDefault(),b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:c.unique}),a(b.data.fake_input).resetAutosize(c),!1;b.data.autosize&&a(b.data.fake_input).doAutosize(c)});e.removeWithBackspace&&a(e.fake_input).bind("keydown",function(b){if(8==b.keyCode&&""==a(this).val()){b.preventDefault();b=a(this).closest(".tagsinput").find(".tag:last").text();var c=a(this).attr("id").replace(/_tag$/,"");b=b.replace(/[\s]+x$/,"");a("#"+c).removeTag(escape(b));a(this).trigger("focus")}});a(e.fake_input).blur();e.unique&&a(e.fake_input).keydown(function(b){(8==b.keyCode||String.fromCharCode(b.which).match(/\w+|[\u00e1\u00e9\u00ed\u00f3\u00fa\u00c1\u00c9\u00cd\u00d3\u00da\u00f1\u00d1,/]+/))&&a(this).removeClass("not_valid")})}});return this};a.fn.tagsInput.updateTagsField=function(d,c){var b=a(d).attr("id");a(d).val(c.join(k[b]))};a.fn.tagsInput.importTags=function(d,c){a(d).val("");var b=a(d).attr("id");c=c.split(k[b]);for(i=0;i<c.length;i++)a(d).addTag(c[i],{focus:!1,callback:!1});f[b]&&f[b].onChange&&f[b].onChange.call(d,d,c[i])}})(jQuery);