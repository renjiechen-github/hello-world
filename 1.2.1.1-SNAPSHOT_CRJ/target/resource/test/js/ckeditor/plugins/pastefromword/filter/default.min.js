'use strict';(function(){function D(a){a=a.toUpperCase();for(var b=E.length,c=0,d=0;d<b;++d)for(var e=E[d],f=e[1].length;a.substr(0,f)==e[1];a=a.substr(f))c+=e[0];return c}function F(a){a=a.toUpperCase();for(var b=G.length,c=1,d=1;0<a.length;d*=b)c+=G.indexOf(a.charAt(a.length-1))*d,a=a.substr(0,a.length-1);return c}var H=CKEDITOR.htmlParser.fragment.prototype,z=CKEDITOR.htmlParser.element.prototype;H.onlyChild=z.onlyChild=function(){var a=this.children;return 1==a.length&&a[0]||null};z.removeAnyChildWithName=function(a){for(var b=this.children,c=[],d,e=0;e<b.length;e++)d=b[e],d.name&&(d.name==a&&(c.push(d),b.splice(e--,1)),c=c.concat(d.removeAnyChildWithName(a)));return c};z.getAncestor=function(a){for(var b=this.parent;b&&(!b.name||!b.name.match(a));)b=b.parent;return b};H.firstChild=z.firstChild=function(a){for(var b,c=0;c<this.children.length;c++)if(b=this.children[c],a(b)||b.name&&(b=b.firstChild(a)))return b;return null};z.addStyle=function(a,b,c){var d="";if("string"==typeof b)d+=a+":"+b+";";else{if("object"==typeof a)for(var e in a)a.hasOwnProperty(e)&&(d+=e+":"+a[e]+";");else d+=a;c=b}this.attributes||(this.attributes={});a=this.attributes.style||"";a=(c?[d,a]:[a,d]).join(";");this.attributes.style=a.replace(/^;|;(?=;)/,"")};z.getStyle=function(a){var b=this.attributes.style;if(b)return b=CKEDITOR.tools.parseCssText(b,1),b[a]};CKEDITOR.dtd.parentOf=function(a){var b={},c;for(c in this)-1==c.indexOf("$")&&this[c][a]&&(b[c]=1);return b};var L=/^([.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz){1}?/i,I=/^(?:\b0[^\s]*\s*){1,4}$/,C={ol:{decimal:/\d+/,"lower-roman":/^m{0,4}(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})$/,"upper-roman":/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/,"lower-alpha":/^[a-z]+$/,"upper-alpha":/^[A-Z]+$/},ul:{disc:/[l\u00B7\u2002]/,circle:/[\u006F\u00D8]/,square:/[\u006E\u25C6]/}},E=[[1E3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]],G="ABCDEFGHIJKLMNOPQRSTUVWXYZ",A=0,t=null,B,J=CKEDITOR.plugins.pastefromword={utils:{createListBulletMarker:function(a,b){var c=new CKEDITOR.htmlParser.element("cke:listbullet");c.attributes={"cke:listsymbol":a[0]};c.add(new CKEDITOR.htmlParser.text(b));return c},isListBulletIndicator:function(a){if(/mso-list\s*:\s*Ignore/i.test(a.attributes&&a.attributes.style))return!0},isContainingOnlySpaces:function(a){var b;return(b=a.onlyChild())&&/^(:?\s|&nbsp;)+$/.test(b.value)},resolveList:function(a){var b=a.attributes,c;if((c=a.removeAnyChildWithName("cke:listbullet"))&&c.length&&(c=c[0]))return a.name="cke:li",b.style&&(b.style=J.filters.stylesFilter([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(a){a=a.split(" ");a=CKEDITOR.tools.convertToPx(a[3]||a[1]||a[0]);!A&&null!==t&&a>t&&(A=a-t);t=a;b["cke:indent"]=A&&Math.ceil(a/A)+1||1}],[/^mso-list$/,null,function(a){a=a.split(" ");var c=Number(a[0].match(/\d+/));a=Number(a[1].match(/\d+/));1==a&&(c!==B&&(b["cke:reset"]=1),B=c);b["cke:indent"]=a}]])(b.style,a)||""),b["cke:indent"]||(t=0,b["cke:indent"]=1),CKEDITOR.tools.extend(b,c.attributes),!0;B=t=A=null;return!1},getStyleComponents:function(){var a=CKEDITOR.dom.element.createFromHtml('\x3cdiv style\x3d"position:absolute;left:-9999px;top:-9999px;"\x3e\x3c/div\x3e',CKEDITOR.document);CKEDITOR.document.getBody().append(a);return function(b,c,d){a.setStyle(b,c);b={};c=d.length;for(var e=0;e<c;e++)b[d[e]]=a.getStyle(d[e]);return b}}(),listDtdParents:CKEDITOR.dtd.parentOf("ol")},filters:{flattenList:function(a,b){b="number"==typeof b?b:1;var c=a.attributes,d;switch(c.type){case "a":d="lower-alpha";break;case "1":d="decimal"}for(var e=a.children,f,g=0;g<e.length;g++)if(f=e[g],f.name in CKEDITOR.dtd.$listItem){var h=f.attributes,k=f.children,u=k[k.length-1];u.name in CKEDITOR.dtd.$list&&(a.add(u,g+1),--k.length||e.splice(g--,1));f.name="cke:li";c.start&&!g&&(h.value=c.start);J.filters.stylesFilter([["tab-stops",null,function(a){(a=a.split(" ")[1].match(L))&&(t=CKEDITOR.tools.convertToPx(a[0]))}],1==b?["mso-list",null,function(a){a=a.split(" ");a=Number(a[0].match(/\d+/));a!==B&&(h["cke:reset"]=1);B=a}]:null])(h.style);h["cke:indent"]=b;h["cke:listtype"]=a.name;h["cke:list-style-type"]=d}else if(f.name in CKEDITOR.dtd.$list)for(arguments.callee.apply(this,[f,b+1]),e=e.slice(0,g).concat(f.children).concat(e.slice(g+1)),a.children=[],f=0,k=e.length;f<k;f++)a.add(e[f]);delete a.name;c["cke:list"]=1},assembleList:function(a){var b=a.children,c,d,e,f,g,h;a=[];for(var k,u,n,m,q,w,v=0;v<b.length;v++)if(c=b[v],"cke:li"==c.name)if(c.name="li",d=c.attributes,n=(n=d["cke:listsymbol"])&&n.match(/^(?:[(]?)([^\s]+?)([.)]?)$/),m=q=w=null,d["cke:ignored"])b.splice(v--,1);else{d["cke:reset"]&&(h=f=g=null);e=Number(d["cke:indent"]);e!=f&&(u=k=null);if(n){if(u&&C[u][k].test(n[1]))m=u,q=k;else for(var x in C)for(var y in C[x])if(C[x][y].test(n[1]))if("ol"==x&&/alpha|roman/.test(y)){if(k=/roman/.test(y)?D(n[1]):F(n[1]),!w||k<w)w=k,m=x,q=y}else{m=x;q=y;break}!m&&(m=n[2]?"ol":"ul")}else m=d["cke:listtype"]||"ol",q=d["cke:list-style-type"];u=m;k=q||("ol"==m?"decimal":"disc");q&&q!=("ol"==m?"decimal":"disc")&&c.addStyle("list-style-type",q);if("ol"==m&&n){switch(q){case "decimal":w=Number(n[1]);break;case "lower-roman":case "upper-roman":w=D(n[1]);break;case "lower-alpha":case "upper-alpha":w=F(n[1])}c.attributes.value=w}if(h){if(e>f)a.push(h=new CKEDITOR.htmlParser.element(m)),h.add(c),g.add(h);else{if(e<f){f-=e;for(var p;f--&&(p=h.parent);)h=p.parent}h.add(c)}b.splice(v--,1)}else a.push(h=new CKEDITOR.htmlParser.element(m)),h.add(c),b[v]=h;g=c;f=e}else h&&(h=f=g=null);for(v=0;v<a.length;v++)if(h=a[v],x=h.children,k=k=void 0,y=h.children.length,p=k=void 0,b=/list-style-type:(.*?)(?:;|$)/,f=CKEDITOR.plugins.pastefromword.filters.stylesFilter,k=h.attributes,!b.exec(k.style)){for(g=0;g<y;g++)if(k=x[g],k.attributes.value&&Number(k.attributes.value)==g+1&&delete k.attributes.value,k=b.exec(k.attributes.style))if(k[1]!=p&&p){p=null;break}else p=k[1];if(p){for(g=0;g<y;g++)k=x[g].attributes,k.style&&(k.style=f([["list-style-type"]])(k.style)||"");h.addStyle("list-style-type",p)}}B=t=A=null},falsyFilter:function(){return!1},stylesFilter:function(a,b){return function(c,d){var e=[];(c||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(c,g,h){g=g.toLowerCase();"font-family"==g&&(h=h.replace(/["']/g,""));for(var k,f,n,m=0;m<a.length;m++)if(a[m]&&(c=a[m][0],k=a[m][1],f=a[m][2],n=a[m][3],g.match(c)&&(!k||h.match(k)))){g=n||g;b&&(f=f||h);"function"==typeof f&&(f=f(h,d,g));f&&f.push&&(g=f[0],f=f[1]);"string"==typeof f&&e.push([g,f]);return}!b&&e.push([g,h])});for(c=0;c<e.length;c++)e[c]=e[c].join(":");return e.length?e.join(";")+";":!1}},elementMigrateFilter:function(a,b){return a?function(c){var d=b?(new CKEDITOR.style(a,b))._.definition:a;c.name=d.element;CKEDITOR.tools.extend(c.attributes,CKEDITOR.tools.clone(d.attributes));c.addStyle(CKEDITOR.style.getStyleText(d))}:function(){}},styleMigrateFilter:function(a,b){var c=this.elementMigrateFilter;return a?function(d,e){var f=new CKEDITOR.htmlParser.element(null),g={};g[b]=d;c(a,g)(f);f.children=e.children;e.children=[f]}:function(){}},bogusAttrFilter:function(a,b){if(-1==b.name.indexOf("cke:"))return!1},applyStyleFilter:null},getRules:function(a){var b=CKEDITOR.dtd,c=CKEDITOR.tools.extend({},b.$block,b.$listItem,b.$tableContent),d=a.config,e=this.filters;a=e.falsyFilter;var f=e.stylesFilter,g=e.elementMigrateFilter,h=CKEDITOR.tools.bind(this.filters.styleMigrateFilter,this.filters),k=this.utils.createListBulletMarker,u=e.flattenList,n=e.assembleList,m=this.utils.isListBulletIndicator,q=this.utils.isContainingOnlySpaces,w=this.utils.resolveList,v=function(a){a=CKEDITOR.tools.convertToPx(a);return isNaN(a)?a:a+"px"},x=this.utils.getStyleComponents,y=this.utils.listDtdParents,p=!1!==d.pasteFromWordRemoveFontStyles,t=!1!==d.pasteFromWordRemoveStyles;return{elementNames:[[/meta|link|script/,""]],root:function(a){a.filterChildren();n(a)},elements:{"^":function(a){var l;CKEDITOR.env.gecko&&(l=e.applyStyleFilter)&&l(a)},$:function(a){var r=a.name||"",l=a.attributes;r in c&&l.style&&(l.style=f([[/^(:?width|height)$/,null,v]])(l.style)||"");if(r.match(/h\d/)){a.filterChildren();if(w(a))return;g(d["format_"+r])(a)}else if(r in b.$inline)a.filterChildren(),q(a)&&delete a.name;else if(-1!=r.indexOf(":")&&-1==r.indexOf("cke")){a.filterChildren();if("v:imagedata"==r){if(r=a.attributes["o:href"])a.attributes.src=r;a.name="img";return}delete a.name}r in y&&(a.filterChildren(),n(a))},style:function(a){if(CKEDITOR.env.gecko){a=(a=a.onlyChild().value.match(/\/\* Style Definitions \*\/([\s\S]*?)\/\*/))&&a[1];var b={};a&&(a.replace(/[\n\r]/g,"").replace(/(.+?)\{(.+?)\}/g,function(a,l,r){l=l.split(",");a=l.length;for(var c=0;c<a;c++)CKEDITOR.tools.trim(l[c]).replace(/^(\w+)(\.[\w-]+)?$/g,function(a,l,c){l=l||"*";c=c.substring(1,c.length);c.match(/MsoNormal/)||(b[l]||(b[l]={}),c?b[l][c]=r:b[l]=r)})}),e.applyStyleFilter=function(a){var l=b["*"]?"*":a.name,c=a.attributes&&a.attributes["class"];l in b&&(l=b[l],"object"==typeof l&&(l=l[c]),l&&a.addStyle(l,!0))})}return!1},p:function(a){if(/MsoListParagraph/i.exec(a.attributes["class"])||a.getStyle("mso-list")){var b=a.firstChild(function(a){return a.type==CKEDITOR.NODE_TEXT&&!q(a.parent)});(b=b&&b.parent)&&b.addStyle("mso-list","Ignore")}a.filterChildren();w(a)||(d.enterMode==CKEDITOR.ENTER_BR?(delete a.name,a.add(new CKEDITOR.htmlParser.element("br"))):g(d["format_"+(d.enterMode==CKEDITOR.ENTER_P?"p":"div")])(a))},div:function(a){var b=a.onlyChild();if(b&&"table"==b.name){var c=a.attributes;b.attributes=CKEDITOR.tools.extend(b.attributes,c);c.style&&b.addStyle(c.style);b=new CKEDITOR.htmlParser.element("div");b.addStyle("clear","both");a.add(b);delete a.name}},td:function(a){a.getAncestor("thead")&&(a.name="th")},ol:u,ul:u,dl:u,font:function(a){if(m(a.parent))delete a.name;else{a.filterChildren();var b=a.attributes,c=b.style,l=a.parent;"font"==l.name?(CKEDITOR.tools.extend(l.attributes,a.attributes),c&&l.addStyle(c),delete a.name):(c=c||"",b.color&&("#000000"!=b.color&&(c+="color:"+b.color+";"),delete b.color),b.face&&(c+="font-family:"+b.face+";",delete b.face),b.size&&(c+="font-size:"+(3<b.size?"large":3>b.size?"small":"medium")+";",delete b.size),a.name="span",a.addStyle(c))}},span:function(a){if(m(a.parent))return!1;a.filterChildren();if(q(a))return delete a.name,null;if(m(a)){var b=a.firstChild(function(a){return a.value||"img"==a.name}),c=(b=b&&(b.value||"l."))&&b.match(/^(?:[(]?)([^\s]+?)([.)]?)$/);if(c)return b=k(c,b),(a=a.getAncestor("span"))&&/ mso-hide:\s*all|display:\s*none /.test(a.attributes.style)&&(b.attributes["cke:ignored"]=1),b}if(c=(b=a.attributes)&&b.style)b.style=f([["line-height"],[/^font-family$/,null,p?null:h(d.font_style,"family")],[/^font-size$/,null,p?null:h(d.fontSize_style,"size")],[/^color$/,null,p?null:h(d.colorButton_foreStyle,"color")],[/^background-color$/,null,p?null:h(d.colorButton_backStyle,"color")]])(c,a)||"";b.style||delete b.style;CKEDITOR.tools.isEmpty(b)&&delete a.name;return null},b:g(d.coreStyles_bold),i:g(d.coreStyles_italic),u:g(d.coreStyles_underline),s:g(d.coreStyles_strike),sup:g(d.coreStyles_superscript),sub:g(d.coreStyles_subscript),a:function(a){var b=a.attributes;b&&!b.href&&b.name?delete a.name:CKEDITOR.env.webkit&&b.href&&b.href.match(/file:\/\/\/[\S]+#/i)&&(b.href=b.href.replace(/file:\/\/\/[^#]+/i,""))},"cke:listbullet":function(a){a.getAncestor(/h\d/)&&!d.pasteFromWordNumberedHeadingToList&&delete a.name}},attributeNames:[[/^onmouse(:?out|over)/,""],[/^onload$/,""],[/(?:v|o):\w+/,""],[/^lang/,""]],attributes:{style:f(t?[[/^list-style-type$/,null],[/^margin$|^margin-(?!bottom|top)/,null,function(a,b,c){if(b.name in{p:1,div:1}){b="ltr"==d.contentsLangDirection?"margin-left":"margin-right";if("margin"==c)a=x(c,a,[b])[b];else if(c!=b)return null;if(a&&!I.test(a))return[b,a]}return null}],[/^clear$/],[/^border.*|margin.*|vertical-align|float$/,null,function(a,b){if("img"==b.name)return a}],[/^width|height$/,null,function(a,b){if(b.name in{table:1,td:1,th:1,img:1})return a}]]:[[/^mso-/],[/-color$/,null,function(a){if("transparent"==a)return!1;if(CKEDITOR.env.gecko)return a.replace(/-moz-use-text-color/g,"transparent")}],[/^margin$/,I],["text-indent","0cm"],["page-break-before"],["tab-stops"],["display","none"],p?[/font-?/]:null],t),width:function(a,c){if(c.name in b.$tableContent)return!1},border:function(a,c){if(c.name in b.$tableContent)return!1},"class":a,bgcolor:a,valign:t?a:function(a,b){b.addStyle("vertical-align",a);return!1}},comment:CKEDITOR.env.ie?a:function(a,b){var c=a.match(/<img.*?>/);return(a=a.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/))?(a=(c=a[1]||c&&"l.")&&c.match(/>(?:[(]?)([^\s]+?)([.)]?)</),k(a,c)):CKEDITOR.env.gecko&&c?(c=CKEDITOR.htmlParser.fragment.fromHtml(c[0]).children[0],(a=(a=(a=b.previous)&&a.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&a[1])&&(c.attributes.src=a),c):!1}}}},K=function(){this.dataFilter=new CKEDITOR.htmlParser.filter};K.prototype={toHtml:function(a){a=CKEDITOR.htmlParser.fragment.fromHtml(a);var b=new CKEDITOR.htmlParser.basicWriter;a.writeHtml(b,this.dataFilter);return b.getHtml(!0)}};CKEDITOR.cleanWord=function(a,b){CKEDITOR.env.gecko&&(a=a.replace(/(<\!--\[if[^<]*?\])--\>([\S\s]*?)<\!--(\[endif\]--\>)/gi,"$1$2$3"));CKEDITOR.env.webkit&&(a=a.replace(/(class="MsoListParagraph[^>]+><\!--\[if !supportLists\]--\>)([^<]+<span[^<]+<\/span>)(<\!--\[endif\]--\>)/gi,"$1\x3cspan\x3e$2\x3c/span\x3e$3"));var c=new K,d=c.dataFilter;d.addRules(CKEDITOR.plugins.pastefromword.getRules(b));b.fire("beforeCleanWord",{filter:d});try{a=c.toHtml(a)}catch(e){alert(b.lang.pastefromword.error)}a=a.replace(/cke:.*?".*?"/g,"");a=a.replace(/style=""/g,"");return a.replace(/<span>/g,"")}})();