'use strict';(function(p){var c={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#FFF",width:1},label:{show:"auto",formatter:function(c,p){return'\x3cdiv style\x3d"font-size:x-small;text-align:center;padding:2px;color:'+p.color+';"\x3e'+c+"\x3cbr/\x3e"+Math.round(p.percent)+"%\x3c/div\x3e"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};p.plot.plugins.push({init:function(u){function H(a,b,h,d){C||(C=!0,k=a.getCanvas(),v=p(k).parent(),c=a.getOptions(),a.setData(I(a.getData())))}function I(a){for(var b=0;b<a.length;++b)if("number"==typeof a[b].data)a[b].data=[[1,a[b].data]];else if("undefined"==typeof a[b].data||"undefined"==typeof a[b].data[0])"undefined"!=typeof a[b].data&&"undefined"!=typeof a[b].data.label&&(a[b].label=a[b].data.label),a[b].data=[[1,0]];for(var b=a,h=0;h<b.length;++h){var d=parseFloat(b[h].data[0][1]);d&&(r+=d)}for(var h=b=0,d=c.series.pie.combine.color,f=[],e=0;e<a.length;++e)a[e].data[0][1]=parseFloat(a[e].data[0][1]),a[e].data[0][1]||(a[e].data[0][1]=0),a[e].data[0][1]/r<=c.series.pie.combine.threshold?(b+=a[e].data[0][1],h++,d||(d=a[e].color)):f.push({data:[[1,a[e].data[0][1]]],color:a[e].color,label:a[e].label,angle:2*a[e].data[0][1]*Math.PI/r,percent:a[e].data[0][1]/r*100});0<h&&f.push({data:[[1,b]],color:d,label:c.series.pie.combine.label,angle:2*b*Math.PI/r,percent:b/r*100});return f}function J(a,b){function h(){ctx.clearRect(0,0,k.width,k.height);v.children().filter(".pieLabel, .pieLabelBackground").remove();r=0;C=!1}function d(){var a=1<c.series.pie.radius?c.series.pie.radius:n*c.series.pie.radius;if(!(a>=k.width/2-5||a*c.series.pie.tilt>=k.height/2-15||10>=a)){ctx.save();ctx.translate(5,15);ctx.globalAlpha=.02;ctx.fillStyle="#000";ctx.translate(l,z);ctx.scale(1,c.series.pie.tilt);for(var b=1;10>=b;b++)ctx.beginPath(),ctx.arc(0,0,a,0,2*Math.PI,!1),ctx.fill(),a-=b;ctx.restore()}}function f(){function a(a,b,c){0>=a||(c?ctx.fillStyle=b:(ctx.strokeStyle=b,ctx.lineJoin="round"),ctx.beginPath(),1E-9<Math.abs(a-2*Math.PI)?ctx.moveTo(0,0):p.browser.msie&&(a-=1E-4),ctx.arc(0,0,h,d,d+a,!1),ctx.closePath(),d+=a,c?ctx.fill():ctx.stroke())}function b(){for(var a=startAngle,b=1<c.series.pie.label.radius?c.series.pie.label.radius:n*c.series.pie.label.radius,f=0;f<e.length;++f){if(e[f].percent>=100*c.series.pie.label.threshold){var d=e[f],h=a,g=f;if(0!=d.data[0][1]){var q=c.legend.labelFormatter,m=c.series.pie.label.formatter,q=q?q(d.label,d):d.label;m&&(q=m(q,d));m=(h+d.angle+h)/2;h=l+Math.round(Math.cos(m)*b);m=z+Math.round(Math.sin(m)*b)*c.series.pie.tilt;v.append('\x3cspan class\x3d"pieLabel" id\x3d"pieLabel'+g+'" style\x3d"position:absolute;top:'+m+"px;left:"+h+'px;"\x3e'+q+"\x3c/span\x3e");g=v.children("#pieLabel"+g);q=m-g.height()/2;m=h-g.width()/2;g.css("top",q);g.css("left",m);if(0<0-q||0<0-m||0>k.height-(q+g.height())||0>k.width-(m+g.width()))B=!0;0!=c.series.pie.label.background.opacity&&(h=c.series.pie.label.background.color,null==h&&(h=d.color),d="top:"+q+"px;left:"+m+"px;",p('\x3cdiv class\x3d"pieLabelBackground" style\x3d"position:absolute;width:'+g.width()+"px;height:"+g.height()+"px;"+d+"background-color:"+h+';"\x3e \x3c/div\x3e').insertBefore(g).css("opacity",c.series.pie.label.background.opacity))}}a+=e[f].angle}}startAngle=Math.PI*c.series.pie.startAngle;var h=1<c.series.pie.radius?c.series.pie.radius:n*c.series.pie.radius;ctx.save();ctx.translate(l,z);ctx.scale(1,c.series.pie.tilt);ctx.save();for(var d=startAngle,f=0;f<e.length;++f)e[f].startAngle=d,a(e[f].angle,e[f].color,!0);ctx.restore();ctx.save();ctx.lineWidth=c.series.pie.stroke.width;d=startAngle;for(f=0;f<e.length;++f)a(e[f].angle,c.series.pie.stroke.color,!1);ctx.restore();E(ctx);c.series.pie.label.show&&b();ctx.restore()}if(v){ctx=b;D=v.children().filter(".legend").children().width();n=Math.min(k.width,k.height/c.series.pie.tilt)/2;z=k.height/2+c.series.pie.offset.top;l=k.width/2;l="auto"==c.series.pie.offset.left?c.legend.position.match("w")?l+D/2:l-D/2:l+c.series.pie.offset.left;l<n?l=n:l>k.width-n&&(l=k.width-n);var e=a.getData();b=0;for(B=!0;B&&10>b;)B=!1,0<b&&(n*=.95),b+=1,h(),.8>=c.series.pie.tilt&&d(),f(),a.triggerRedrawOverlay();10<=b&&(h(),v.prepend('\x3cdiv class\x3d"error"\x3eCould not draw pie with labels contained inside canvas\x3c/div\x3e'));a.setSeries&&a.insertLegend&&(a.setSeries(e),a.insertLegend())}}function E(a){0<c.series.pie.innerRadius&&(a.save(),innerRadius=1<c.series.pie.innerRadius?c.series.pie.innerRadius:n*c.series.pie.innerRadius,a.globalCompositeOperation="destination-out",a.beginPath(),a.fillStyle=c.series.pie.stroke.color,a.arc(0,0,innerRadius,0,2*Math.PI,!1),a.fill(),a.closePath(),a.restore(),a.save(),a.beginPath(),a.strokeStyle=c.series.pie.stroke.color,a.arc(0,0,innerRadius,0,2*Math.PI,!1),a.stroke(),a.closePath(),a.restore())}function K(a){F("plothover",a)}function L(a){F("plotclick",a)}function F(a,b){var h=u.offset(),d=parseInt(b.pageX-h.left);a:{for(var h=parseInt(b.pageY-h.top),f=u.getData(),e=u.getOptions(),e=1<e.series.pie.radius?e.series.pie.radius:n*e.series.pie.radius,k=0;k<f.length;++k){var g=f[k];if(g.pie.show){ctx.save();ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,e,g.startAngle,g.startAngle+g.angle,!1);ctx.closePath();x=d-l;y=h-z;if(ctx.isPointInPath){if(ctx.isPointInPath(d-l,h-z)){ctx.restore();d={datapoint:[g.percent,g.data],dataIndex:0,series:g,seriesIndex:k};break a}}else{p1X=e*Math.cos(g.startAngle);p1Y=e*Math.sin(g.startAngle);p2X=e*Math.cos(g.startAngle+g.angle/4);p2Y=e*Math.sin(g.startAngle+g.angle/4);p3X=e*Math.cos(g.startAngle+g.angle/2);p3Y=e*Math.sin(g.startAngle+g.angle/2);p4X=e*Math.cos(g.startAngle+g.angle/1.5);p4Y=e*Math.sin(g.startAngle+g.angle/1.5);p5X=e*Math.cos(g.startAngle+g.angle);p5Y=e*Math.sin(g.startAngle+g.angle);arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]];arrPoint=[x,y];for(var p=!1,w=-1,r=arrPoly.length,A=r-1;++w<r;A=w)(arrPoly[w][1]<=arrPoint[1]&&arrPoint[1]<arrPoly[A][1]||arrPoly[A][1]<=arrPoint[1]&&arrPoint[1]<arrPoly[w][1])&&arrPoint[0]<(arrPoly[A][0]-arrPoly[w][0])*(arrPoint[1]-arrPoly[w][1])/(arrPoly[A][1]-arrPoly[w][1])+arrPoly[w][0]&&(p=!p);if(p){ctx.restore();d={datapoint:[g.percent,g.data],dataIndex:0,series:g,seriesIndex:k};break a}}ctx.restore()}}d=null}if(c.grid.autoHighlight)for(h=0;h<t.length;++h)f=t[h],f.auto!=a||d&&f.series==d.series||(f=f.series,null==f&&(t=[],u.triggerRedrawOverlay()),"number"==typeof f&&(f=series[f]),f=G(f),-1!=f&&(t.splice(f,1),u.triggerRedrawOverlay()));d&&(h=d.series,"number"==typeof h&&(h=series[h]),f=G(h),-1==f?(t.push({series:h,auto:a}),u.triggerRedrawOverlay()):a||(t[f].auto=!1));v.trigger(a,[{pageX:b.pageX,pageY:b.pageY},d])}function G(a){for(var b=0;b<t.length;++b)if(t[b].series==a)return b;return-1}function M(a,b){a=a.getOptions();var c=1<a.series.pie.radius?a.series.pie.radius:n*a.series.pie.radius;b.save();b.translate(l,z);b.scale(1,a.series.pie.tilt);for(i=0;i<t.length;++i){var d=t[i].series;0>d.angle||(b.fillStyle="rgba(255, 255, 255, "+a.series.pie.highlight.opacity+")",b.beginPath(),1E-9<Math.abs(d.angle-2*Math.PI)&&b.moveTo(0,0),b.arc(0,0,c,d.startAngle,d.startAngle+d.angle,!1),b.closePath(),b.fill())}E(b);b.restore()}var k=null,v=null,n=null,l=null,z=null,r=0,B=!0,D=0,C=!1,t=[];u.hooks.processOptions.push(function(a,b){b.series.pie.show&&(b.grid.show=!1,"auto"==b.series.pie.label.show&&(b.series.pie.label.show=b.legend.show?!1:!0),"auto"==b.series.pie.radius&&(b.series.pie.radius=b.series.pie.label.show?.75:1),1<b.series.pie.tilt&&(b.series.pie.tilt=1),0>b.series.pie.tilt&&(b.series.pie.tilt=0),a.hooks.processDatapoints.push(H),a.hooks.drawOverlay.push(M),a.hooks.draw.push(J))});u.hooks.bindEvents.push(function(a,b){a=a.getOptions();a.series.pie.show&&a.grid.hoverable&&b.unbind("mousemove").mousemove(K);a.series.pie.show&&a.grid.clickable&&b.unbind("click").click(L)})},options:c,name:"pie",version:"1.0"})})(jQuery);