'use strict';(function(n){var d={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(d,n){return"\x3cdiv style\x3d'font-size:x-small;text-align:center;padding:2px;color:"+n.color+";'\x3e"+d+"\x3cbr/\x3e"+Math.round(n.percent)+"%\x3c/div\x3e"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};n.plot.plugins.push({init:function(u){function F(a){for(var b=0,c=0,k=0,f=d.series.pie.combine.color,m=[],l=0;l<a.length;++l){var e=a[l].data;n.isArray(e)&&1==e.length&&(e=e[0]);n.isArray(e)?!isNaN(parseFloat(e[1]))&&isFinite(e[1])?e[1]=+e[1]:e[1]=0:e=!isNaN(parseFloat(e))&&isFinite(e)?[1,+e]:[1,0];a[l].data=[e]}for(l=0;l<a.length;++l)b+=a[l].data[0][1];for(l=0;l<a.length;++l)e=a[l].data[0][1],e/b<=d.series.pie.combine.threshold&&(c+=e,k++,f||(f=a[l].color));for(l=0;l<a.length;++l)e=a[l].data[0][1],(2>k||e/b>d.series.pie.combine.threshold)&&m.push({data:[[1,e]],color:a[l].color,label:a[l].label,angle:e*Math.PI*2/b,percent:e/(b/100)});1<k&&m.push({data:[[1,c]],color:f,label:d.series.pie.combine.label,angle:c*Math.PI*2/b,percent:c/(b/100)});return m}function G(a,b){function h(){c.clearRect(0,0,m,l);x.children().filter(".pieLabel, .pieLabelBackground").remove()}function k(){var a=d.series.pie.shadow.left,b=d.series.pie.shadow.top,e=d.series.pie.shadow.alpha,f=1<d.series.pie.radius?d.series.pie.radius:t*d.series.pie.radius;if(!(f>=m/2-a||f*d.series.pie.tilt>=l/2-b||10>=f)){c.save();c.translate(a,b);c.globalAlpha=e;c.fillStyle="#000";c.translate(q,y);c.scale(1,d.series.pie.tilt);for(a=1;10>=a;a++)c.beginPath(),c.arc(0,0,f,0,2*Math.PI,!1),c.fill(),f-=a;c.restore()}}function f(){function a(a,b,d){0>=a||isNaN(a)||(d?c.fillStyle=b:(c.strokeStyle=b,c.lineJoin="round"),c.beginPath(),1E-9<Math.abs(a-2*Math.PI)&&c.moveTo(0,0),c.arc(0,0,e,k,k+a/2,!1),c.arc(0,0,e,k+a/2,k+a,!1),c.closePath(),k+=a,d?c.fill():c.stroke())}function b(){for(var a=f,b=1<d.series.pie.label.radius?d.series.pie.label.radius:t*d.series.pie.label.radius,c=0;c<p.length;++c){if(p[c].percent>=100*d.series.pie.label.threshold){var e;e=p[c];var g=a,h=c;if(0==e.data[0][1])e=!0;else{var k=d.legend.labelFormatter,r=d.series.pie.label.formatter,k=k?k(e.label,e):e.label;r&&(k=r(k,e));r=(g+e.angle+g)/2;g=q+Math.round(Math.cos(r)*b);r=y+Math.round(Math.sin(r)*b)*d.series.pie.tilt;x.append("\x3cspan class\x3d'pieLabel' id\x3d'pieLabel"+h+"' style\x3d'position:absolute;top:"+r+"px;left:"+g+"px;'\x3e"+k+"\x3c/span\x3e");h=x.children("#pieLabel"+h);k=r-h.height()/2;r=g-h.width()/2;h.css("top",k);h.css("left",r);0<0-k||0<0-r||0>l-(k+h.height())||0>m-(r+h.width())?e=!1:(0!=d.series.pie.label.background.opacity&&(g=d.series.pie.label.background.color,null==g&&(g=e.color),e="top:"+k+"px;left:"+r+"px;",n("\x3cdiv class\x3d'pieLabelBackground' style\x3d'position:absolute;width:"+h.width()+"px;height:"+h.height()+"px;"+e+"background-color:"+g+";'\x3e\x3c/div\x3e").css("opacity",d.series.pie.label.background.opacity).insertBefore(h)),e=!0)}if(!e)return!1}a+=p[c].angle}return!0}var f=Math.PI*d.series.pie.startAngle,e=1<d.series.pie.radius?d.series.pie.radius:t*d.series.pie.radius;c.save();c.translate(q,y);c.scale(1,d.series.pie.tilt);c.save();for(var k=f,h=0;h<p.length;++h)p[h].startAngle=k,a(p[h].angle,p[h].color,!0);c.restore();if(0<d.series.pie.stroke.width){c.save();c.lineWidth=d.series.pie.stroke.width;k=f;for(h=0;h<p.length;++h)a(p[h].angle,d.series.pie.stroke.color,!1);c.restore()}B(c);c.restore();return d.series.pie.label.show?b():!0}if(x){var m=a.getPlaceholder().width(),l=a.getPlaceholder().height(),e=x.children().filter(".legend").children().width()||0;c=b;z=!1;t=Math.min(m,l/d.series.pie.tilt)/2;y=l/2+d.series.pie.offset.top;q=m/2;q="auto"==d.series.pie.offset.left?d.legend.position.match("w")?q+e/2:q-e/2:q+d.series.pie.offset.left;q<t?q=t:q>m-t&&(q=m-t);var p=a.getData();b=0;do 0<b&&(t*=.95),b+=1,h(),.8>=d.series.pie.tilt&&k();while(!f()&&10>b);10<=b&&(h(),x.prepend("\x3cdiv class\x3d'error'\x3eCould not draw pie with labels contained inside canvas\x3c/div\x3e"));a.setSeries&&a.insertLegend&&(a.setSeries(p),a.insertLegend())}}function B(a){if(0<d.series.pie.innerRadius){a.save();var b=1<d.series.pie.innerRadius?d.series.pie.innerRadius:t*d.series.pie.innerRadius;a.globalCompositeOperation="destination-out";a.beginPath();a.fillStyle=d.series.pie.stroke.color;a.arc(0,0,b,0,2*Math.PI,!1);a.fill();a.closePath();a.restore();a.save();a.beginPath();a.strokeStyle=d.series.pie.stroke.color;a.arc(0,0,b,0,2*Math.PI,!1);a.stroke();a.closePath();a.restore()}}function H(a){C("plothover",a)}function I(a){C("plotclick",a)}function C(a,b){var h=u.offset(),k=parseInt(b.pageX-h.left);a:{for(var h=parseInt(b.pageY-h.top),f=u.getData(),m=u.getOptions(),m=1<m.series.pie.radius?m.series.pie.radius:t*m.series.pie.radius,l,e,p=0;p<f.length;++p){var g=f[p];if(g.pie.show){c.save();c.beginPath();c.moveTo(0,0);c.arc(0,0,m,g.startAngle,g.startAngle+g.angle/2,!1);c.arc(0,0,m,g.startAngle+g.angle/2,g.startAngle+g.angle,!1);c.closePath();l=k-q;e=h-y;if(c.isPointInPath){if(c.isPointInPath(k-q,h-y)){c.restore();k={datapoint:[g.percent,g.data],dataIndex:0,series:g,seriesIndex:p};break a}}else{var v=[[0,0],[m*Math.cos(g.startAngle),m*Math.sin(g.startAngle)],[m*Math.cos(g.startAngle+g.angle/4),m*Math.sin(g.startAngle+g.angle/4)],[m*Math.cos(g.startAngle+g.angle/2),m*Math.sin(g.startAngle+g.angle/2)],[m*Math.cos(g.startAngle+g.angle/1.5),m*Math.sin(g.startAngle+g.angle/1.5)],[m*Math.cos(g.startAngle+g.angle),m*Math.sin(g.startAngle+g.angle)]];l=[l,e];e=!1;for(var n=-1,z=v.length,A=z-1;++n<z;A=n)(v[n][1]<=l[1]&&l[1]<v[A][1]||v[A][1]<=l[1]&&l[1]<v[n][1])&&l[0]<(v[A][0]-v[n][0])*(l[1]-v[n][1])/(v[A][1]-v[n][1])+v[n][0]&&(e=!e);if(e){c.restore();k={datapoint:[g.percent,g.data],dataIndex:0,series:g,seriesIndex:p};break a}}c.restore()}}k=null}if(d.grid.autoHighlight)for(h=0;h<w.length;++h)f=w[h],f.auto!=a||k&&f.series==k.series||(f=f.series,null==f&&(w=[],u.triggerRedrawOverlay()),f=D(f),-1!=f&&(w.splice(f,1),u.triggerRedrawOverlay()));k&&(h=k.series,f=D(h),-1==f?(w.push({series:h,auto:a}),u.triggerRedrawOverlay()):a||(w[f].auto=!1));x.trigger(a,[{pageX:b.pageX,pageY:b.pageY},k])}function D(a){for(var b=0;b<w.length;++b)if(w[b].series==a)return b;return-1}var E=null,x=null,t=null,q=null,y=null,z=!1,c=null,w=[];u.hooks.processOptions.push(function(a,b){b.series.pie.show&&(b.grid.show=!1,"auto"==b.series.pie.label.show&&(b.series.pie.label.show=b.legend.show?!1:!0),"auto"==b.series.pie.radius&&(b.series.pie.radius=b.series.pie.label.show?.75:1),1<b.series.pie.tilt?b.series.pie.tilt=1:0>b.series.pie.tilt&&(b.series.pie.tilt=0))});u.hooks.bindEvents.push(function(a,b){a=a.getOptions();a.series.pie.show&&(a.grid.hoverable&&b.unbind("mousemove").mousemove(H),a.grid.clickable&&b.unbind("click").click(I))});u.hooks.processDatapoints.push(function(a,b,c,k){a.getOptions().series.pie.show&&!z&&(z=!0,E=a.getCanvas(),x=n(E).parent(),d=a.getOptions(),a.setData(F(a.getData())))});u.hooks.drawOverlay.push(function(a,b){if(a.getOptions().series.pie.show){a=a.getOptions();var c=1<a.series.pie.radius?a.series.pie.radius:t*a.series.pie.radius;b.save();b.translate(q,y);b.scale(1,a.series.pie.tilt);for(var d=0;d<w.length;++d){var f=w[d].series;0>=f.angle||isNaN(f.angle)||(b.fillStyle="rgba(255, 255, 255, "+a.series.pie.highlight.opacity+")",b.beginPath(),1E-9<Math.abs(f.angle-2*Math.PI)&&b.moveTo(0,0),b.arc(0,0,c,f.startAngle,f.startAngle+f.angle/2,!1),b.arc(0,0,c,f.startAngle+f.angle/2,f.startAngle+f.angle,!1),b.closePath(),b.fill())}B(b);b.restore()}});u.hooks.draw.push(function(a,b){a.getOptions().series.pie.show&&G(a,b)})},options:d,name:"pie",version:"1.1"})})(jQuery);