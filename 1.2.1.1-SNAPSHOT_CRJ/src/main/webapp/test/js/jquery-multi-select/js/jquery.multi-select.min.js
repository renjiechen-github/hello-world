'use strict';!function(d){var k=function(a,b){this.options=b;this.$element=d(a);this.$container=d("\x3cdiv/\x3e",{"class":"ms-container"});this.$selectableContainer=d("\x3cdiv/\x3e",{"class":"ms-selectable"});this.$selectionContainer=d("\x3cdiv/\x3e",{"class":"ms-selection"});this.$selectableUl=d("\x3cul/\x3e",{"class":"ms-list",tabindex:"-1"});this.$selectionUl=d("\x3cul/\x3e",{"class":"ms-list",tabindex:"-1"});this.scrollTo=0;this.sanitizeRegexp=/\W+/gi;this.elemsSelector="li:visible:not(.ms-optgroup-label,.ms-optgroup-container,."+b.disabledClass+")"};k.prototype={constructor:k,init:function(){var a=this,b=this.$element;if(0===b.next(".ms-container").length){b.css({position:"absolute",left:"-9999px"});b.attr("id",b.attr("id")?b.attr("id"):Math.ceil(1E3*Math.random())+"multiselect");this.$container.attr("id","ms-"+b.attr("id"));b.find("option").each(function(){a.generateLisFromOption(this)});this.$selectionUl.find(".ms-optgroup-label").hide();a.options.selectableHeader&&a.$selectableContainer.append(a.options.selectableHeader);a.$selectableContainer.append(a.$selectableUl);a.options.selectableFooter&&a.$selectableContainer.append(a.options.selectableFooter);a.options.selectionHeader&&a.$selectionContainer.append(a.options.selectionHeader);a.$selectionContainer.append(a.$selectionUl);a.options.selectionFooter&&a.$selectionContainer.append(a.options.selectionFooter);a.$container.append(a.$selectableContainer);a.$container.append(a.$selectionContainer);b.after(a.$container);a.activeMouse(a.$selectableUl);a.activeKeyboard(a.$selectableUl);var c=a.options.dblClick?"dblclick":"click";a.$selectableUl.on(c,".ms-elem-selectable",function(){a.select(d(this).data("ms-value"))});a.$selectionUl.on(c,".ms-elem-selection",function(){a.deselect(d(this).data("ms-value"))});a.activeMouse(a.$selectionUl);a.activeKeyboard(a.$selectionUl);b.on("focus",function(){a.$selectableUl.focus()})}b=b.find("option:selected").map(function(){return d(this).val()}).get();a.select(b,"init");"function"===typeof a.options.afterInit&&a.options.afterInit.call(this,this.$container)},generateLisFromOption:function(a){for(var b=this,c=b.$element,g="",e=d(a),f=0;f<a.attributes.length;f++){var h=a.attributes[f];"value"!==h.name&&"disabled"!==h.name&&(g+=h.name+'\x3d"'+h.value+'" ')}a=d("\x3cli "+g+"\x3e\x3cspan\x3e"+e.text()+"\x3c/span\x3e\x3c/li\x3e");g=a.clone();f=e.val();h=b.sanitize(f,b.sanitizeRegexp);a.data("ms-value",f).addClass("ms-elem-selectable").attr("id",h+"-selectable");g.data("ms-value",f).addClass("ms-elem-selection").attr("id",h+"-selection").hide();if(e.prop("disabled")||c.prop("disabled"))g.addClass(b.options.disabledClass),a.addClass(b.options.disabledClass);var l=e.parent("optgroup");0<l.length?(h=l.attr("label"),c=b.sanitize(h,b.sanitizeRegexp),e=b.$selectableUl.find("#optgroup-selectable-"+c),f=b.$selectionUl.find("#optgroup-selection-"+c),0===e.length&&(h='\x3cul class\x3d"ms-optgroup"\x3e\x3cli class\x3d"ms-optgroup-label"\x3e\x3cspan\x3e'+h+"\x3c/span\x3e\x3c/li\x3e\x3c/ul\x3e",e=d('\x3cli class\x3d"ms-optgroup-container"\x3e\x3c/li\x3e'),f=d('\x3cli class\x3d"ms-optgroup-container"\x3e\x3c/li\x3e'),e.attr("id","optgroup-selectable-"+c),f.attr("id","optgroup-selection-"+c),e.append(d(h)),f.append(d(h)),b.options.selectableOptgroup&&(e.find(".ms-optgroup-label").on("click",function(){var a=l.children(":not(:selected)").map(function(){return d(this).val()}).get();b.select(a)}),f.find(".ms-optgroup-label").on("click",function(){var a=l.children(":selected").map(function(){return d(this).val()}).get();b.deselect(a)})),b.$selectableUl.append(e),b.$selectionUl.append(f)),e.children().append(a),f.children().append(g)):(b.$selectableUl.append(a),b.$selectionUl.append(g))},activeKeyboard:function(a){var b=this;a.on("focus",function(){d(this).addClass("ms-focus")}).on("blur",function(){d(this).removeClass("ms-focus")}).on("keydown",function(c){switch(c.which){case 40:case 38:c.preventDefault();c.stopPropagation();b.moveHighlight(d(this),38===c.which?-1:1);break;case 32:c.preventDefault();c.stopPropagation();b.selectHighlighted(a);break;case 37:case 39:c.preventDefault(),c.stopPropagation(),b.switchList(a)}})},moveHighlight:function(a,b){var c=a.find(this.elemsSelector),d=c.filter(".ms-hover"),e=null,f=c.first().outerHeight(),h=a.height();this.$container.prop("id");c.off("mouseenter");c.removeClass("ms-hover");1===b?(e=d.nextAll(this.elemsSelector).first(),0===e.length&&(b=d.parent(),b.hasClass("ms-optgroup")?(b=b.parent(),b=b.next(":visible"),e=0<b.length?b.find(this.elemsSelector).first():c.first()):e=c.first())):-1===b&&(e=d.prevAll(this.elemsSelector).first(),0===e.length&&(b=d.parent(),b.hasClass("ms-optgroup")?(b=b.parent(),b=b.prev(":visible"),e=0<b.length?b.find(this.elemsSelector).last():c.last()):e=c.last()));0<e.length&&(e.addClass("ms-hover"),c=a.scrollTop()+e.position().top-h/2+f/2,a.scrollTop(c))},selectHighlighted:function(a){var b=a.find(this.elemsSelector),c=b.filter(".ms-hover").first();0<c.length&&(a.parent().hasClass("ms-selectable")?this.select(c.data("ms-value")):this.deselect(c.data("ms-value")),b.removeClass("ms-hover"))},switchList:function(a){a.blur();a.parent().hasClass("ms-selectable")?this.$selectionUl.focus():this.$selectableUl.focus()},activeMouse:function(a){var b=this;a.on("mousemove",function(){var c=a.find(b.elemsSelector);c.on("mouseenter",function(){c.removeClass("ms-hover");d(this).addClass("ms-hover")})})},refresh:function(){this.destroy();this.$element.multiSelect(this.options)},destroy:function(){d("#ms-"+this.$element.attr("id")).remove();this.$element.removeData("multiselect")},select:function(a,b){"string"===typeof a&&(a=[a]);var c=this,g=this.$element,e=d.map(a,function(a){return c.sanitize(a,c.sanitizeRegexp)}),f=this.$selectableUl.find("#"+e.join("-selectable, #")+"-selectable").filter(":not(."+c.options.disabledClass+")"),e=this.$selectionUl.find("#"+e.join("-selection, #")+"-selection").filter(":not(."+c.options.disabledClass+")"),h=g.find("option:not(:disabled)").filter(function(){return-1<d.inArray(this.value,a)});0<f.length&&(f.addClass("ms-selected").hide(),e.addClass("ms-selected").show(),h.prop("selected",!0),f=c.$selectableUl.children(".ms-optgroup-container"),0<f.length?(f.each(function(){var a=d(this).find(".ms-elem-selectable");a.length===a.filter(".ms-selected").length&&d(this).find(".ms-optgroup-label").hide()}),c.$selectionUl.children(".ms-optgroup-container").each(function(){0<d(this).find(".ms-elem-selection").filter(".ms-selected").length&&d(this).find(".ms-optgroup-label").show()})):c.options.keepOrder&&(f=c.$selectionUl.find(".ms-selected"),1<f.length&&f.last().get(0)!=e.get(0)&&e.insertAfter(f.last())),"init"!==b&&(g.trigger("change"),"function"===typeof c.options.afterSelect&&c.options.afterSelect.call(this,a)))},deselect:function(a){"string"===typeof a&&(a=[a]);var b=this,c=this.$element,g=d.map(a,function(a){return b.sanitize(a,b.sanitizeRegexp)}),e=this.$selectableUl.find("#"+g.join("-selectable, #")+"-selectable"),g=this.$selectionUl.find("#"+g.join("-selection, #")+"-selection").filter(".ms-selected"),f=c.find("option").filter(function(){return-1<d.inArray(this.value,a)});0<g.length&&(e.removeClass("ms-selected").show(),g.removeClass("ms-selected").hide(),f.prop("selected",!1),e=b.$selectableUl.children(".ms-optgroup-container"),0<e.length&&(e.each(function(){0<d(this).find(".ms-elem-selectable").filter(":not(.ms-selected)").length&&d(this).find(".ms-optgroup-label").show()}),b.$selectionUl.children(".ms-optgroup-container").each(function(){0===d(this).find(".ms-elem-selection").filter(".ms-selected").length&&d(this).find(".ms-optgroup-label").hide()})),c.trigger("change"),"function"===typeof b.options.afterDeselect&&b.options.afterDeselect.call(this,a))},select_all:function(){var a=this.$element,b=a.val();a.find('option:not(":disabled")').prop("selected",!0);this.$selectableUl.find(".ms-elem-selectable").filter(":not(."+this.options.disabledClass+")").addClass("ms-selected").hide();this.$selectionUl.find(".ms-optgroup-label").show();this.$selectableUl.find(".ms-optgroup-label").hide();this.$selectionUl.find(".ms-elem-selection").filter(":not(."+this.options.disabledClass+")").addClass("ms-selected").show();this.$selectionUl.focus();a.trigger("change");"function"===typeof this.options.afterSelect&&(a=d.grep(a.val(),function(a){return 0>d.inArray(a,b)}),this.options.afterSelect.call(this,a))},deselect_all:function(){var a=this.$element,b=a.val();a.find("option").prop("selected",!1);this.$selectableUl.find(".ms-elem-selectable").removeClass("ms-selected").show();this.$selectionUl.find(".ms-optgroup-label").hide();this.$selectableUl.find(".ms-optgroup-label").show();this.$selectionUl.find(".ms-elem-selection").removeClass("ms-selected").hide();this.$selectableUl.focus();a.trigger("change");"function"===typeof this.options.afterDeselect&&this.options.afterDeselect.call(this,b)},sanitize:function(a,b){return a.replace(b,"_")}};d.fn.multiSelect=function(){var a=arguments[0],b=arguments;return this.each(function(){var c=d(this),g=c.data("multiselect"),e=d.extend({},d.fn.multiSelect.defaults,c.data(),"object"===typeof a&&a);g||c.data("multiselect",g=new k(this,e));if("string"===typeof a)g[a](b[1]);else g.init()})};d.fn.multiSelect.defaults={selectableOptgroup:!1,disabledClass:"disabled",dblClick:!1,keepOrder:!1};d.fn.multiSelect.Constructor=k}(window.jQuery);