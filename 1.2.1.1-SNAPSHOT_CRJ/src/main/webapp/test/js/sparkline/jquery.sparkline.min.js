'use strict';(function(t,f,k){(function(f){"function"===typeof define&&define.amd?define(["jquery"],f):jQuery&&!jQuery.fn.sparkline&&f(jQuery)})(function(g){var I={},p,C,G,J,F,K,S,T,L,U,V,W,H,X,Y,D,M,Z,aa,ba,N,O,P,ca,Q,R,w,da=0;p=function(){var a,b;a=function(){this.init.apply(this,arguments)};1<arguments.length?(arguments[0]?(a.prototype=g.extend(new arguments[0],arguments[arguments.length-1]),a._super=arguments[0].prototype):a.prototype=arguments[arguments.length-1],2<arguments.length&&(b=Array.prototype.slice.call(arguments,1,-1),b.unshift(a.prototype),g.extend.apply(g,b))):a.prototype=arguments[0];return a.prototype.cls=a};g.SPFormatClass=C=p({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(a,b){this.format=a;this.fclass=b},render:function(a,b,c){var d=this,e,h,z,f,g;return this.format.replace(this.fre,function(l,m,v,u){h=m;z=u;(e=d.precre.exec(h))?(g=e[2],h=e[1]):g=!1;f=a[h];if(f===k)return"";if(z&&b&&b[z])return l=b[z],l.get?b[z].get(f)||f:b[z][f]||f;T(f)&&(f=c.get("numberFormatter")?c.get("numberFormatter")(f):W(f,g,c.get("numberDigitGroupCount"),c.get("numberDigitGroupSep"),c.get("numberDecimalMark")));return f})}});g.spformat=function(a,b){return new C(a,b)};G=function(a,b,c){return a<b?b:a>c?c:a};J=function(a,b){if(2===b)return b=f.floor(a.length/2),a.length%2?a[b]:(a[b-1]+a[b])/2;b=a.length%2?(a.length*b+b)/4:(a.length*b+2)/4;return b%1?(a[f.floor(b)]+a[f.floor(b)-1])/2:a[b-1]};F=function(a){var b;switch(a){case "undefined":a=k;break;case "null":a=null;break;case "true":a=!0;break;case "false":a=!1;break;default:b=parseFloat(a),a==b&&(a=b)}return a};K=function(a){var b,c=[];for(b=a.length;b--;)c[b]=F(a[b]);return c};S=function(a,b){var c,d,e=[];c=0;for(d=a.length;c<d;c++)a[c]!==b&&e.push(a[c]);return e};T=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};W=function(a,b,c,d,e){var h;a=(!1===b?parseFloat(a).toString():a.toFixed(b)).split("");h=0>(h=g.inArray(".",a))?a.length:h;h<a.length&&(a[h]=e);for(b=h-c;0<b;b-=c)a.splice(b,0,d);return a.join("")};L=function(a,b,c){var d;for(d=b.length;d--;)if((!c||null!==b[d])&&b[d]!==a)return!1;return!0};V=function(a){return g.isArray(a)?a:[a]};U=function(a){var b;t.createStyleSheet?t.createStyleSheet().cssText=a:(b=t.createElement("style"),b.type="text/css",t.getElementsByTagName("head")[0].appendChild(b),b["string"==typeof t.body.style.WebkitAppearance?"innerText":"innerHTML"]=a)};g.fn.simpledraw=function(a,b,c,d){var e;if(c&&(e=this.data("_jqs_vcanvas")))return e;if(!1===g.fn.sparkline.canvas)return!1;if(g.fn.sparkline.canvas===k)if(e=t.createElement("canvas"),e.getContext&&e.getContext("2d"))g.fn.sparkline.canvas=function(a,b,c,d){return new Q(a,b,c,d)};else if(t.namespaces&&!t.namespaces.v)t.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),g.fn.sparkline.canvas=function(a,b,c,d){return new R(a,b,c)};else return g.fn.sparkline.canvas=!1;a===k&&(a=g(this).innerWidth());b===k&&(b=g(this).innerHeight());e=g.fn.sparkline.canvas(a,b,this,d);(a=g(this).data("_jqs_mhandler"))&&a.registerCanvas(e);return e};g.fn.cleardraw=function(){var a=this.data("_jqs_vcanvas");a&&a.reset()};g.RangeMapClass=H=p({init:function(a){var b,c,d=[];for(b in a)a.hasOwnProperty(b)&&"string"===typeof b&&-1<b.indexOf(":")&&(c=b.split(":"),c[0]=0===c[0].length?-Infinity:parseFloat(c[0]),c[1]=0===c[1].length?Infinity:parseFloat(c[1]),c[2]=a[b],d.push(c));this.map=a;this.rangelist=d||!1},get:function(a){var b=this.rangelist,c,d;if((c=this.map[a])!==k)return c;if(b)for(c=b.length;c--;)if(d=b[c],d[0]<=a&&d[1]>=a)return d[2];return k}});g.range_map=function(a){return new H(a)};X=p({init:function(a,b){this.$el=g(a);this.options=b;this.currentPageY=this.currentPageX=0;this.el=a;this.splist=[];this.tooltip=null;this.over=!1;this.displayTooltips=!b.get("disableTooltips");this.highlightEnabled=!b.get("disableHighlight")},registerSparkline:function(a){this.splist.push(a);this.over&&this.updateDisplay()},registerCanvas:function(a){var b=g(a.canvas);this.canvas=a;this.$canvas=b;b.mouseenter(g.proxy(this.mouseenter,this));b.mouseleave(g.proxy(this.mouseleave,this));b.click(g.proxy(this.mouseclick,this))},reset:function(a){this.splist=[];this.tooltip&&a&&(this.tooltip.remove(),this.tooltip=k)},mouseclick:function(a){var b=g.Event("sparklineClick");b.originalEvent=a;b.sparklines=this.splist;this.$el.trigger(b)},mouseenter:function(a){g(t.body).unbind("mousemove.jqs");g(t.body).bind("mousemove.jqs",g.proxy(this.mousemove,this));this.over=!0;this.currentPageX=a.pageX;this.currentPageY=a.pageY;this.currentEl=a.target;!this.tooltip&&this.displayTooltips&&(this.tooltip=new Y(this.options),this.tooltip.updatePosition(a.pageX,a.pageY));this.updateDisplay()},mouseleave:function(){g(t.body).unbind("mousemove.jqs");var a=this.splist,b=a.length,c=!1,d,e;this.over=!1;this.currentEl=null;this.tooltip&&(this.tooltip.remove(),this.tooltip=null);for(e=0;e<b;e++)d=a[e],d.clearRegionHighlight()&&(c=!0);c&&this.canvas.render()},mousemove:function(a){this.currentPageX=a.pageX;this.currentPageY=a.pageY;this.currentEl=a.target;this.tooltip&&this.tooltip.updatePosition(a.pageX,a.pageY);this.updateDisplay()},updateDisplay:function(){var a=this.splist,b=a.length,c=!1,d=this.$canvas.offset(),e=this.currentPageX-d.left,h=this.currentPageY-d.top,f,k;if(this.over){for(f=0;f<b;f++)d=a[f],(k=d.setRegionHighlight(this.currentEl,e,h))&&(c=!0);if(c){c=g.Event("sparklineRegionChange");c.sparklines=this.splist;this.$el.trigger(c);if(this.tooltip){c="";for(f=0;f<b;f++)d=a[f],c+=d.getCurrentRegionTooltip();this.tooltip.setContent(c)}this.disableHighlight||this.canvas.render()}null===k&&this.mouseleave()}}});Y=p({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(a){var b=a.get("tooltipClassname","jqstooltip"),c=this.sizeStyle;this.container=a.get("tooltipContainer")||t.body;this.tooltipOffsetX=a.get("tooltipOffsetX",10);this.tooltipOffsetY=a.get("tooltipOffsetY",12);g("#jqssizetip").remove();g("#jqstooltip").remove();this.sizetip=g("\x3cdiv/\x3e",{id:"jqssizetip",style:c,"class":b});this.tooltip=g("\x3cdiv/\x3e",{id:"jqstooltip","class":b}).appendTo(this.container);a=this.tooltip.offset();this.offsetLeft=a.left;this.offsetTop=a.top;this.hidden=!0;g(window).unbind("resize.jqs scroll.jqs");g(window).bind("resize.jqs scroll.jqs",g.proxy(this.updateWindowDims,this));this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=g(window).scrollTop();this.scrollLeft=g(window).scrollLeft();this.scrollRight=this.scrollLeft+g(window).width();this.updatePosition()},getSize:function(a){this.sizetip.html(a).appendTo(this.container);this.width=this.sizetip.width()+1;this.height=this.sizetip.height();this.sizetip.remove()},setContent:function(a){a?(this.getSize(a),this.tooltip.html(a).css({width:this.width,height:this.height,visibility:"visible"}),this.hidden&&(this.hidden=!1,this.updatePosition())):(this.tooltip.css("visibility","hidden"),this.hidden=!0)},updatePosition:function(a,b){if(a===k){if(this.mousex===k)return;a=this.mousex-this.offsetLeft;b=this.mousey-this.offsetTop}else this.mousex=a-=this.offsetLeft,this.mousey=b-=this.offsetTop;this.height&&this.width&&!this.hidden&&(b-=this.height+this.tooltipOffsetY,a+=this.tooltipOffsetX,b<this.scrollTop&&(b=this.scrollTop),a<this.scrollLeft?a=this.scrollLeft:a+this.width>this.scrollRight&&(a=this.scrollRight-this.width),this.tooltip.css({left:a,top:b}))},remove:function(){this.tooltip.remove();this.sizetip.remove();this.sizetip=this.tooltip=k;g(window).unbind("resize.jqs scroll.jqs")}});g(function(){U('.jqstooltip { position: absolute;left: 30px;top: 0px;display: block;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr\x3d#99000000, endColorstr\x3d#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr\x3d#99000000, endColorstr\x3d#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;border: 0px solid white;border-radius: 3px;-webkit-border-radius: 3px;z-index: 10000;}.jqsfield { color: white;padding: 5px 5px 5px 5px;font: 10px arial, san serif;text-align: left;}')});w=[];g.fn.sparkline=function(a,b){return this.each(function(){var c=new g.fn.sparkline.options(this,b),d=g(this),e,h;e=function(){var b,e,h,f;if("html"===a||a===k){b=this.getAttribute(c.get("tagValuesAttribute"));if(b===k||null===b)b=d.html();b=b.replace(/(^\s*\x3c!--)|(--\x3e\s*$)|\s+/g,"").split(",")}else b=a;e="auto"===c.get("width")?b.length*c.get("defaultPixelsPerValue"):c.get("width");"auto"===c.get("height")?c.get("composite")&&g.data(this,"_jqs_vcanvas")||(f=t.createElement("span"),f.innerHTML="a",d.html(f),h=g(f).innerHeight()||g(f).height(),g(f).remove()):h=c.get("height");c.get("disableInteraction")?f=!1:(f=g.data(this,"_jqs_mhandler"))?c.get("composite")||f.reset():(f=new X(this,c),g.data(this,"_jqs_mhandler",f));c.get("composite")&&!g.data(this,"_jqs_vcanvas")?g.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),g.data(this,"_jqs_errnotify",!0)):(h=new (g.fn.sparkline[c.get("type")])(this,b,c,e,h),h.render(),f&&f.registerSparkline(h))};if(g(this).html()&&!c.get("disableHiddenCheck")&&g(this).is(":hidden")||!g(this).parents("body").length){if(!c.get("composite")&&g.data(this,"_jqs_pending"))for(h=w.length;h;h--)w[h-1][0]==this&&w.splice(h-1,1);w.push([this,e]);g.data(this,"_jqs_pending",!0)}else e.call(this)})};g.fn.sparkline.defaults={common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.1,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:k,normalRangeMax:k,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:k,chartRangeMax:k,chartRangeMinX:k,chartRangeMaxX:k,tooltipFormat:new C('\x3cspan style\x3d"color: {{color}}"\x3e\x26#9679;\x3c/span\x3e {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:"#3366cc #dc3912 #ff9900 #109618 #66aa00 #dd4477 #0099c6 #990099".split(" "),zeroColor:k,nullColor:k,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:k,chartRangeMin:k,chartRangeClip:!1,colorMap:k,tooltipFormat:new C('\x3cspan style\x3d"color: {{color}}"\x3e\x26#9679;\x3c/span\x3e {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new C('\x3cspan style\x3d"color: {{color}}"\x3e\x26#9679;\x3c/span\x3e {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss",0:"Draw",1:"Win"}}},discrete:{lineHeight:"auto",thresholdColor:k,thresholdValue:0,chartRangeMax:k,chartRangeMin:k,chartRangeClip:!1,tooltipFormat:new C("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:k,tooltipFormat:new C("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:"#3366cc #dc3912 #ff9900 #109618 #66aa00 #dd4477 #0099c6 #990099".split(" "),borderWidth:0,borderColor:"#000",tooltipFormat:new C('\x3cspan style\x3d"color: {{color}}"\x3e\x26#9679;\x3c/span\x3e {{value}} ({{percent.1}}%)')},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:k,targetColor:"#4a2",chartRangeMax:k,chartRangeMin:k,tooltipFormat:new C("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}};g.sparkline_display_visible=function(){var a,b,c,d=[];b=0;for(c=w.length;b<c;b++)a=w[b][0],g(a).is(":visible")&&!g(a).parents().is(":hidden")?(w[b][1].call(a),g.data(w[b][0],"_jqs_pending",!1),d.push(b)):g(a).closest("html").length||g.data(a,"_jqs_pending")||(g.data(w[b][0],"_jqs_pending",!1),d.push(b));for(b=d.length;b;b--)w.splice(d[b-1],1)};g.fn.sparkline.options=p({init:function(a,b){var c,d;this.userOptions=b=b||{};this.tag=a;this.tagValCache={};a=g.fn.sparkline.defaults;c=a.common;this.tagOptionsPrefix=b.enableTagOptions&&(b.tagOptionsPrefix||c.tagOptionsPrefix);d=this.getTagSetting("type");this.mergedOptions=g.extend({},c,d===I?a[b.type||c.type]:a[d],b)},getTagSetting:function(a){var b=this.tagOptionsPrefix,c,d;if(!1===b||b===k)return I;if(this.tagValCache.hasOwnProperty(a))a=this.tagValCache.key;else{a=this.tag.getAttribute(b+a);if(a===k||null===a)a=I;else if("["===a.substr(0,1))for(a=a.substr(1,a.length-2).split(","),b=a.length;b--;)a[b]=F(a[b].replace(/(^\s*)|(\s*$)/g,""));else if("{"===a.substr(0,1))for(c=a.substr(1,a.length-2).split(","),a={},b=c.length;b--;)d=c[b].split(":",2),a[d[0].replace(/(^\s*)|(\s*$)/g,"")]=F(d[1].replace(/(^\s*)|(\s*$)/g,""));else a=F(a);this.tagValCache.key=a}return a},get:function(a,b){var c=this.getTagSetting(a),d;return c!==I?c:(d=this.mergedOptions[a])===k?b:d}});g.fn.sparkline._base=p({disabled:!1,init:function(a,b,c,d,e){this.el=a;this.$el=g(a);this.values=b;this.options=c;this.width=d;this.height=e;this.currentRegion=k},initTarget:function(){var a=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),a))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return this.disabled?(this.el.innerHTML="",!1):!0},getRegion:function(a,b){},setRegionHighlight:function(a,b,c){var d=this.currentRegion,e=!this.options.get("disableHighlight");if(b>this.canvasWidth||c>this.canvasHeight||0>b||0>c)return null;a=this.getRegion(a,b,c);return d!==a?(d!==k&&e&&this.removeHighlight(),this.currentRegion=a,a!==k&&e&&this.renderHighlight(),!0):!1},clearRegionHighlight:function(){return this.currentRegion!==k?(this.removeHighlight(),this.currentRegion=k,!0):!1},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(a){},getCurrentRegionTooltip:function(){var a=this.options,b="",c=[],d,e,h,f,v,m,l,q,n;if(this.currentRegion===k)return"";d=this.getCurrentRegionFields();if(e=a.get("tooltipFormatter"))return e(this,a,d);a.get("tooltipChartTitle")&&(b+='\x3cdiv class\x3d"jqs jqstitle"\x3e'+a.get("tooltipChartTitle")+"\x3c/div\x3e\n");e=this.options.get("tooltipFormat");if(!e)return"";g.isArray(e)||(e=[e]);g.isArray(d)||(d=[d]);h=this.options.get("tooltipFormatFieldlist");f=this.options.get("tooltipFormatFieldlistKey");if(h&&f){v=[];for(m=d.length;m--;)l=d[m][f],-1!=(n=g.inArray(l,h))&&(v[n]=d[m]);d=v}h=e.length;q=d.length;for(m=0;m<h;m++)for(l=e[m],"string"===typeof l&&(l=new C(l)),f=l.fclass||"jqsfield",n=0;n<q;n++)d[n].isNull&&a.get("tooltipSkipNull")||(g.extend(d[n],{prefix:a.get("tooltipPrefix"),suffix:a.get("tooltipSuffix")}),v=l.render(d[n],a.get("tooltipValueLookups"),a),c.push('\x3cdiv class\x3d"'+f+'"\x3e'+v+"\x3c/div\x3e"));return c.length?b+c.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(a,b){var c=b.get("highlightColor");b=b.get("highlightLighten");var d,e;if(c)return c;if(b&&(c=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(a))){d=[];a=4===a.length?16:1;for(e=0;3>e;e++)d[e]=G(f.round(parseInt(c[e+1],16)*a*b),0,255);return"rgb("+d.join(",")+")"}return a}});D={changeHighlight:function(a){var b=this.currentRegion,c=this.target,d=this.regionShapes[b];d&&(a=this.renderRegion(b,a),g.isArray(a)||g.isArray(d)?(c.replaceWithShapes(d,a),this.regionShapes[b]=g.map(a,function(a){return a.id})):(c.replaceWithShape(d,a),this.regionShapes[b]=a.id))},render:function(){var a=this.values,b=this.target,c=this.regionShapes,d,e,h;if(this.cls._super.render.call(this)){for(e=a.length;e--;)if(a=this.renderRegion(e))if(g.isArray(a)){d=[];for(h=a.length;h--;)a[h].append(),d.push(a[h].id);c[e]=d}else a.append(),c[e]=a.id;else c[e]=null;b.render()}}};g.fn.sparkline.line=M=p(g.fn.sparkline._base,{type:"line",init:function(a,b,c,d,e){M._super.init.call(this,a,b,c,d,e);this.vertices=[];this.regionMap=[];this.xvalues=[];this.yvalues=[];this.yminmax=[];this.lastShapeId=this.hightlightSpotId=null;this.initTarget()},getRegion:function(a,b,c){c=this.regionMap;for(a=c.length;a--;)if(null!==c[a]&&b>=c[a][0]&&b<=c[a][1])return c[a][2];return k},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:null===this.yvalues[a],x:this.xvalues[a],y:this.yvalues[a],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:a}},renderHighlight:function(){var a=this.target,b=this.vertices[this.currentRegion],c=this.options,d=c.get("spotRadius"),e=c.get("highlightSpotColor"),c=c.get("highlightLineColor");b&&(d&&e&&(d=a.drawCircle(b[0],b[1],d,k,e),this.highlightSpotId=d.id,a.insertAfterShape(this.lastShapeId,d)),c&&(b=a.drawLine(b[0],this.canvasTop,b[0],this.canvasTop+this.canvasHeight,c),this.highlightLineId=b.id,a.insertAfterShape(this.lastShapeId,b)))},removeHighlight:function(){var a=this.target;this.highlightSpotId&&(a.removeShapeId(this.highlightSpotId),this.highlightSpotId=null);this.highlightLineId&&(a.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){var a=this.values,b=a.length,c=this.xvalues,d=this.yvalues,e=this.yminmax,h,g,k,m,l;for(h=0;h<b;h++)g=a[h],k="string"===typeof a[h],m="object"===typeof a[h]&&a[h]instanceof Array,l=k&&a[h].split(":"),k&&2===l.length?(c.push(Number(l[0])),d.push(Number(l[1])),e.push(Number(l[1]))):m?(c.push(g[0]),d.push(g[1]),e.push(g[1])):(c.push(h),null===a[h]||"null"===a[h]?d.push(null):(d.push(Number(g)),e.push(Number(g))));this.options.get("xvalues")&&(c=this.options.get("xvalues"));this.maxy=this.maxyorg=f.max.apply(f,e);this.miny=this.minyorg=f.min.apply(f,e);this.maxx=f.max.apply(f,c);this.minx=f.min.apply(f,c);this.xvalues=c;this.yvalues=d;this.yminmax=e},processRangeOptions:function(){var a=this.options,b=a.get("normalRangeMin"),c=a.get("normalRangeMax");b!==k&&(b<this.miny&&(this.miny=b),c>this.maxy&&(this.maxy=c));a.get("chartRangeMin")!==k&&(a.get("chartRangeClip")||a.get("chartRangeMin")<this.miny)&&(this.miny=a.get("chartRangeMin"));a.get("chartRangeMax")!==k&&(a.get("chartRangeClip")||a.get("chartRangeMax")>this.maxy)&&(this.maxy=a.get("chartRangeMax"));a.get("chartRangeMinX")!==k&&(a.get("chartRangeClipX")||a.get("chartRangeMinX")<this.minx)&&(this.minx=a.get("chartRangeMinX"));a.get("chartRangeMaxX")!==k&&(a.get("chartRangeClipX")||a.get("chartRangeMaxX")>this.maxx)&&(this.maxx=a.get("chartRangeMaxX"))},drawNormalRange:function(a,b,c,d,e){var h=this.options.get("normalRangeMin"),g=this.options.get("normalRangeMax");b+=f.round(c-(g-this.miny)/e*c);c=f.round(c*(g-h)/e);this.target.drawRect(a,b,d,c,k,this.options.get("normalRangeColor")).append()},render:function(){var a=this.options,b=this.target,c=this.canvasWidth,d=this.canvasHeight,e=this.vertices,h=a.get("spotRadius"),z=this.regionMap,v,m,l,q,n,u,r,y,A,E,p,t,w,B,x;if(M._super.render.call(this)&&(this.scanValues(),this.processRangeOptions(),w=this.xvalues,B=this.yvalues,this.yminmax.length&&!(2>this.yvalues.length))){q=n=0;v=0===this.maxx-this.minx?1:this.maxx-this.minx;m=0===this.maxy-this.miny?1:this.maxy-this.miny;l=this.yvalues.length-1;h&&(c<4*h||d<4*h)&&(h=0);if(h){if((t=a.get("highlightSpotColor")&&!a.get("disableInteraction"))||a.get("minSpotColor")||a.get("spotColor")&&B[l]===this.miny)d-=f.ceil(h);if(t||a.get("maxSpotColor")||a.get("spotColor")&&B[l]===this.maxy)d-=f.ceil(h),q+=f.ceil(h);if(t||(a.get("minSpotColor")||a.get("maxSpotColor"))&&(B[0]===this.miny||B[0]===this.maxy))n+=f.ceil(h),c-=f.ceil(h);if(t||a.get("spotColor")||a.get("minSpotColor")||a.get("maxSpotColor")&&(B[l]===this.miny||B[l]===this.maxy))c-=f.ceil(h)}d--;a.get("normalRangeMin")===k||a.get("drawNormalOnTop")||this.drawNormalRange(n,q,d,c,m);r=[];y=[r];p=null;t=B.length;for(x=0;x<t;x++)A=w[x],E=w[x+1],u=B[x],A=n+f.round(c/v*(A-this.minx)),E=x<t-1?n+f.round(c/v*(E-this.minx)):c,E=A+(E-A)/2,z[x]=[p||0,E,x],p=E,null===u?x&&(null!==B[x-1]&&(r=[],y.push(r)),e.push(null)):(u<this.miny&&(u=this.miny),u>this.maxy&&(u=this.maxy),r.length||r.push([A,q+d]),u=[A,q+f.round(d-(u-this.miny)/m*d)],r.push(u),e.push(u));e=[];z=[];p=y.length;for(x=0;x<p;x++)r=y[x],r.length&&(a.get("fillColor")&&(r.push([r[r.length-1][0],q+d]),z.push(r.slice(0)),r.pop()),2<r.length&&(r[0]=[r[0][0],r[1][1]]),e.push(r));p=z.length;for(x=0;x<p;x++)b.drawShape(z[x],a.get("fillColor"),a.get("fillColor")).append();a.get("normalRangeMin")!==k&&a.get("drawNormalOnTop")&&this.drawNormalRange(n,q,d,c,m);p=e.length;for(x=0;x<p;x++)b.drawShape(e[x],a.get("lineColor"),k,a.get("lineWidth")).append();if(h&&a.get("valueSpots"))for(r=a.get("valueSpots"),r.get===k&&(r=new H(r)),x=0;x<t;x++)(y=r.get(B[x]))&&b.drawCircle(n+f.round(c/v*(w[x]-this.minx)),q+f.round(d-(B[x]-this.miny)/m*d),h,k,y).append();h&&a.get("spotColor")&&null!==B[l]&&b.drawCircle(n+f.round(c/v*(w[w.length-1]-this.minx)),q+f.round(d-(B[l]-this.miny)/m*d),h,k,a.get("spotColor")).append();this.maxy!==this.minyorg&&(h&&a.get("minSpotColor")&&(A=w[g.inArray(this.minyorg,B)],b.drawCircle(n+f.round(c/v*(A-this.minx)),q+f.round(d-(this.minyorg-this.miny)/m*d),h,k,a.get("minSpotColor")).append()),h&&a.get("maxSpotColor")&&(A=w[g.inArray(this.maxyorg,B)],b.drawCircle(n+f.round(c/v*(A-this.minx)),q+f.round(d-(this.maxyorg-this.miny)/m*d),h,k,a.get("maxSpotColor")).append()));this.lastShapeId=b.getLastShapeId();this.canvasTop=q;b.render()}}});g.fn.sparkline.bar=Z=p(g.fn.sparkline._base,D,{type:"bar",init:function(a,b,c,d,e){var h=parseInt(c.get("barWidth"),10),z=parseInt(c.get("barSpacing"),10),v=c.get("chartRangeMin"),m=c.get("chartRangeMax"),l=c.get("chartRangeClip"),q=Infinity,n=-Infinity,u,r,y,A,p,t,w;Z._super.init.call(this,a,b,c,d,e);a=0;for(d=b.length;a<d;a++)if(e=b[a],(u="string"===typeof e&&-1<e.indexOf(":"))||g.isArray(e))A=!0,u&&(e=b[a]=K(e.split(":"))),e=S(e,null),u=f.min.apply(f,e),e=f.max.apply(f,e),u<q&&(q=u),e>n&&(n=e);this.stacked=A;this.regionShapes={};this.barWidth=h;this.barSpacing=z;this.totalBarWidth=h+z;this.width=b.length*h+(b.length-1)*z;this.initTarget();l&&(y=v===k?-Infinity:v,r=m===k?Infinity:m);v=[];h=A?[]:v;m=[];z=[];a=0;for(d=b.length;a<d;a++)if(A)for(u=b[a],b[a]=w=[],m[a]=0,p=h[a]=z[a]=0,t=u.length;p<t;p++)e=w[p]=l?G(u[p],y,r):u[p],null!==e&&(0<e&&(m[a]+=e),0>q&&0<n?0>e?z[a]+=f.abs(e):h[a]+=e:h[a]+=f.abs(e-(0>e?n:q)),v.push(e));else e=l?G(b[a],y,r):b[a],e=b[a]=F(e),null!==e&&v.push(e);this.max=l=f.max.apply(f,v);this.min=b=f.min.apply(f,v);this.stackMax=n=A?f.max.apply(f,m):l;this.stackMin=A?f.min.apply(f,v):b;c.get("chartRangeMin")!==k&&(c.get("chartRangeClip")||c.get("chartRangeMin")<b)&&(b=c.get("chartRangeMin"));c.get("chartRangeMax")!==k&&(c.get("chartRangeClip")||c.get("chartRangeMax")>l)&&(l=c.get("chartRangeMax"));this.zeroAxis=q=c.get("zeroAxis",!0);this.xaxisOffset=y=0>=b&&0<=l&&q?0:0==q?b:0<b?b:l;r=A?f.max.apply(f,h)+f.max.apply(f,z):l-b;this.canvasHeightEf=q&&0>b?this.canvasHeight-2:this.canvasHeight-1;b<y?(n=((A&&0<=l?n:l)-y)/r*this.canvasHeight,n!==f.ceil(n)&&(this.canvasHeightEf-=2,n=f.ceil(n))):n=this.canvasHeight;this.yoffset=n;g.isArray(c.get("colorMap"))?(this.colorMapByIndex=c.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,(this.colorMapByValue=c.get("colorMap"))&&this.colorMapByValue.get===k&&(this.colorMapByValue=new H(this.colorMapByValue)));this.range=r},getRegion:function(a,b,c){a=f.floor(b/this.totalBarWidth);return 0>a||a>=this.values.length?k:a},getCurrentRegionFields:function(){var a=this.currentRegion,b=V(this.values[a]),c=[],d,e;for(e=b.length;e--;)d=b[e],c.push({isNull:null===d,value:d,color:this.calcColor(e,d,a),offset:a});return c},calcColor:function(a,b,c){var d=this.colorMapByIndex,e=this.colorMapByValue,h=this.options,f,v;f=this.stacked?h.get("stackedBarColor"):0>b?h.get("negBarColor"):h.get("barColor");0===b&&h.get("zeroColor")!==k&&(f=h.get("zeroColor"));e&&(v=e.get(b))?f=v:d&&d.length>c&&(f=d[c]);return g.isArray(f)?f[a%f.length]:f},renderRegion:function(a,b){var c=this.values[a],d=this.options,e=this.xaxisOffset,h=[],z=this.range,v=this.stacked,m=this.target,l=a*this.totalBarWidth,q=this.canvasHeightEf,n=this.yoffset,u,r,y,p,t,w,C,D,c=g.isArray(c)?c:[c];w=c.length;u=L(null,c);D=L(e,c,!0);if(u)return d.get("nullColor")?(y=b?d.get("nullColor"):this.calcHighlightColor(d.get("nullColor"),d),m.drawRect(l,0<n?n-1:n,this.barWidth-1,0,y,y)):k;p=n;for(t=0;t<w;t++){y=c[t];if(v&&y===e){if(!D||C)continue;C=!0}r=0<z?f.floor(q*(f.abs(y-e)/z))+1:1;y<e||y===e&&0===n?(u=p,p+=r):(u=n-r,n-=r);y=this.calcColor(t,y,a);b&&(y=this.calcHighlightColor(y,d));h.push(m.drawRect(l,u,this.barWidth-1,r-1,y,y))}return 1===h.length?h[0]:h}});g.fn.sparkline.tristate=aa=p(g.fn.sparkline._base,D,{type:"tristate",init:function(a,b,c,d,e){var h=parseInt(c.get("barWidth"),10),f=parseInt(c.get("barSpacing"),10);aa._super.init.call(this,a,b,c,d,e);this.regionShapes={};this.barWidth=h;this.barSpacing=f;this.totalBarWidth=h+f;this.values=g.map(b,Number);this.width=b.length*h+(b.length-1)*f;g.isArray(c.get("colorMap"))?(this.colorMapByIndex=c.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,(this.colorMapByValue=c.get("colorMap"))&&this.colorMapByValue.get===k&&(this.colorMapByValue=new H(this.colorMapByValue)));this.initTarget()},getRegion:function(a,b,c){return f.floor(b/this.totalBarWidth)},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===k,value:this.values[a],color:this.calcColor(this.values[a],a),offset:a}},calcColor:function(a,b){var c=this.values,d=this.options,e=this.colorMapByIndex,h=this.colorMapByValue,f;return h&&(f=h.get(a))?f:e&&e.length>b?e[b]:0>c[b]?d.get("negBarColor"):0<c[b]?d.get("posBarColor"):d.get("zeroBarColor")},renderRegion:function(a,b){var c=this.values,d=this.options,e=this.target,h,g,k;h=f.round(e.pixelHeight/2);g=a*this.totalBarWidth;0>c[a]?(k=h,--h):0<c[a]?(k=0,--h):(k=h-1,h=2);a=this.calcColor(c[a],a);if(null!==a)return b&&(a=this.calcHighlightColor(a,d)),e.drawRect(g,k,this.barWidth-1,h-1,a,a)}});g.fn.sparkline.discrete=ba=p(g.fn.sparkline._base,D,{type:"discrete",init:function(a,b,c,d,e){ba._super.init.call(this,a,b,c,d,e);this.regionShapes={};this.values=b=g.map(b,Number);this.min=f.min.apply(f,b);this.max=f.max.apply(f,b);this.range=this.max-this.min;this.width=d="auto"===c.get("width")?2*b.length:this.width;this.interval=f.floor(d/b.length);this.itemWidth=d/b.length;c.get("chartRangeMin")!==k&&(c.get("chartRangeClip")||c.get("chartRangeMin")<this.min)&&(this.min=c.get("chartRangeMin"));c.get("chartRangeMax")!==k&&(c.get("chartRangeClip")||c.get("chartRangeMax")>this.max)&&(this.max=c.get("chartRangeMax"));this.initTarget();this.target&&(this.lineHeight="auto"===c.get("lineHeight")?f.round(.3*this.canvasHeight):c.get("lineHeight"))},getRegion:function(a,b,c){return f.floor(b/this.itemWidth)},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===k,value:this.values[a],offset:a}},renderRegion:function(a,b){var c=this.options,d=this.min,e=this.range,h=this.interval,g=this.target,k=this.lineHeight,m=this.canvasHeight-k,l;l=G(this.values[a],d,this.max);a*=h;d=f.round(m-(l-d)/e*m);l=c.get("thresholdColor")&&l<c.get("thresholdValue")?c.get("thresholdColor"):c.get("lineColor");b&&(l=this.calcHighlightColor(l,c));return g.drawLine(a,d,a,d+k,l)}});g.fn.sparkline.bullet=N=p(g.fn.sparkline._base,{type:"bullet",init:function(a,b,c,d,e){var h;N._super.init.call(this,a,b,c,d,e);this.values=b=K(b);a=b.slice();a[0]=null===a[0]?a[2]:a[0];a[1]=null===b[1]?a[2]:a[1];a=f.min.apply(f,b);h=f.max.apply(f,b);this.min=a=c.get("base")===k?0>a?a:0:c.get("base");this.max=h;this.range=h-a;this.shapes={};this.valueShapes={};this.regiondata={};this.width=d="auto"===c.get("width")?"4.0em":d;this.target=this.$el.simpledraw(d,e,c.get("composite"));b.length||(this.disabled=!0);this.initTarget()},getRegion:function(a,b,c){a=this.target.getShapeAt(a,b,c);return a!==k&&this.shapes[a]!==k?this.shapes[a]:k},getCurrentRegionFields:function(){var a=this.currentRegion;return{fieldkey:a.substr(0,1),value:this.values[a.substr(1)],region:a}},changeHighlight:function(a){var b=this.currentRegion,c=this.valueShapes[b],d;delete this.shapes[c];switch(b.substr(0,1)){case "r":d=this.renderRange(b.substr(1),a);break;case "p":d=this.renderPerformance(a);break;case "t":d=this.renderTarget(a)}this.valueShapes[b]=d.id;this.shapes[d.id]=b;this.target.replaceWithShape(c,d)},renderRange:function(a,b){var c=f.round((this.values[a]-this.min)/this.range*this.canvasWidth);a=this.options.get("rangeColors")[a-2];b&&(a=this.calcHighlightColor(a,this.options));return this.target.drawRect(0,0,c-1,this.canvasHeight-1,a,a)},renderPerformance:function(a){var b=f.round((this.values[1]-this.min)/this.range*this.canvasWidth),c=this.options.get("performanceColor");a&&(c=this.calcHighlightColor(c,this.options));return this.target.drawRect(0,f.round(.3*this.canvasHeight),b-1,f.round(.4*this.canvasHeight)-1,c,c)},renderTarget:function(a){var b=f.round((this.values[0]-this.min)/this.range*this.canvasWidth-this.options.get("targetWidth")/2),c=f.round(.1*this.canvasHeight),d=this.canvasHeight-2*c,e=this.options.get("targetColor");a&&(e=this.calcHighlightColor(e,this.options));return this.target.drawRect(b,c,this.options.get("targetWidth")-1,d-1,e,e)},render:function(){var a=this.values.length,b=this.target,c,d;if(N._super.render.call(this)){for(c=2;c<a;c++)d=this.renderRange(c).append(),this.shapes[d.id]="r"+c,this.valueShapes["r"+c]=d.id;null!==this.values[1]&&(d=this.renderPerformance().append(),this.shapes[d.id]="p1",this.valueShapes.p1=d.id);null!==this.values[0]&&(d=this.renderTarget().append(),this.shapes[d.id]="t0",this.valueShapes.t0=d.id);b.render()}}});g.fn.sparkline.pie=O=p(g.fn.sparkline._base,{type:"pie",init:function(a,b,c,d,e){var h=0;O._super.init.call(this,a,b,c,d,e);this.shapes={};this.valueShapes={};this.values=b=g.map(b,Number);"auto"===c.get("width")&&(this.width=this.height);if(0<b.length)for(a=b.length;a--;)h+=b[a];this.total=h;this.initTarget();this.radius=f.floor(f.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(a,b,c){a=this.target.getShapeAt(a,b,c);return a!==k&&this.shapes[a]!==k?this.shapes[a]:k},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===k,value:this.values[a],percent:this.values[a]/this.total*100,color:this.options.get("sliceColors")[a%this.options.get("sliceColors").length],offset:a}},changeHighlight:function(a){var b=this.currentRegion;a=this.renderSlice(b,a);var c=this.valueShapes[b];delete this.shapes[c];this.target.replaceWithShape(c,a);this.valueShapes[b]=a.id;this.shapes[a.id]=b},renderSlice:function(a,b){var c=this.target,d=this.options,e=this.radius,h=d.get("borderWidth"),g=d.get("offset"),v=2*f.PI,m=this.values,l=this.total,q=g?g/360*f.PI*2:0,n,u,r;r=m.length;for(u=0;u<r;u++){n=g=q;0<l&&(n=q+m[u]/l*v);if(a===u)return a=d.get("sliceColors")[u%d.get("sliceColors").length],b&&(a=this.calcHighlightColor(a,d)),c.drawPieSlice(e,e,e-h,g,n,k,a);q=n}},render:function(){var a=this.target,b=this.values,c=this.options,d=this.radius,e=c.get("borderWidth");if(O._super.render.call(this)){e&&a.drawCircle(d,d,f.floor(d-e/2),c.get("borderColor"),k,e).append();for(d=b.length;d--;)b[d]&&(c=this.renderSlice(d).append(),this.valueShapes[d]=c.id,this.shapes[c.id]=d);a.render()}}});g.fn.sparkline.box=P=p(g.fn.sparkline._base,{type:"box",init:function(a,b,c,d,e){P._super.init.call(this,a,b,c,d,e);this.values=g.map(b,Number);this.width="auto"===c.get("width")?"4.0em":d;this.initTarget();this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var a=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];this.loutlier!==k&&a.push({field:"lo",value:this.loutlier});this.routlier!==k&&a.push({field:"ro",value:this.routlier});this.lwhisker!==k&&a.push({field:"lw",value:this.lwhisker});this.rwhisker!==k&&a.push({field:"rw",value:this.rwhisker});return a},render:function(){var a=this.target,b=this.values,c=b.length,d=this.options,e=this.canvasWidth,h=this.canvasHeight,g=d.get("chartRangeMin")===k?f.min.apply(f,b):d.get("chartRangeMin"),v=d.get("chartRangeMax")===k?f.max.apply(f,b):d.get("chartRangeMax"),m=0,l,q,n,u,r,p,t,w;if(P._super.render.call(this)){if(d.get("raw"))d.get("showOutliers")&&5<b.length?(q=b[0],l=b[1],u=b[2],r=b[3],p=b[4],t=b[5],w=b[6]):(l=b[0],u=b[1],r=b[2],p=b[3],t=b[4]);else if(b.sort(function(a,b){return a-b}),u=J(b,1),r=J(b,2),p=J(b,3),n=p-u,d.get("showOutliers")){l=t=k;for(q=0;q<c;q++)l===k&&b[q]>u-n*d.get("outlierIQR")&&(l=b[q]),b[q]<p+n*d.get("outlierIQR")&&(t=b[q]);q=b[0];w=b[c-1]}else l=b[0],t=b[c-1];this.quartiles=[u,r,p];this.lwhisker=l;this.rwhisker=t;this.loutlier=q;this.routlier=w;b=e/(v-g+1);d.get("showOutliers")&&(m=f.ceil(d.get("spotRadius")),e-=2*f.ceil(d.get("spotRadius")),b=e/(v-g+1),q<l&&a.drawCircle((q-g)*b+m,h/2,d.get("spotRadius"),d.get("outlierLineColor"),d.get("outlierFillColor")).append(),w>t&&a.drawCircle((w-g)*b+m,h/2,d.get("spotRadius"),d.get("outlierLineColor"),d.get("outlierFillColor")).append());a.drawRect(f.round((u-g)*b+m),f.round(.1*h),f.round((p-u)*b),f.round(.8*h),d.get("boxLineColor"),d.get("boxFillColor")).append();a.drawLine(f.round((l-g)*b+m),f.round(h/2),f.round((u-g)*b+m),f.round(h/2),d.get("lineColor")).append();a.drawLine(f.round((l-g)*b+m),f.round(h/4),f.round((l-g)*b+m),f.round(h-h/4),d.get("whiskerColor")).append();a.drawLine(f.round((t-g)*b+m),f.round(h/2),f.round((p-g)*b+m),f.round(h/2),d.get("lineColor")).append();a.drawLine(f.round((t-g)*b+m),f.round(h/4),f.round((t-g)*b+m),f.round(h-h/4),d.get("whiskerColor")).append();a.drawLine(f.round((r-g)*b+m),f.round(.1*h),f.round((r-g)*b+m),f.round(.9*h),d.get("medianColor")).append();d.get("target")&&(e=f.ceil(d.get("spotRadius")),a.drawLine(f.round((d.get("target")-g)*b+m),f.round(h/2-e),f.round((d.get("target")-g)*b+m),f.round(h/2+e),d.get("targetColor")).append(),a.drawLine(f.round((d.get("target")-g)*b+m-e),f.round(h/2),f.round((d.get("target")-g)*b+m+e),f.round(h/2),d.get("targetColor")).append());a.render()}}});ca=p({init:function(a,b,c,d){this.target=a;this.id=b;this.type=c;this.args=d},append:function(){this.target.appendShape(this);return this}});D=p({_pxregex:/(\d+)(px)?\s*$/i,init:function(a,b,c){a&&(this.width=a,this.height=b,this.target=c,this.lastShapeId=null,c[0]&&(c=c[0]),g.data(c,"_jqs_vcanvas",this))},drawLine:function(a,b,c,d,e,h){return this.drawShape([[a,b],[c,d]],e,h)},drawShape:function(a,b,c,d){return this._genShape("Shape",[a,b,c,d])},drawCircle:function(a,b,c,d,e,h){return this._genShape("Circle",[a,b,c,d,e,h])},drawPieSlice:function(a,b,c,d,e,h,f){return this._genShape("PieSlice",[a,b,c,d,e,h,f])},drawRect:function(a,b,c,d,e,h){return this._genShape("Rect",[a,b,c,d,e,h])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(a,b){g(b).html(a)},_calculatePixelDims:function(a,b,c){this.pixelHeight=(b=this._pxregex.exec(b))?b[1]:g(c).height();this.pixelWidth=(b=this._pxregex.exec(a))?b[1]:g(c).width()},_genShape:function(a,b){var c=da++;b.unshift(c);return new ca(this,c,a,b)},appendShape:function(a){alert("appendShape not implemented")},replaceWithShape:function(a,b){alert("replaceWithShape not implemented")},insertAfterShape:function(a,b){alert("insertAfterShape not implemented")},removeShapeId:function(a){alert("removeShapeId not implemented")},getShapeAt:function(a,b,c){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}});Q=p(D,{init:function(a,b,c,d){Q._super.init.call(this,a,b,c);this.canvas=t.createElement("canvas");c[0]&&(c=c[0]);g.data(c,"_jqs_vcanvas",this);g(this.canvas).css({display:"inline-block",width:a,height:b,verticalAlign:"top"});this._insert(this.canvas,c);this._calculatePixelDims(a,b,this.canvas);this.canvas.width=this.pixelWidth;this.canvas.height=this.pixelHeight;this.interact=d;this.shapes={};this.shapeseq=[];this.currentTargetShapeId=k;g(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(a,b,c){var d=this.canvas.getContext("2d");a!==k&&(d.strokeStyle=a);d.lineWidth=c===k?1:c;b!==k&&(d.fillStyle=b);return d},reset:function(){this._getContext().clearRect(0,0,this.pixelWidth,this.pixelHeight);this.shapes={};this.shapeseq=[];this.currentTargetShapeId=k},_drawShape:function(a,b,c,d,e){e=this._getContext(c,d,e);var h,f;e.beginPath();e.moveTo(b[0][0]+.5,b[0][1]+.5);h=1;for(f=b.length;h<f;h++)e.lineTo(b[h][0]+.5,b[h][1]+.5);c!==k&&e.stroke();d!==k&&e.fill();this.targetX!==k&&this.targetY!==k&&e.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=a)},_drawCircle:function(a,b,c,d,e,h,g){g=this._getContext(e,h,g);g.beginPath();g.arc(b,c,d,0,2*f.PI,!1);this.targetX!==k&&this.targetY!==k&&g.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=a);e!==k&&g.stroke();h!==k&&g.fill()},_drawPieSlice:function(a,b,c,d,e,f,g,p){var h=this._getContext(g,p);h.beginPath();h.moveTo(b,c);h.arc(b,c,d,e,f,!1);h.lineTo(b,c);h.closePath();g!==k&&h.stroke();p&&h.fill();this.targetX!==k&&this.targetY!==k&&h.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=a)},_drawRect:function(a,b,c,d,e,h,f){return this._drawShape(a,[[b,c],[b+d,c],[b+d,c+e],[b,c+e],[b,c]],h,f)},appendShape:function(a){this.shapes[a.id]=a;this.shapeseq.push(a.id);return this.lastShapeId=a.id},replaceWithShape:function(a,b){var c=this.shapeseq,d;this.shapes[b.id]=b;for(d=c.length;d--;)c[d]==a&&(c[d]=b.id);delete this.shapes[a]},replaceWithShapes:function(a,b){var c=this.shapeseq,d={},e,h;for(e=a.length;e--;)d[a[e]]=!0;for(e=c.length;e--;)a=c[e],d[a]&&(c.splice(e,1),delete this.shapes[a],h=e);for(e=b.length;e--;)c.splice(h,0,b[e].id),this.shapes[b[e].id]=b[e]},insertAfterShape:function(a,b){var c=this.shapeseq,d;for(d=c.length;d--;)if(c[d]===a){c.splice(d+1,0,b.id);this.shapes[b.id]=b;break}},removeShapeId:function(a){var b=this.shapeseq,c;for(c=b.length;c--;)if(b[c]===a){b.splice(c,1);break}delete this.shapes[a]},getShapeAt:function(a,b,c){this.targetX=b;this.targetY=c;this.render();return this.currentTargetShapeId},render:function(){var a=this.shapeseq,b=this.shapes,c=a.length,d,e;this._getContext().clearRect(0,0,this.pixelWidth,this.pixelHeight);for(e=0;e<c;e++)d=a[e],d=b[d],this["_draw"+d.type].apply(this,d.args);this.interact||(this.shapes={},this.shapeseq=[])}});R=p(D,{init:function(a,b,c){R._super.init.call(this,a,b,c);c[0]&&(c=c[0]);g.data(c,"_jqs_vcanvas",this);this.canvas=t.createElement("span");g(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:a,height:b,margin:"0px",padding:"0px",verticalAlign:"top"});this._insert(this.canvas,c);this._calculatePixelDims(a,b,this.canvas);this.canvas.width=this.pixelWidth;this.canvas.height=this.pixelHeight;this.canvas.insertAdjacentHTML("beforeEnd",'\x3cv:group coordorigin\x3d"0 0" coordsize\x3d"'+this.pixelWidth+" "+this.pixelHeight+'" style\x3d"position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height\x3d"+this.pixelHeight+'px;"\x3e\x3c/v:group\x3e');this.group=g(this.canvas).children()[0];this.rendered=!1;this.prerender=""},_drawShape:function(a,b,c,d,e){var h=[],f,g;g=0;for(f=b.length;g<f;g++)h[g]=""+b[g][0]+","+b[g][1];b=h.splice(0,1);e=e===k?1:e;c=c===k?' stroked\x3d"false" ':' strokeWeight\x3d"'+e+'px" strokeColor\x3d"'+c+'" ';d=d===k?' filled\x3d"false"':' fillColor\x3d"'+d+'" filled\x3d"true" ';e=h[0]===h[h.length-1]?"x ":"";return'\x3cv:shape coordorigin\x3d"0 0" coordsize\x3d"'+this.pixelWidth+" "+this.pixelHeight+'"  id\x3d"jqsshape'+a+'" '+c+d+' style\x3d"position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path\x3d"m '+b+" l "+h.join(", ")+" "+e+'e"\x3e \x3c/v:shape\x3e'},_drawCircle:function(a,b,c,d,e,f,g){return'\x3cv:oval  id\x3d"jqsshape'+a+'" '+(e===k?' stroked\x3d"false" ':' strokeWeight\x3d"'+g+'px" strokeColor\x3d"'+e+'" ')+(f===k?' filled\x3d"false"':' fillColor\x3d"'+f+'" filled\x3d"true" ')+' style\x3d"position:absolute;top:'+(c-d)+"px; left:"+(b-d)+"px; width:"+2*d+"px; height:"+2*d+'px"\x3e\x3c/v:oval\x3e'},_drawPieSlice:function(a,b,c,d,e,h,g,p){var m,l,q,n;if(e===h)return"";h-e===2*f.PI&&(e=0,h=2*f.PI);m=b+f.round(f.cos(e)*d);l=c+f.round(f.sin(e)*d);q=b+f.round(f.cos(h)*d);n=c+f.round(f.sin(h)*d);if(m===q&&l===n){if(h-e<f.PI)return"";m=q=b+d;l=n=c}return m===q&&l===n&&h-e<f.PI?"":'\x3cv:shape coordorigin\x3d"0 0" coordsize\x3d"'+this.pixelWidth+" "+this.pixelHeight+'"  id\x3d"jqsshape'+a+'" '+(g===k?' stroked\x3d"false" ':' strokeWeight\x3d"1px" strokeColor\x3d"'+g+'" ')+(p===k?' filled\x3d"false"':' fillColor\x3d"'+p+'" filled\x3d"true" ')+' style\x3d"position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path\x3d"m '+b+","+c+" wa "+[b-d,c-d,b+d,c+d,m,l,q,n].join(", ")+' x e"\x3e \x3c/v:shape\x3e'},_drawRect:function(a,b,c,d,e,f,g){return this._drawShape(a,[[b,c],[b,c+e],[b+d,c+e],[b+d,c],[b,c]],f,g)},reset:function(){this.group.innerHTML=""},appendShape:function(a){var b=this["_draw"+a.type].apply(this,a.args);this.rendered?this.group.insertAdjacentHTML("beforeEnd",b):this.prerender+=b;return this.lastShapeId=a.id},replaceWithShape:function(a,b){a=g("#jqsshape"+a);b=this["_draw"+b.type].apply(this,b.args);a[0].outerHTML=b},replaceWithShapes:function(a,b){var c=g("#jqsshape"+a[0]),d="",e=b.length,f;for(f=0;f<e;f++)d+=this["_draw"+b[f].type].apply(this,b[f].args);c[0].outerHTML=d;for(f=1;f<a.length;f++)g("#jqsshape"+a[f]).remove()},insertAfterShape:function(a,b){a=g("#jqsshape"+a);b=this["_draw"+b.type].apply(this,b.args);a[0].insertAdjacentHTML("afterEnd",b)},removeShapeId:function(a){a=g("#jqsshape"+a);this.group.removeChild(a[0])},getShapeAt:function(a,b,c){return a.id.substr(8)},render:function(){this.rendered||(this.group.innerHTML=this.prerender,this.rendered=!0)}})})})(document,Math);