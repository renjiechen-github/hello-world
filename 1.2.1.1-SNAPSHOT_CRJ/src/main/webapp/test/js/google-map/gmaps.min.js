'use strict';if(window.google&&window.google.maps)var GMaps=function(h){var k=document,l=function(a,d){return"jQuery"in h&&d?$("#"+a.replace("#",""),d)[0]:k.getElementById(a.replace("#",""))},p=function(a){var d=this,e="bounds_changed center_changed click dblclick drag dragend dragstart idle maptypeid_changed projection_changed resize tilesloaded zoom_changed".split(" "),h=["mousemove","mouseout","mouseover"];window.context_menu={};this.el="string"===typeof a.el||"string"===typeof a.div?l(a.el||a.div,a.context):a.el||a.div;this.el.style.width=a.width||this.el.scrollWidth||this.el.offsetWidth;this.el.style.height=a.height||this.el.scrollHeight||this.el.offsetHeight;this.controls=[];this.overlays=[];this.layers=[];this.singleLayers={};this.markers=[];this.polylines=[];this.routes=[];this.polygons=[];this.overlay_el=this.infoWindow=null;this.zoom=a.zoom||15;var n=a.markerClusterer,v;v=a.mapType?google.maps.MapTypeId[a.mapType.toUpperCase()]:google.maps.MapTypeId.ROADMAP;var z=new google.maps.LatLng(a.lat,a.lng);delete a.el;delete a.lat;delete a.lng;delete a.mapType;delete a.width;delete a.height;delete a.markerClusterer;var g=a.zoomControlOpt||{style:"DEFAULT",position:"TOP_LEFT"},q={},q={zoom:this.zoom,center:z,mapTypeId:v},g={panControl:a.panControl||!0,zoomControl:a.zoomControl||!0,zoomControlOptions:{style:google.maps.ZoomControlStyle[g.style||"DEFAULT"],position:google.maps.ControlPosition[g.position||"TOP_LEFT"]},mapTypeControl:a.mapTypeControl||!0,scaleControl:a.scaleControl||!0,streetViewControl:a.streetViewControl||!0,overviewMapControl:!0};1!=a.disableDefaultUI&&(q=extend_object(q,g));q=extend_object(q,a);for(g=0;g<e.length;g++)delete q[e[g]];for(g=0;g<h.length;g++)delete q[h[g]];this.map=new google.maps.Map(this.el,q);n&&(this.markerClusterer=n.apply(this,[this.map]));var w=function(b,c){var a="",f=window.context_menu[b],m;for(m in f)f.hasOwnProperty(m)&&(a+='\x3cli\x3e\x3ca id\x3d"'+b+"_"+m+'" href\x3d"#"\x3e'+f[m].title+"\x3c/a\x3e\x3c/li\x3e");if(l("gmaps_context_menu")){var r=l("gmaps_context_menu");r.innerHTML=a;var a=r.getElementsByTagName("a"),e=a.length;for(m=0;m<e;m++){var g=a[m];google.maps.event.clearListeners(g,"click");google.maps.event.addDomListenerOnce(g,"click",function(a){a.preventDefault();f[this.id.replace(b+"_","")].action.apply(d,[c]);d.hideContextMenu()},!1)}m=d.el.offsetTop+c.pixel.y-15;r.style.left=d.el.offsetLeft+c.pixel.x-15+"px";r.style.top=m+"px";r.style.display="block"}},x=function(b,c){if("marker"===b){c.pixel={};var a=new google.maps.OverlayView;a.setMap(d.map);a.draw=function(){var A=a.getProjection(),m=c.marker.getPosition();c.pixel=A.fromLatLngToContainerPixel(m);w(b,c)}}else w(b,c)};this.setContextMenu=function(b){window.context_menu[b.control]={};for(var c in b.options)if(b.options.hasOwnProperty(c)){var a=b.options[c];window.context_menu[b.control][a.name]={title:a.title,action:a.action}}b=k.createElement("ul");b.id="gmaps_context_menu";b.style.display="none";b.style.position="absolute";b.style.minWidth="100px";b.style.background="white";b.style.listStyle="none";b.style.padding="8px";b.style.boxShadow="2px 2px 6px #ccc";k.body.appendChild(b);var f=l("gmaps_context_menu");google.maps.event.addDomListener(f,"mouseout",function(b){b.relatedTarget&&this.contains(b.relatedTarget)||window.setTimeout(function(){f.style.display="none"},400)},!1)};this.hideContextMenu=function(){var b=l("gmaps_context_menu");b&&(b.style.display="none")};n=function(b,c){google.maps.event.addListener(b,c,function(b){void 0==b&&(b=this);a[c].apply(this,[b]);d.hideContextMenu()})};for(g=0;g<e.length;g++)q=e[g],q in a&&n(this.map,q);for(g=0;g<h.length;g++)q=h[g],q in a&&n(this.map,q);google.maps.event.addListener(this.map,"rightclick",function(b){a.rightclick&&a.rightclick.apply(this,[b]);void 0!=window.context_menu.map&&x("map",b)});this.refresh=function(){google.maps.event.trigger(this.map,"resize")};this.fitZoom=function(){for(var b=[],c=this.markers.length,a=0;a<c;a++)b.push(this.markers[a].getPosition());this.fitLatLngBounds(b)};this.fitLatLngBounds=function(b){for(var c=b.length,a=new google.maps.LatLngBounds,f=0;f<c;f++)a.extend(b[f]);this.map.fitBounds(a)};this.setCenter=function(b,c,a){this.map.panTo(new google.maps.LatLng(b,c));a&&a()};this.getElement=function(){return this.el};this.zoomIn=function(b){this.zoom=this.map.getZoom()+b;this.map.setZoom(this.zoom)};this.zoomOut=function(b){this.zoom=this.map.getZoom()-b;this.map.setZoom(this.zoom)};var e=[],u;for(u in this.map)"function"!=typeof this.map[u]||this[u]||e.push(u);for(g=0;g<e.length;g++)(function(b,c,a){b[a]=function(){return c[a].apply(c,arguments)}})(this,this.map,e[g]);this.createControl=function(b){var c=k.createElement("div");c.style.cursor="pointer";c.style.fontFamily="Arial, sans-serif";c.style.fontSize="13px";c.style.boxShadow="rgba(0, 0, 0, 0.398438) 0px 2px 4px";for(var a in b.style)c.style[a]=b.style[a];b.id&&(c.id=b.id);b.classes&&(c.className=b.classes);b.content&&(c.innerHTML=b.content);for(var f in b.events)(function(c,a){google.maps.event.addDomListener(c,a,function(){b.events[a].apply(this,[this])})})(c,f);c.index=1;return c};this.addControl=function(b){var c=google.maps.ControlPosition[b.position.toUpperCase()];delete b.position;b=this.createControl(b);this.controls.push(b);this.map.controls[c].push(b);return b};this.createMarker=function(b){if(b.hasOwnProperty("lat")&&b.hasOwnProperty("lng")||b.position){var c=this,a=b.details,f=b.fences,m=b.outside,d={position:new google.maps.LatLng(b.lat,b.lng),map:null};delete b.lat;delete b.lng;delete b.fences;delete b.outside;var d=extend_object(d,b),e=new google.maps.Marker(d);e.fences=f;if(b.infoWindow)for(e.infoWindow=new google.maps.InfoWindow(b.infoWindow),d=["closeclick","content_changed","domready","position_changed","zindex_changed"],f=0;f<d.length;f++)(function(c,a){google.maps.event.addListener(c,a,function(c){b.infoWindow[a]&&b.infoWindow[a].apply(this,[c])})})(e.infoWindow,d[f]);for(var d="animation_changed clickable_changed cursor_changed draggable_changed flat_changed icon_changed position_changed shadow_changed shape_changed title_changed visible_changed zindex_changed".split(" "),g="dblclick drag dragend dragstart mousedown mouseout mouseover mouseup".split(" "),f=0;f<d.length;f++)(function(c,a){google.maps.event.addListener(c,a,function(){b[a]&&b[a].apply(this,[this])})})(e,d[f]);for(f=0;f<g.length;f++)(function(c,a,f){google.maps.event.addListener(a,f,function(a){a.pixel||(a.pixel=c.getProjection().fromLatLngToPoint(a.latLng));b[f]&&b[f].apply(this,[a])})})(this.map,e,g[f]);google.maps.event.addListener(e,"click",function(){this.details=a;b.click&&b.click.apply(this,[this]);e.infoWindow&&(c.hideInfoWindows(),e.infoWindow.open(c.map,e))});google.maps.event.addListener(e,"rightclick",function(c){c.marker=this;b.rightclick&&b.rightclick.apply(this,[c]);void 0!=window.context_menu.marker&&x("marker",c)});(b.dragend||e.fences)&&google.maps.event.addListener(e,"dragend",function(){e.fences&&c.checkMarkerGeofence(e,function(b,c){m(b,c)})});return e}throw"No latitude or longitude defined";};this.addMarker=function(b){if(!b.hasOwnProperty("gm_accessors_"))if(b.hasOwnProperty("lat")&&b.hasOwnProperty("lng")||b.position)b=this.createMarker(b);else throw"No latitude or longitude defined";b.setMap(this.map);this.markerClusterer&&this.markerClusterer.addMarker(b);this.markers.push(b);return b};this.addMarkers=function(b){for(var c=0,a;a=b[c];c++)this.addMarker(a);return this.markers};this.hideInfoWindows=function(){for(var b=0,c;c=this.markers[b];b++)c.infoWindow&&c.infoWindow.close()};this.removeMarker=function(b){for(var c=0;c<this.markers.length;c++)if(this.markers[c]===b){this.markers[c].setMap(null);this.markers.splice(c,1);break}return b};this.removeMarkers=function(b){b=b||this.markers;for(var c=0;c<this.markers.length;c++)this.markers[c]===b[c]&&this.markers[c].setMap(null);b=[];for(c=0;c<this.markers.length;c++)null!=this.markers[c].getMap()&&b.push(this.markers[c]);this.markers=b};this.drawOverlay=function(b){var c=new google.maps.OverlayView;c.setMap(d.map);var a=!0;null!=b.auto_show&&(a=b.auto_show);c.onAdd=function(){var a=k.createElement("div");a.style.borderStyle="none";a.style.borderWidth="0px";a.style.position="absolute";a.style.zIndex=100;a.innerHTML=b.content;c.el=a;var m=this.getPanes();b.layer||(b.layer="overlayLayer");m[b.layer].appendChild(a);for(var m=["contextmenu","DOMMouseScroll","dblclick","mousedown"],d=0;d<m.length;d++)(function(b,c){google.maps.event.addDomListener(b,c,function(b){-1!=navigator.userAgent.toLowerCase().indexOf("msie")&&document.all?(b.cancelBubble=!0,b.returnValue=!1):b.stopPropagation()})})(a,m[d]);google.maps.event.trigger(this,"ready")};c.draw=function(){var f=this.getProjection().fromLatLngToDivPixel(new google.maps.LatLng(b.lat,b.lng));b.horizontalOffset=b.horizontalOffset||0;b.verticalOffset=b.verticalOffset||0;var m=c.el,d=m.children[0],e=d.clientHeight,d=d.clientWidth;switch(b.verticalAlign){case "top":m.style.top=f.y-e+b.verticalOffset+"px";break;default:case "middle":m.style.top=f.y-e/2+b.verticalOffset+"px";break;case "bottom":m.style.top=f.y+b.verticalOffset+"px"}switch(b.horizontalAlign){case "left":m.style.left=f.x-d+b.horizontalOffset+"px";break;default:case "center":m.style.left=f.x-d/2+b.horizontalOffset+"px";break;case "right":m.style.left=f.x+b.horizontalOffset+"px"}m.style.display=a?"block":"none";a||b.show.apply(this,[m])};c.onRemove=function(){var a=c.el;b.remove?b.remove.apply(this,[a]):(c.el.parentNode.removeChild(c.el),c.el=null)};d.overlays.push(c);return c};this.removeOverlay=function(b){for(var c=0;c<this.overlays.length;c++)if(this.overlays[c]===b){this.overlays[c].setMap(null);this.overlays.splice(c,1);break}};this.removeOverlays=function(){for(var b=0,c;c=d.overlays[b];b++)c.setMap(null);d.overlays=[]};this.drawPolyline=function(b){var c=[],a=b.path;if(a.length)if(void 0===a[0][0])c=a;else for(var f=0,d;d=a[f];f++)c.push(new google.maps.LatLng(d[0],d[1]));c={map:this.map,path:c,strokeColor:b.strokeColor,strokeOpacity:b.strokeOpacity,strokeWeight:b.strokeWeight,geodesic:b.geodesic,clickable:!0,editable:!1,visible:!0};b.hasOwnProperty("clickable")&&(c.clickable=b.clickable);b.hasOwnProperty("editable")&&(c.editable=b.editable);b.hasOwnProperty("icons")&&(c.icons=b.icons);b.hasOwnProperty("zIndex")&&(c.zIndex=b.zIndex);c=new google.maps.Polyline(c);a="click dblclick mousedown mousemove mouseout mouseover mouseup rightclick".split(" ");for(f=0;f<a.length;f++)(function(a,c){google.maps.event.addListener(a,c,function(a){b[c]&&b[c].apply(this,[a])})})(c,a[f]);this.polylines.push(c);return c};this.removePolyline=function(b){for(var a=0;a<this.polylines.length;a++)if(this.polylines[a]===b){this.polylines[a].setMap(null);this.polylines.splice(a,1);break}};this.removePolylines=function(){for(var b=0,a;a=d.polylines[b];b++)a.setMap(null);d.polylines=[]};this.drawCircle=function(b){b=extend_object({map:this.map,center:new google.maps.LatLng(b.lat,b.lng)},b);delete b.lat;delete b.lng;for(var a=new google.maps.Circle(b),d="click dblclick mousedown mousemove mouseout mouseover mouseup rightclick".split(" "),f=0;f<d.length;f++)(function(a,c){google.maps.event.addListener(a,c,function(a){b[c]&&b[c].apply(this,[a])})})(a,d[f]);this.polygons.push(a);return a};this.drawRectangle=function(b){b=extend_object({map:this.map},b);var a=new google.maps.LatLngBounds(new google.maps.LatLng(b.bounds[0][0],b.bounds[0][1]),new google.maps.LatLng(b.bounds[1][0],b.bounds[1][1]));b.bounds=a;for(var a=new google.maps.Rectangle(b),d="click dblclick mousedown mousemove mouseout mouseover mouseup rightclick".split(" "),f=0;f<d.length;f++)(function(a,c){google.maps.event.addListener(a,c,function(a){b[c]&&b[c].apply(this,[a])})})(a,d[f]);this.polygons.push(a);return a};this.drawPolygon=function(b){var a=!1;b.hasOwnProperty("useGeoJSON")&&(a=b.useGeoJSON);delete b.useGeoJSON;b=extend_object({map:this.map},b);0==a&&(b.paths=[b.paths.slice(0)]);0<b.paths.length&&0<b.paths[0].length&&(b.paths=array_flat(array_map(b.paths,arrayToLatLng,a)));for(var a=new google.maps.Polygon(b),d="click dblclick mousedown mousemove mouseout mouseover mouseup rightclick".split(" "),f=0;f<d.length;f++)(function(a,c){google.maps.event.addListener(a,c,function(a){b[c]&&b[c].apply(this,[a])})})(a,d[f]);this.polygons.push(a);return a};this.removePolygon=function(b){for(var a=0;a<this.polygons.length;a++)if(this.polygons[a]===b){this.polygons[a].setMap(null);this.polygons.splice(a,1);break}};this.removePolygons=function(){for(var b=0,a;a=d.polygons[b];b++)a.setMap(null);d.polygons=[]};this.getFromFusionTables=function(b){var a=b.events;delete b.events;b=new google.maps.FusionTablesLayer(b);for(var d in a)(function(b,c){google.maps.event.addListener(b,c,function(b){a[c].apply(this,[b])})})(b,d);this.layers.push(b);return b};this.loadFromFusionTables=function(b){b=this.getFromFusionTables(b);b.setMap(this.map);return b};this.getFromKML=function(b){var a=b.url,d=b.events;delete b.url;delete b.events;b=new google.maps.KmlLayer(a,b);for(var f in d)(function(b,a){google.maps.event.addListener(b,a,function(b){d[a].apply(this,[b])})})(b,f);this.layers.push(b);return b};this.loadFromKML=function(b){b=this.getFromKML(b);b.setMap(this.map);return b};var t,y;this.getRoutes=function(b){switch(b.travelMode){case "bicycling":t=google.maps.TravelMode.BICYCLING;break;case "transit":t=google.maps.TravelMode.TRANSIT;break;case "driving":t=google.maps.TravelMode.DRIVING;break;default:t=google.maps.TravelMode.WALKING}y="imperial"===b.unitSystem?google.maps.UnitSystem.IMPERIAL:google.maps.UnitSystem.METRIC;var a=extend_object({avoidHighways:!1,avoidTolls:!1,optimizeWaypoints:!1,waypoints:[]},b);a.origin=new google.maps.LatLng(b.origin[0],b.origin[1]);a.destination=new google.maps.LatLng(b.destination[0],b.destination[1]);a.travelMode=t;a.unitSystem=y;delete a.callback;var d=this;(new google.maps.DirectionsService).route(a,function(a,c){if(c===google.maps.DirectionsStatus.OK)for(var f in a.routes)a.routes.hasOwnProperty(f)&&d.routes.push(a.routes[f]);b.callback&&b.callback(d.routes)})};this.removeRoutes=function(){this.routes=[]};this.getElevations=function(b){b=extend_object({locations:[],path:!1,samples:256},b);0<b.locations.length&&0<b.locations[0].length&&(b.locations=array_flat(array_map([b.locations],arrayToLatLng,!1)));var a=b.callback;delete b.callback;var d=new google.maps.ElevationService;b.path?d.getElevationAlongPath({path:b.locations,samples:b.samples},function(b,c){a&&"function"===typeof a&&a(b,c)}):(delete b.path,delete b.samples,d.getElevationForLocations(b,function(b,c){a&&"function"===typeof a&&a(b,c)}))};this.cleanRoute=this.removePolylines;this.drawRoute=function(b){var a=this;this.getRoutes({origin:b.origin,destination:b.destination,travelMode:b.travelMode,waypoints:b.waypoints,unitSystem:b.unitSystem,callback:function(c){0<c.length&&(a.drawPolyline({path:c[c.length-1].overview_path,strokeColor:b.strokeColor,strokeOpacity:b.strokeOpacity,strokeWeight:b.strokeWeight}),b.callback&&b.callback(c[c.length-1]))}})};this.travelRoute=function(b){if(b.origin&&b.destination)this.getRoutes({origin:b.origin,destination:b.destination,travelMode:b.travelMode,waypoints:b.waypoints,callback:function(a){0<a.length&&b.start&&b.start(a[a.length-1]);if(0<a.length&&b.step){var c=a[a.length-1];if(0<c.legs.length)for(var d=c.legs[0].steps,f=0,e;e=d[f];f++)e.step_number=f,b.step(e,c.legs[0].steps.length-1)}0<a.length&&b.end&&b.end(a[a.length-1])}});else if(b.route&&0<b.route.legs.length)for(var a=b.route.legs[0].steps,d=0,f;f=a[d];d++)f.step_number=d,b.step(f)};this.drawSteppedRoute=function(b){if(b.origin&&b.destination)this.getRoutes({origin:b.origin,destination:b.destination,travelMode:b.travelMode,waypoints:b.waypoints,callback:function(a){0<a.length&&b.start&&b.start(a[a.length-1]);if(0<a.length&&b.step){var c=a[a.length-1];if(0<c.legs.length)for(var f=c.legs[0].steps,e=0,g;g=f[e];e++)g.step_number=e,d.drawPolyline({path:g.path,strokeColor:b.strokeColor,strokeOpacity:b.strokeOpacity,strokeWeight:b.strokeWeight}),b.step(g,c.legs[0].steps.length-1)}0<a.length&&b.end&&b.end(a[a.length-1])}});else if(b.route&&0<b.route.legs.length)for(var a=b.route.legs[0].steps,e=0,f;f=a[e];e++)f.step_number=e,d.drawPolyline({path:f.path,strokeColor:b.strokeColor,strokeOpacity:b.strokeOpacity,strokeWeight:b.strokeWeight}),b.step(f)};this.checkGeofence=function(b,a,d){return d.containsLatLng(new google.maps.LatLng(b,a))};this.checkMarkerGeofence=function(b,a){if(b.fences)for(var c=0,f;f=b.fences[c];c++){var e=b.getPosition();d.checkGeofence(e.lat(),e.lng(),f)||a(b,f)}};this.addLayer=function(b,a){a=a||{};var c;switch(b){case "weather":this.singleLayers.weather=c=new google.maps.weather.WeatherLayer;break;case "clouds":this.singleLayers.clouds=c=new google.maps.weather.CloudLayer;break;case "traffic":this.singleLayers.traffic=c=new google.maps.TrafficLayer;break;case "transit":this.singleLayers.transit=c=new google.maps.TransitLayer;break;case "bicycling":this.singleLayers.bicycling=c=new google.maps.BicyclingLayer;break;case "panoramio":this.singleLayers.panoramio=c=new google.maps.panoramio.PanoramioLayer;c.setTag(a.filter);delete a.filter;a.click&&google.maps.event.addListener(c,"click",function(b){a.click(b);delete a.click});break;case "places":this.singleLayers.places=c=new google.maps.places.PlacesService(this.map);if(a.search||a.nearbySearch)b={bounds:a.bounds||null,keyword:a.keyword||null,location:a.location||null,name:a.name||null,radius:a.radius||null,rankBy:a.rankBy||null,types:a.types||null},a.search&&c.search(b,a.search),a.nearbySearch&&c.nearbySearch(b,a.nearbySearch);a.textSearch&&c.textSearch({bounds:a.bounds||null,location:a.location||null,query:a.query||null,radius:a.radius||null},a.textSearch)}if(void 0!==c)return"function"==typeof c.setOptions&&c.setOptions(a),"function"==typeof c.setMap&&c.setMap(this.map),c};this.removeLayer=function(b){void 0!==this.singleLayers[b]&&(this.singleLayers[b].setMap(null),delete this.singleLayers[b])};this.toImage=function(b){b=b||{};var a={};a.size=b.size||[this.el.clientWidth,this.el.clientHeight];a.lat=this.getCenter().lat();a.lng=this.getCenter().lng();if(0<this.markers.length)for(a.markers=[],b=0;b<this.markers.length;b++)a.markers.push({lat:this.markers[b].getPosition().lat(),lng:this.markers[b].getPosition().lng()});0<this.polylines.length&&(b=this.polylines[0],a.polyline={},a.polyline.path=google.maps.geometry.encoding.encodePath(b.getPath()),a.polyline.strokeColor=b.strokeColor,a.polyline.strokeOpacity=b.strokeOpacity,a.polyline.strokeWeight=b.strokeWeight);return p.staticMapURL(a)};this.addMapType=function(b,a){if(a.hasOwnProperty("getTileUrl")&&"function"==typeof a.getTileUrl)a.tileSize=a.tileSize||new google.maps.Size(256,256),a=new google.maps.ImageMapType(a),this.map.mapTypes.set(b,a);else throw"'getTileUrl' function required";};this.addOverlayMapType=function(a){if(a.hasOwnProperty("getTile")&&"function"==typeof a.getTile){var b=a.index;delete a.index;this.map.overlayMapTypes.insertAt(b,a)}else throw"'getTile' function required";};this.removeOverlayMapType=function(a){this.map.overlayMapTypes.removeAt(a)};this.addStyle=function(a){var b=new google.maps.StyledMapType(a.styles,a.styledMapName);this.map.mapTypes.set(a.mapTypeId,b)};this.setStyle=function(a){this.map.setMapTypeId(a)};this.createPanorama=function(a){a.hasOwnProperty("lat")&&a.hasOwnProperty("lng")||(a.lat=this.getCenter().lat(),a.lng=this.getCenter().lng());this.panorama=p.createPanorama(a);this.map.setStreetView(this.panorama);return this.panorama}};p.createPanorama=function(a){var d=l(a.el,a.context);a.position=new google.maps.LatLng(a.lat,a.lng);delete a.el;delete a.context;delete a.lat;delete a.lng;for(var e="closeclick links_changed pano_changed position_changed pov_changed resize visible_changed".split(" "),h=extend_object({visible:!0},a),n=0;n<e.length;n++)delete h[e[n]];d=new google.maps.StreetViewPanorama(d,h);for(n=0;n<e.length;n++)(function(d,e){google.maps.event.addListener(d,e,function(){a[e]&&a[e].apply(this)})})(d,e[n]);return d};p.Route=function(a){this.map=a.map;this.route=a.route;this.step_count=0;this.steps=this.route.legs[0].steps;this.steps_length=this.steps.length;this.polyline=this.map.drawPolyline({path:new google.maps.MVCArray,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight}).getPath();this.back=function(){if(0<this.step_count){this.step_count--;var a=this.route.legs[0].steps[this.step_count].path,e;for(e in a)a.hasOwnProperty(e)&&this.polyline.pop()}};this.forward=function(){if(this.step_count<this.steps_length){var a=this.route.legs[0].steps[this.step_count].path,e;for(e in a)a.hasOwnProperty(e)&&this.polyline.push(a[e]);this.step_count++}}};p.geolocate=function(a){var d=a.always||a.complete;navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){a.success(e);d&&d()},function(e){a.error(e);d&&d()},a.options):(a.not_supported(),d&&d())};p.geocode=function(a){this.geocoder=new google.maps.Geocoder;var d=a.callback;a.hasOwnProperty("lat")&&a.hasOwnProperty("lng")&&(a.latLng=new google.maps.LatLng(a.lat,a.lng));delete a.lat;delete a.lng;delete a.callback;this.geocoder.geocode(a,function(a,h){d(a,h)})};p.staticMapURL=function(a){function d(a,d){if("#"===a[0]&&(a=a.replace("#","0x"),d)){d=parseFloat(d);d=Math.min(1,Math.max(d,0));if(0===d)return"0x00000000";d=(255*d).toString(16);1===d.length&&(d+=d);a=a.slice(0,8)+d}return a}var e=[],h="http://maps.googleapis.com/maps/api/staticmap";a.url&&(h=a.url,delete a.url);var h=h+"?",n=a.markers;delete a.markers;!n&&a.marker&&(n=[a.marker],delete a.marker);var l=a.polyline;delete a.polyline;if(a.center)e.push("center\x3d"+a.center),delete a.center;else if(a.address)e.push("center\x3d"+a.address),delete a.address;else if(a.lat)e.push(["center\x3d",a.lat,",",a.lng].join("")),delete a.lat,delete a.lng;else if(a.visible){var k=encodeURI(a.visible.join("|"));e.push("visible\x3d"+k)}(k=a.size)?(k.join&&(k=k.join("x")),delete a.size):k="630x300";e.push("size\x3d"+k);a.zoom||(a.zoom=15);k=a.hasOwnProperty("sensor")?!!a.sensor:!0;delete a.sensor;e.push("sensor\x3d"+k);for(var g in a)a.hasOwnProperty(g)&&e.push(g+"\x3d"+a[g]);if(n)for(k=0;a=n[k];k++)g=[],a.size&&"normal"!==a.size?g.push("size:"+a.size):a.icon&&g.push("icon:"+encodeURI(a.icon)),a.color&&g.push("color:"+a.color.replace("#","0x")),a.label&&g.push("label:"+a.label[0].toUpperCase()),a=a.address?a.address:a.lat+","+a.lng,g.length||0===k?(g.push(a),g=g.join("|"),e.push("markers\x3d"+encodeURI(g))):(g=e.pop()+encodeURI("|"+a),e.push(g));if(l){a=l;l=[];a.strokeWeight&&l.push("weight:"+parseInt(a.strokeWeight,10));a.strokeColor&&(n=d(a.strokeColor,a.strokeOpacity),l.push("color:"+n));a.fillColor&&(n=d(a.fillColor,a.fillOpacity),l.push("fillcolor:"+n));n=a.path;if(n.join)for(a=0;g=n[a];a++)l.push(g.join(","));else l.push("enc:"+n);l=l.join("|");e.push("path\x3d"+encodeURI(l))}e=e.join("\x26");return h+e};google.maps.Polygon.prototype.getBounds||(google.maps.Polygon.prototype.getBounds=function(a){a=new google.maps.LatLngBounds;for(var d=this.getPaths(),e,h=0;h<d.getLength();h++){e=d.getAt(h);for(var k=0;k<e.getLength();k++)a.extend(e.getAt(k))}return a});google.maps.Polygon.prototype.containsLatLng||(google.maps.Polygon.prototype.containsLatLng=function(a){var d=this.getBounds();if(null!==d&&!d.contains(a))return!1;for(var d=!1,e=this.getPaths().getLength(),h=0;h<e;h++)for(var k=this.getPaths().getAt(h),l=k.getLength(),p=l-1,g=0;g<l;g++){var q=k.getAt(g),p=k.getAt(p);(q.lng()<a.lng()&&p.lng()>=a.lng()||p.lng()<a.lng()&&q.lng()>=a.lng())&&q.lat()+(a.lng()-q.lng())/(p.lng()-q.lng())*(p.lat()-q.lat())<a.lat()&&(d=!d);p=g}return d});google.maps.LatLngBounds.prototype.containsLatLng=function(a){return this.contains(a)};google.maps.Marker.prototype.setFences=function(a){this.fences=a};google.maps.Marker.prototype.addFence=function(a){this.fences.push(a)};return p}(this),coordsToLatLngs=function(h,k){var l=h[0],p=h[1];k&&(l=h[1],p=h[0]);return new google.maps.LatLng(l,p)},arrayToLatLng=function(h,k){for(var l=0;l<h.length;l++)h[l]=0<h[l].length&&"number"!=typeof h[l][0]?arrayToLatLng(h[l],k):coordsToLatLngs(h[l],k);return h},extend_object=function(h,k){if(h===k)return h;for(var l in k)h[l]=k[l];return h},replace_object=function(h,k){if(h===k)return h;for(var l in k)void 0!=h[l]&&(h[l]=k[l]);return h},array_map=function(h,k){var l=Array.prototype.slice.call(arguments,2);if(Array.prototype.map&&h.map===Array.prototype.map)return Array.prototype.map.call(h,function(a){callback_params=l;callback_params.splice(0,0,a);return k.apply(this,callback_params)});for(var p=[],a=h.length,d=0;d<a;d++)callback_params=l,callback_params=callback_params.splice(0,0,h[d]),p.push(k.apply(this,callback_params));return p},array_flat=function(h){new_array=[];for(var k=0;k<h.length;k++)new_array=new_array.concat(h[k]);return new_array};