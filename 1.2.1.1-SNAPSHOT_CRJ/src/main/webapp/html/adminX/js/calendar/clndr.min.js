'use strict';(function(d,m,n,l){function c(a,b){this.element=a;this.options=d.extend(!0,{},g,b);this.options.events.length&&(this.options.events=this.options.multiDayEvents?this.addMultiDayMomentObjectsToEvents(this.options.events):this.addMomentObjectToEvents(this.options.events));this.month=this.options.startWithMonth?moment(this.options.startWithMonth).startOf("month"):moment().startOf("month");this.options.constraints&&(this.options.constraints.startDate&&(a=moment(this.options.constraints.startDate),this.month.isBefore(a,"month")&&(this.month.set("month",a.month()),this.month.set("year",a.year()))),this.options.constraints.endDate&&(a=moment(this.options.constraints.endDate),this.month.isAfter(a,"month")&&this.month.set("month",a.month()).set("year",a.year())));this._defaults=g;this._name="clndr";this.init()}var g={template:"\x3cdiv class\x3d'clndr-controls'\x3e\x3cdiv class\x3d'clndr-control-button'\x3e\x3cspan class\x3d'clndr-previous-button'\x3e\x3ci class\x3d'fa fa-chevron-left'\x3e\x3c/i\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'month'\x3e\x3cspan\x3e\x3c%\x3d month %\x3e\x3c/span\x3e \x3c%\x3d year %\x3e\x3c/div\x3e\x3cdiv class\x3d'clndr-control-button leftalign'\x3e\x3cspan class\x3d'clndr-next-button'\x3e\x3ci class\x3d'fa fa-chevron-right'\x3e\x3c/i\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3ctable class\x3d'clndr-table' border\x3d'0' cellspacing\x3d'0' cellpadding\x3d'0'\x3e\x3cthead\x3e\x3ctr class\x3d'header-days'\x3e\x3c% for(var i \x3d 0; i \x3c daysOfTheWeek.length; i++) { %\x3e\x3ctd class\x3d'header-day'\x3e\x3c%\x3d daysOfTheWeek[i] %\x3e\x3c/td\x3e\x3c% } %\x3e\x3c/tr\x3e\x3c/thead\x3e\x3ctbody\x3e\x3c% for(var i \x3d 0; i \x3c numberOfRows; i++){ %\x3e\x3ctr\x3e\x3c% for(var j \x3d 0; j \x3c 7; j++){ %\x3e\x3c% var d \x3d j + i * 7; %\x3e\x3ctd class\x3d'\x3c%\x3d days[d].classes %\x3e'\x3e\x3cdiv class\x3d'day-contents'\x3e\x3c%\x3d days[d].day %\x3e\x3c/div\x3e\x3c/td\x3e\x3c% } %\x3e\x3c/tr\x3e\x3c% } %\x3e\x3c/tbody\x3e\x3c/table\x3e",weekOffset:0,startWithMonth:null,clickEvents:{click:null,nextMonth:null,previousMonth:null,nextYear:null,previousYear:null,today:null,onMonthChange:null,onYearChange:null},targets:{nextButton:"clndr-next-button",previousButton:"clndr-previous-button",nextYearButton:"clndr-next-year-button",previousYearButton:"clndr-previous-year-button",todayButton:"clndr-today-button",day:"day",empty:"empty"},events:[],extras:null,dateParameter:"date",multiDayEvents:null,doneRendering:null,render:null,daysOfTheWeek:null,showAdjacentMonths:!0,adjacentDaysChangeMonth:!1,ready:null,constraints:null,forceSixRows:null};c.prototype.init=function(){this.daysOfTheWeek=this.options.daysOfTheWeek||[];if(!this.options.daysOfTheWeek){this.daysOfTheWeek=[];for(var a=0;7>a;a++)this.daysOfTheWeek.push(moment().weekday(a).format("dd").charAt(0))}this.options.weekOffset&&(this.daysOfTheWeek=this.shiftWeekdayLabels(this.options.weekOffset));if(!d.isFunction(this.options.render)){this.options.render=null;if("undefined"===typeof _)throw Error("Underscore was not found. Please include underscore.js OR provide a custom render function.");this.compiledClndrTemplate=_.template(this.options.template)}d(this.element).html("\x3cdiv class\x3d'clndr'\x3e\x3c/div\x3e");this.calendarContainer=d(".clndr",this.element);this.bindEvents();this.render();this.options.ready&&this.options.ready.apply(this,[])};c.prototype.shiftWeekdayLabels=function(a){for(var b=this.daysOfTheWeek,f=0;f<a;f++)b.push(b.shift());return b};c.prototype.createDaysObject=function(a){daysArray=[];var b=a.startOf("month");this.eventsLastMonth=[];this.eventsThisMonth=[];this.eventsNextMonth=[];if(this.options.events.length)if(this.options.multiDayEvents){if(this.eventsThisMonth=d(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")==a.format("YYYY-MM")||this._clndrEndDateObject.format("YYYY-MM")==a.format("YYYY-MM")}).toArray(),this.options.showAdjacentMonths){var f=a.clone().subtract("months",1),c=a.clone().add("months",1);this.eventsLastMonth=d(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")==f.format("YYYY-MM")||this._clndrEndDateObject.format("YYYY-MM")==f.format("YYYY-MM")}).toArray();this.eventsNextMonth=d(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")==c.format("YYYY-MM")||this._clndrEndDateObject.format("YYYY-MM")==c.format("YYYY-MM")}).toArray()}}else this.eventsThisMonth=d(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==a.format("YYYY-MM")}).toArray(),this.options.showAdjacentMonths&&(f=a.clone().subtract("months",1),c=a.clone().add("months",1),this.eventsLastMonth=d(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==f.format("YYYY-MM")}).toArray(),this.eventsNextMonth=d(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==c.format("YYYY-MM")}).toArray());var k=b.weekday()-this.options.weekOffset;0>k&&(k+=7);if(this.options.showAdjacentMonths)for(var e=0;e<k;e++){var h=moment([a.year(),a.month(),e-k+1]);daysArray.push(this.createDayObject(h,this.eventsLastMonth))}else for(e=0;e<k;e++)daysArray.push(this.calendarDay({classes:this.options.targets.empty+" last-month"}));b=b.daysInMonth();for(e=1;e<=b;e++)h=moment([a.year(),a.month(),e]),daysArray.push(this.createDayObject(h,this.eventsThisMonth));for(e=1;0!==daysArray.length%7;)this.options.showAdjacentMonths?(h=moment([a.year(),a.month(),b+e]),daysArray.push(this.createDayObject(h,this.eventsNextMonth))):daysArray.push(this.calendarDay({classes:this.options.targets.empty+" next-month"})),e++;if(this.options.forceSixRows&&42!==daysArray.length)for(e=moment(daysArray[daysArray.length-1].date).add("days",1);42>daysArray.length;)this.options.showAdjacentMonths?(daysArray.push(this.createDayObject(moment(e),this.eventsNextMonth)),e.add("days",1)):daysArray.push(this.calendarDay({classes:this.options.targets.empty+" next-month"}));return daysArray};c.prototype.createDayObject=function(a,b){var f=[],c=moment(),d=0,e=b.length;for(d;d<e;d++)if(this.options.multiDayEvents){var h=b[d]._clndrStartDateObject,g=b[d]._clndrEndDateObject;(a.isSame(h,"day")||a.isAfter(h,"day"))&&(a.isSame(g,"day")||a.isBefore(g,"day"))&&f.push(b[d])}else b[d]._clndrDateObject.date()==a.date()&&f.push(b[d]);b="";c.format("YYYY-MM-DD")==a.format("YYYY-MM-DD")&&(b+=" today");a.isBefore(c,"day")&&(b+=" past");f.length&&(b+=" event");this.month.month()>a.month()?(b+=" adjacent-month",this.month.year()===a.year()?b+=" last-month":b+=" next-month"):this.month.month()<a.month()&&(b+=" adjacent-month",this.month.year()===a.year()?b+=" next-month":b+=" last-month");this.options.constraints&&(this.options.constraints.startDate&&a.isBefore(moment(this.options.constraints.startDate))&&(b+=" inactive"),this.options.constraints.endDate&&a.isAfter(moment(this.options.constraints.endDate))&&(b+=" inactive"));!a.isValid()&&a.hasOwnProperty("_d")&&a._d!=l&&(a=moment(a._d));b+=" calendar-day-"+a.format("YYYY-MM-DD");return this.calendarDay({day:a.date(),classes:this.options.targets.day+b,events:f,date:a})};c.prototype.render=function(){this.calendarContainer.children().remove();var a=this.createDaysObject(this.month),a={daysOfTheWeek:this.daysOfTheWeek,numberOfRows:Math.ceil(a.length/7),days:a,month:this.month.format("MMMM"),year:this.month.year(),eventsThisMonth:this.eventsThisMonth,eventsLastMonth:this.eventsLastMonth,eventsNextMonth:this.eventsNextMonth,extras:this.options.extras};this.options.render?this.calendarContainer.html(this.options.render.apply(this,[a])):this.calendarContainer.html(this.compiledClndrTemplate(a));if(this.options.constraints){for(target in this.options.targets)target!=this.options.targets.day&&this.element.find("."+this.options.targets[target]).toggleClass("inactive",!1);var b=a=null;this.options.constraints.startDate&&(a=moment(this.options.constraints.startDate));this.options.constraints.endDate&&(b=moment(this.options.constraints.endDate));a&&this.month.isSame(a,"month")&&this.element.find("."+this.options.targets.previousButton).toggleClass("inactive",!0);b&&this.month.isSame(b,"month")&&this.element.find("."+this.options.targets.nextButton).toggleClass("inactive",!0);a&&moment(a).subtract("years",1).isBefore(moment(this.month).subtract("years",1))&&this.element.find("."+this.options.targets.previousYearButton).toggleClass("inactive",!0);b&&moment(b).add("years",1).isAfter(moment(this.month).add("years",1))&&this.element.find("."+this.options.targets.nextYearButton).toggleClass("inactive",!0);(a&&a.isAfter(moment(),"month")||b&&b.isBefore(moment(),"month"))&&this.element.find("."+this.options.targets.today).toggleClass("inactive",!0)}this.options.doneRendering&&this.options.doneRendering.apply(this,[])};c.prototype.bindEvents=function(){var a=d(this.element),b=this;a.on("click","."+this.options.targets.day,function(a){if(b.options.clickEvents.click){var c=b.buildTargetObject(a.currentTarget,!0);b.options.clickEvents.click.apply(b,[c])}b.options.adjacentDaysChangeMonth&&(d(a.currentTarget).is(".last-month")?b.backActionWithContext(b):d(a.currentTarget).is(".next-month")&&b.forwardActionWithContext(b))});a.on("click","."+this.options.targets.empty,function(a){if(b.options.clickEvents.click){var c=b.buildTargetObject(a.currentTarget,!1);b.options.clickEvents.click.apply(b,[c])}b.options.adjacentDaysChangeMonth&&(d(a.currentTarget).is(".last-month")?b.backActionWithContext(b):d(a.currentTarget).is(".next-month")&&b.forwardActionWithContext(b))});a.on("click","."+this.options.targets.previousButton,{context:this},this.backAction).on("click","."+this.options.targets.nextButton,{context:this},this.forwardAction).on("click","."+this.options.targets.todayButton,{context:this},this.todayAction).on("click","."+this.options.targets.nextYearButton,{context:this},this.nextYearAction).on("click","."+this.options.targets.previousYearButton,{context:this},this.previousYearAction)};c.prototype.buildTargetObject=function(a,b){var c={element:a,events:[],date:null};if(b){var g;b=a.className.indexOf("calendar-day-");0!==b?(g=a.className.substring(b+13,b+23),c.date=moment(g)):c.date=null;this.options.events&&(c.events=this.options.multiDayEvents?d.makeArray(d(this.options.events).filter(function(){return(c.date.isSame(this._clndrStartDateObject,"day")||c.date.isAfter(this._clndrStartDateObject,"day"))&&(c.date.isSame(this._clndrEndDateObject,"day")||c.date.isBefore(this._clndrEndDateObject,"day"))})):d.makeArray(d(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM-DD")==g})))}return c};c.prototype.forwardAction=function(a){a=a.data.context;a.forwardActionWithContext(a)};c.prototype.backAction=function(a){a=a.data.context;a.backActionWithContext(a)};c.prototype.backActionWithContext=function(a){if(!a.element.find("."+a.options.targets.previousButton).hasClass("inactive")){var b=!a.month.isSame(moment(a.month).subtract("months",1),"year");a.month.subtract("months",1);a.render();a.options.clickEvents.previousMonth&&a.options.clickEvents.previousMonth.apply(a,[moment(a.month)]);a.options.clickEvents.onMonthChange&&a.options.clickEvents.onMonthChange.apply(a,[moment(a.month)]);b&&a.options.clickEvents.onYearChange&&a.options.clickEvents.onYearChange.apply(a,[moment(a.month)])}};c.prototype.forwardActionWithContext=function(a){if(!a.element.find("."+a.options.targets.nextButton).hasClass("inactive")){var b=!a.month.isSame(moment(a.month).add("months",1),"year");a.month.add("months",1);a.render();a.options.clickEvents.nextMonth&&a.options.clickEvents.nextMonth.apply(a,[moment(a.month)]);a.options.clickEvents.onMonthChange&&a.options.clickEvents.onMonthChange.apply(a,[moment(a.month)]);b&&a.options.clickEvents.onYearChange&&a.options.clickEvents.onYearChange.apply(a,[moment(a.month)])}};c.prototype.todayAction=function(a){a=a.data.context;var b=!a.month.isSame(moment(),"month"),c=!a.month.isSame(moment(),"year");a.month=moment().startOf("month");a.options.clickEvents.today&&a.options.clickEvents.today.apply(a,[moment(a.month)]);b&&(a.render(),a.month=moment(),a.options.clickEvents.onMonthChange&&a.options.clickEvents.onMonthChange.apply(a,[moment(a.month)]),c&&a.options.clickEvents.onYearChange&&a.options.clickEvents.onYearChange.apply(a,[moment(a.month)]))};c.prototype.nextYearAction=function(a){a=a.data.context;a.element.find("."+a.options.targets.nextYearButton).hasClass("inactive")||(a.month.add("years",1),a.render(),a.options.clickEvents.nextYear&&a.options.clickEvents.nextYear.apply(a,[moment(a.month)]),a.options.clickEvents.onMonthChange&&a.options.clickEvents.onMonthChange.apply(a,[moment(a.month)]),a.options.clickEvents.onYearChange&&a.options.clickEvents.onYearChange.apply(a,[moment(a.month)]))};c.prototype.previousYearAction=function(a){a=a.data.context;a.element.find("."+a.options.targets.previousYear).hasClass("inactive")||(a.month.subtract("years",1),a.render(),a.options.clickEvents.previousYear&&a.options.clickEvents.previousYear.apply(a,[moment(a.month)]),a.options.clickEvents.onMonthChange&&a.options.clickEvents.onMonthChange.apply(a,[moment(a.month)]),a.options.clickEvents.onYearChange&&a.options.clickEvents.onYearChange.apply(a,[moment(a.month)]))};c.prototype.forward=function(a){this.month.add("months",1);this.render();a&&a.withCallbacks&&(this.options.clickEvents.onMonthChange&&this.options.clickEvents.onMonthChange.apply(this,[moment(this.month)]),0===this.month.month()&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[moment(this.month)]));return this};c.prototype.back=function(a){this.month.subtract("months",1);this.render();a&&a.withCallbacks&&(this.options.clickEvents.onMonthChange&&this.options.clickEvents.onMonthChange.apply(this,[moment(this.month)]),11===this.month.month()&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[moment(this.month)]));return this};c.prototype.next=function(a){this.forward(a);return this};c.prototype.previous=function(a){this.back(a);return this};c.prototype.setMonth=function(a,b){this.month.month(a);this.render();b&&b.withCallbacks&&this.options.clickEvents.onMonthChange&&this.options.clickEvents.onMonthChange.apply(this,[moment(this.month)]);return this};c.prototype.nextYear=function(a){this.month.add("year",1);this.render();a&&a.withCallbacks&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[moment(this.month)]);return this};c.prototype.previousYear=function(a){this.month.subtract("year",1);this.render();a&&a.withCallbacks&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[moment(this.month)]);return this};c.prototype.setYear=function(a,b){this.month.year(a);this.render();b&&b.withCallbacks&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[moment(this.month)]);return this};c.prototype.setEvents=function(a){this.options.events=this.options.multiDayEvents?this.addMultiDayMomentObjectsToEvents(a):this.addMomentObjectToEvents(a);this.render();return this};c.prototype.addEvents=function(a){this.options.events=this.options.multiDayEvents?d.merge(this.options.events,this.addMultiDayMomentObjectsToEvents(a)):d.merge(this.options.events,this.addMomentObjectToEvents(a));this.render();return this};c.prototype.addMomentObjectToEvents=function(a){var b=0,c=a.length;for(b;b<c;b++)a[b]._clndrDateObject=moment(a[b][this.options.dateParameter]);return a};c.prototype.addMultiDayMomentObjectsToEvents=function(a){var b=0,c=a.length;for(b;b<c;b++)a[b]._clndrStartDateObject=moment(a[b][this.options.multiDayEvents.startDate]),a[b]._clndrEndDateObject=moment(a[b][this.options.multiDayEvents.endDate]);return a};c.prototype.calendarDay=function(a){return d.extend({},{day:"",classes:this.options.targets.empty,events:[],date:null},a)};d.fn.clndr=function(a){if(1===this.length){if(!this.data("plugin_clndr"))return a=new c(this,a),this.data("plugin_clndr",a),a}else if(1<this.length)throw Error("CLNDR does not support multiple elements yet. Make sure your clndr selector returns only one element.");}})(jQuery,window,document);